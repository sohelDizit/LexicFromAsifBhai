var OAuthCallback=function(){},OAuthError=function(n){ASC.Files.UI.displayInfoPanel(n,!0)},OAuthPopup=function(n,t,i){var u,r,f;if(ASC.Desktop)return u=ASC.Files.Anchor.modulePath+"#setting=thirdparty&"+(t?"providerKey="+encodeURIComponent(t):i?"providerId="+encodeURIComponent(i):""),location.href=n+"?redirect="+encodeURIComponent(u),null;try{f="height=600,width=1020,resizable=0,status=0,toolbar=0,menubar=0,location=1";r=window.open(n,"Authorization",f)}catch(e){r=window.open(n,"Authorization")}return r};
typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,ctrl:17,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,F2:113},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.Filter=function(){var t=!1,f=function(){if(!t){var n={anykey:!0,anykeytimeout:800,colcount:3,filters:i(),hintDefaultDisable:!0,maxlength:ASC.Files.Constants.MAX_NAME_LENGTH,sorters:e()};ASC.Files.Filter.advansedFilter=jq(".files-filter div").advansedFilter(n).bind("setfilter",ASC.Files.Filter.setFilter).bind("resetfilter",ASC.Files.Filter.setFilter)}},i=function(){var u=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES,t=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT,i=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,r=[{id:"selected-type-folder",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.FoldersOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterFolder,visible:!u&&!t&&!i},{id:"selected-type-text",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.DocumentsOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterDocument},{id:"selected-type-presentation",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.PresentationsOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterPresentation},{id:"selected-type-spreadsheet",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.SpreadsheetsOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterSpreadsheet},{id:"selected-type-image",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.ImagesOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterImage,visible:!t&&!i},{id:"selected-type-media",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.MediaOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterMedia,visible:!t&&!i},{id:"selected-type-archive",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.ArchiveOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterArchive,visible:!t&&!i},{id:"selected-type-file",filtertitle:ASC.Files.FilesJSResources.ButtonFilterType,group:ASC.Files.FilesJSResources.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.FilesOnly),type:"combobox",title:ASC.Files.FilesJSResources.ButtonFilterFiles,visible:!u&&!t&&!i}],f;return ASC.Resources.Master.Personal!=!0&&(r.push({id:"selected-person",group:ASC.Files.FilesJSResources.ButtonFilterAuthor,groupby:"owner",title:ASC.Files.FilesJSResources.Users,type:"person"}),r.push({id:"selected-group",group:ASC.Files.FilesJSResources.ButtonFilterAuthor,groupby:"owner",title:ASC.Files.FilesJSResources.Departments,type:"group"})),f=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH,jq(".files-filter").data("content")&&r.push({id:"with-content",group:ASC.Files.FilesJSResources.ButtonFilterOther,title:ASC.Files.FilesJSResources.ButtonFilterInContent,type:"flag",visible:!f}),r.push({id:"current-folder",group:ASC.Files.FilesJSResources.ButtonFilterOther,title:ASC.Files.FilesJSResources.ButtonFilterCurrentFolderOnly,type:"flag",visible:!f&&!u&&!t&&!i&&(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty())}),r},n=function(n){var u=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES,i=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT,r=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,t=[];return u||i||r||(t=[{def:n==ASC.Files.Constants.FilterType.FoldersOnly,title:ASC.Files.FilesJSResources.ButtonFilterFolder,value:ASC.Files.Constants.FilterType.FoldersOnly}]),t.push({def:n==ASC.Files.Constants.FilterType.DocumentsOnly,title:ASC.Files.FilesJSResources.ButtonFilterDocument,value:ASC.Files.Constants.FilterType.DocumentsOnly},{def:n==ASC.Files.Constants.FilterType.PresentationsOnly,title:ASC.Files.FilesJSResources.ButtonFilterPresentation,value:ASC.Files.Constants.FilterType.PresentationsOnly},{def:n==ASC.Files.Constants.FilterType.SpreadsheetsOnly,title:ASC.Files.FilesJSResources.ButtonFilterSpreadsheet,value:ASC.Files.Constants.FilterType.SpreadsheetsOnly}),i||r||t.push({def:n==ASC.Files.Constants.FilterType.ImagesOnly,title:ASC.Files.FilesJSResources.ButtonFilterImage,value:ASC.Files.Constants.FilterType.ImagesOnly},{def:n==ASC.Files.Constants.FilterType.MediaOnly,title:ASC.Files.FilesJSResources.ButtonFilterMedia,value:ASC.Files.Constants.FilterType.MediaOnly},{def:n==ASC.Files.Constants.FilterType.ArchiveOnly,title:ASC.Files.FilesJSResources.ButtonFilterArchive,value:ASC.Files.Constants.FilterType.ArchiveOnly}),u||i||r||t.push({def:n==ASC.Files.Constants.FilterType.FilesOnly,title:ASC.Files.FilesJSResources.ButtonFilterFiles,value:ASC.Files.Constants.FilterType.FilesOnly}),t},e=function(){var n=r(),t=[{def:n.property=="DateAndTime",dsc:n.property=="DateAndTime"?!n.is_asc:!1,id:"DateAndTime",title:ASC.Files.FilesJSResources.ButtonSortModifiedNew},{def:n.property=="DateAndTimeCreation",dsc:n.property=="DateAndTimeCreation"?!n.is_asc:!1,id:"DateAndTimeCreation",title:ASC.Files.FilesJSResources.ButtonSortCreated},{def:n.property=="AZ",dsc:n.property=="AZ"?!n.is_asc:!0,id:"AZ",title:ASC.Files.FilesJSResources.ButtonSortName},{def:n.property=="Type",dsc:n.property=="Type"?!n.is_asc:!0,id:"Type",title:ASC.Files.FilesJSResources.ButtonSortType},{def:n.property=="Size",dsc:n.property=="Size"?!n.is_asc:!1,id:"Size",title:ASC.Files.FilesJSResources.ButtonSortSize}];return ASC.Resources.Master.Personal!=!0&&t.push({def:n.property=="Author",dsc:n.property=="Author"?!n.is_asc:!1,id:"Author",title:ASC.Files.FilesJSResources.ButtonSortAuthor}),t},o=function(){ASC.Files.Filter.advansedFilter.advansedFilter({filters:i()});var n=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT;ASC.Files.Filter.advansedFilter.advansedFilter("sort",!n)},s=function(){if(!t){t=!0;return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!1)},h=function(n){n=n===!0;var i=!1;n&&t&&(i=!0,t=!1);ASC.Files.Filter.advansedFilter.advansedFilter(null);n&&i&&(t=!0)},c=function(){ASC.Files.Filter.advansedFilter.advansedFilter({filters:[{id:"current-folder",params:{}}]})},l=function(){ASC.Files.Filter.advansedFilter.advansedFilter("resize")},a=function(){return{sorter:r(),text:"",filter:ASC.Files.Constants.FilterType.None,subject:"",isSet:!1,withSubfolders:!1,searchInContent:!1}},v=function(){var n=ASC.Files.Filter.getDefaultFilterSettings(),t,i;return ASC.Files.Filter.advansedFilter==null?n:(t=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,i=ASC.Files.Filter.advansedFilter.advansedFilter(),jq(i).each(function(i,r){switch(r.id){case"sorter":var f=u(r.params.id,!r.params.dsc);n.sorter=f;break;case"text":n.text=r.params.value;n.isSet=!0;break;case"selected-person":n.subject=r.params.id;n.isSet=!0;break;case"selected-group":n.subjectGroup=!0;n.subject=r.params.id;n.isSet=!0;break;case"selected-type-folder":case"selected-type-text":case"selected-type-presentation":case"selected-type-spreadsheet":case"selected-type-image":case"selected-type-media":case"selected-type-archive":case"selected-type-file":n.filter=parseInt(r.params.value||ASC.Files.Constants.FilterType.None);n.isSet=n.filter!=ASC.Files.Constants.FilterType.None;break;case"current-folder":t=!0;break;case"with-content":n.searchInContent=!0}}),!t&&n.isSet&&(n.withSubfolders=!0),ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH&&(n.searchInContent=!1),n)},r=function(){return u(jq(".files-filter").data("sort"),jq(".files-filter").data("asc"))},u=function(n,t){return n=typeof n!="undefined"&&n!=""?n:"DateAndTime",t=t===!0,{is_asc:t,property:n}};return{init:f,advansedFilter:null,disableFilter:o,getDefaultFilterSettings:a,getFilterSettings:v,setFilter:s,clearFilter:h,setWithoutSubfolders:c,resize:l}}(),function(n){n(function(){ASC.Files.Filter.init();jq(".files-clear-filter").click(function(){return ASC.Files.Filter.clearFilter(),!1});jq("#filesWithoutSubfolders").click(function(){return ASC.Files.Filter.setWithoutSubfolders(),!1})})}(jQuery);
window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,async:!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r,f;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(e){throw"Can't translate xml : "+e;}try{f=new XMLSerializer;i=f.serializeToString(u)}catch(e){throw"Can't serialized xml : "+e;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();
window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},i=!0,r=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},u=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var r,f,i=0;i<u.length;i++)if(r=u[i],r.eventType==n&&r.params==JSON.stringify(t)){if(f=new Date-r.timeStamp,0<f&&f<p)return c.apply(this,r.data),!0;u.splice(i,1);i--}return!1},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},k=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},d=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=k(t[n]),t[n][f]={handler:i,type:u},f)},g=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},nt=function(){var t,n,r,i;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),t=e,arguments.length===0)return t;for(n=0,r=arguments.length-1;n<r;n++)t+=arguments[n]+a;return i=t+arguments[n],i+((i.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,u,f,e){var y,c,w,k;if(i=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(u){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=jq.parseJSON(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||jq.parseJSON(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);r.length!=0&&i==!0&&(k=r.shift(),i=!1,l(k))},tt=function(n,t,i){return function(){for(var r=[n,t,i],f=0,e=arguments.length;f<e;f++)r.push(arguments[f]);jq.inArray(n,w())>=0&&u.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:r});c.apply(this,r)}},n=function(n,t,u,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof u=="string"&&(typeof f=="undefined"&&(f={}),!b(u,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={async:f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:nt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:tt(u,f,t)};r.length==0&&i==!0?(i=!1,l(c)):r.push(c)}},l=function(n){jq.ajax({async:n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},it=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},rt=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID||"")+"&title="+encodeURIComponent(i.fileTitle)+"&templateId="+encodeURIComponent(i.templateId||""))},ut=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},ft=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},et=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},st=function(t,i,r){n("post","json",t,i,r,"folders-entries?filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search))},ht=function(t,i){i.ajaxsync=!0;n("get",i.dataType||"xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},ct=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},lt=function(t,i){n("get","json",t,i,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},at=function(t,i){n("get","json",t,i,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},vt=function(t,i){n("get","json",t,i,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},yt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&parentId="+encodeURIComponent(i.folderId||"")+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},pt=function(t,i){n("get","json",t,i,"presigned?fileId="+encodeURIComponent(i.fileId))},wt=function(t,i){n("get","xml",t,i,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},bt=function(t,i){n("get","xml",t,i,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},kt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},dt=function(t,i,r){n("post","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},gt=function(t,i,r){n("post","json",t,i,r,"folders-files?action=delete")},ni=function(t,i){n("get","json",t,i,"emptytrash")},ti=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("post","json",t,i,r,"bulkdownload")},ii=function(t,i){n("get","json",t,i,"tasks-statuses")},ri=function(t,i){n("get","json",t,i,"tasks")},ui=function(t,i){n("get","json",t,i,"trackeditfile?fileId="+encodeURIComponent(i.fileID)+"&tabId="+i.tabId+"&docKeyForTrack="+i.docKeyForTrack+"&isFinish="+(i.finish==!0)+i.shareLinkParam)},fi=function(t,i,r){n("post","json",t,i,r,"checkediting")},ei=function(t,i){n("get","json",t,i,"startEdit?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},oi=function(t,i){n("get","json",t,i,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},si=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},hi=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},ci=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},li=function(t,i,r){n("post","json",t,i,r,"removeace")},ai=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId))},vi=function(t,i){n("get","json",t,i,"publickeys?fileId="+encodeURIComponent(i.fileId))},yi=function(t,i){n("get","json",t,i,"sharedusers?fileId="+encodeURIComponent(i.fileId))},pi=function(t,i,r){n("post","json",t,i,r,"sendeditornotify?fileId="+encodeURIComponent(i.fileId))},wi=function(t,i,r){n("post","json",t,i,r,"checkconversion")},bi=function(t,i){n("get","json",t,i,"updateifexist?set="+i.value)},ki=function(t,i){n("get","json",t,i,"forcesave?set="+i.value)},di=function(t,i){n("get","json",t,i,"storeforcesave?set="+i.value)},gi=function(t,i){n("get","json",t,i,"changedeleteconfrim?set="+i.value)},nr=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},tr=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},ir=function(t,i){n("get","json",t,i,"thirdparty-delete?providerId="+i.providerId)},rr=function(t,i){n("get","json",t,i,"thirdparty?enable="+(i.enable===!0))},ur=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},fr=function(t,i){n("get","json",t,i,"docusign-delete")},er=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},or=function(t,i,r){n("post","json",t,i,r,"markasread")},sr=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},hr=function(t,i){n("get","xml",t,i,"gettemplates?filter="+i.filter+"&from="+i.from+"&count="+i.count+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},cr=function(t,i){n("get","xml",t,i,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},lr=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},ar=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},vr=function(t,i){n("get","json",t,i,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},yr=function(t,i){n("get","json",t,i,"mailaccounts")},pr=function(t,i){n("get","json",t,i,"gethelpcenter")},wr=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:d,unbind:g,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",GetMediaFile:"getmediafile",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",GetFileSharedInfo:"getfilesharedinfo",SetAceFileLink:"setacefilelink",GetEncryptionAccess:"getencryptionaccess",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",GetPresignedUri:"getpresigneduri",GetUsers:"getusers",SendEditorNotify:"sendeditornotify",MarkAsRead:"markasread",GetNews:"getnews",GetTemplates:"gettemplates",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",Forcesave:"forcesave",StoreForcesave:"storeforcesave",GetHelpCenter:"gethelpcenter",ChangeDeleteConfrim:"changedeleteconfrim",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",StartEdit:"startedit",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:it,createNewFile:rt,getFolderItems:ut,getTreeSubFolders:ft,getTreePath:et,getFolder:ot,getItems:st,getFile:ht,getFileHistory:ct,setCurrentVersion:lt,updateComment:at,completeVersion:vt,getSiblingsImage:yt,getPresignedUri:pt,renameFolder:wt,renameFile:bt,changeOwner:wr,moveFilesCheck:kt,moveItems:dt,deleteItem:gt,emptyTrash:ni,download:ti,getTasksStatuses:ii,terminateTasks:ri,trackEditFile:ui,checkEditing:fi,startEdit:ei,setAceLink:oi,getSharedInfo:si,getSharedInfoShort:hi,setAceObject:ci,unSubscribeMe:li,getShortenLink:ai,getEncryptionAccess:vi,getUsers:yi,sendEditorNotify:pi,checkConversion:wi,updateIfExist:bi,forcesave:ki,storeForcesave:di,changeDeleteConfrim:gi,getThirdParty:nr,saveThirdParty:tr,deleteThirdParty:ir,changeAccessToThirdparty:rr,saveDocuSign:ur,deleteDocuSign:fr,sendDocuSign:er,markAsRead:or,getNews:sr,getTemplates:hr,lockFile:cr,getEditHistory:lr,getDiffUrl:ar,restoreVersion:vr,getMailAccounts:yr,getHelpCenter:pr}}();
window.ASC.Files.UI=function(){var n=!1,i=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),r=function(){n===!1&&(n=!0);jq(window).resize(function(){t();ASC.Files.UI.fixContentHeaderWidth()});jq(window).bind("resizeWinTimerWithMaxDelay",function(){t();ASC.Files.UI.fixContentHeaderWidth()})},u=function(){},f=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},e=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},o=function(n){var r,u,i,t;return(n=jq(n),r='input:hidden[name="entry_data"]',n.is(".file-row")||(u=".file-row",n.is(".jstree *")&&(u=".tree-node",r='> a input:hidden[name="entry_data"]'),n=n.closest(u)),n.length==0)?null:(i=n.find(r),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.content_length_string=i.attr("data-content_length_string"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t.folderUrl=i.attr("data-folder_url"),t.folder_id=i.attr("data-folder_id"),t.encrypted=i.attr("data-encrypted")==="true",t)},s=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},h=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},c=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},l=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)?r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(i,!0)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.MediaPlayer.getPlayHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},a=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},v=function(n){var t=ASC.Files.Constants.storageKeyCompactView;typeof n=="undefined"&&(n=localStorageManager.getItem(t)===!0);localStorageManager.setItem(t,n);jq("#switchViewFolder").toggleClass("compact",n===!0);jq("#filesMainContent").toggleClass("compact",n===!0);ASC.Files.Folders.showMore&&n!==!0&&ASC.Files.UI.trackShowMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},y=function(){return jq("#settingCommon, #settingAdmin, #settingThirdPartyPanel, #helpPanel").is(":visible")},p=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},t=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},w=function(){var n=jq("#mainContentHeader .down_arrow");n.length&&(ASC.Files.UI.stickMovingPanel("mainContentHeader",jq("#filesSelectorPanel:visible")),ASC.Files.UI.fixContentHeaderWidth())},b=function(n,t){var i=jq("#"+n),u,r,o,f,s,e;i.is(":visible")&&(t&&t.hide(),u=n+"Spacer",r=jq("#"+u),o=jq("#"+u+":visible").length==0?i.offset().top:r.offset().top,f=jq(window),s=f.scrollTop(),s>=o?(i.hasClass("stick-panel")||(r.length==0&&(e=document.createElement("div"),e.id=u,document.body.appendChild(e),r=jq("#"+u),r.insertAfter(i),r.css({height:i.css("height"),"padding-bottom":i.css("padding-bottom"),"padding-top":i.css("padding-top")})),r.show(),i.addClass("stick-panel")),i.css("left",i.parent().offset().left-f.scrollLeft())):i.hasClass("stick-panel")&&(r.hide(),i.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto")))},k=function(n){typeof n=="undefined"&&(n=jq(window).width()>=1200);n?jq(".files-content-panel").height()-jq(".mainPageContent").height()<=jq(".mainPageContent").scrollTop()+350&&ASC.Files.Folders.showMore():jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore()},d=function(){var n=jq("#filesTemplateList .file-row");n.eq(n.length-1).position().top==271&&ASC.Files.Folders.getTemplateList(!0)},g=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},nt=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position","static"));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},tt=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},it=function(n){return n.hasClass("file-locked-by")},rt=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},ut=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},ft=function(n){var t=n||jq("#filesMainContent .file-row");t.each(function(){var t=ASC.Files.UI.getObjectData(this),e=t.entryId,i=t.entryType,n=t.entryObject,u=t.title,f,h,r,o,s,c;ASC.Files.Folders.folderContainer=="trash"?(n.find(".file-lock").remove(),n.find(".template-action").remove(),n.find(".entry-descr .title-created").remove(),n.find(".entry-descr .title-removed").show(),i=="folder"&&(n.find(".create-date").remove(),n.find(".modified-date").show())):(n.find(".entry-descr .title-removed").remove(),i=="folder"&&n.find(".modified-date").remove());f=n.find(".entry-title .name a");h=i=="file"?ASC.Files.Utility.getCssClassByFileTitle(u):ASC.Files.Utility.getFolderCssClass();n.find(".thumb-"+i).addClass(h);n.hasClass("checkloading")||(i=="file"?(f.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(f,u),ASC.Files.Folders.folderContainer!="trash"&&(r=ASC.Files.UI.getEntryLink(i,e,u),f.attr("href",r).attr("target","_blank"),o=n.find(".file-lock"),ASC.Files.UI.accessEdit(t,n)?n.hasClass("file-locked")&&(s=ASC.Files.FilesJSResources.TitleLockedFile,ASC.Files.UI.lockedForMe(n)&&(c=o.attr("data-name"),s=ASC.Files.FilesJSResources.TitleLockedFileBy.format(c),(ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")&&n.addClass("file-can-unlock")),o.attr("title",s)):o.remove()),ASC.Files.Utility.MustConvert(u)&&!t.encrypted?(n.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.Folders.folderContainer=="trash"?n.find(".convert-action").remove():n.find(".convert-action").show()):(t.encrypted&&(r=ASC.Files.Utility.GetFileDownloadUrl(e),f.attr("href",r),n.find(".file-edit").attr("href",r)),ASC.Files.UI.editableFile(t)&&(!t.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(u)&&ASC.Desktop&&ASC.Desktop.encryptionSupport())?(ASC.Files.UI.lockEditFile(n,ASC.Files.UI.editingFile(n)),n.find(".convert-action").remove(),ASC.Files.Utility.CanCoAuhtoring(u)&&!n.hasClass("on-edit-alone")&&n.addClass("can-coauthoring"),t.encrypted||(r=ASC.Files.Utility.GetFileWebEditorUrl(e),n.find(".file-edit").attr("href",r))):(n.addClass("cannot-edit"),n.find(".pencil").remove())),t.encrypted&&(ASC.Files.Folders.folderContainer!="privacy"||!ASC.Desktop||!ASC.Desktop.encryptionSupport()||ASC.Resources.Master.Personal)?n.addClass("without-share"):ASC.Resources.Master.Personal&&!ASC.Files.Utility.CanWebView(u)&&n.addClass("without-share")):ASC.Files.Folders.folderContainer!="trash"&&(r=ASC.Files.UI.getEntryLink(i,e),f.attr("href",r)),(ASC.Files.Folders.folderContainer=="trash"||t.error)&&f.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")||(ASC.Files.Folders.folderContainer!="forme"||ASC.Files.UI.accessEdit(t,n))&&(ASC.Files.Folders.folderContainer!="privacy"||i!="folder"&&ASC.Files.UI.accessEdit(t,n))&&(!ASC.Resources.Master.Personal||i!="folder")&&Teamlab.profile.isVisitor!==!0||n.addClass("without-share"),jq.browser.msie&&n.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},et=function(n,t){var r=jq.fixEvent(n),i,u;if(!(r.button==0||jq.browser.msie&&r.button==1))return!0;t=t||jq(r.srcElement||r.target);try{if(t.is("a, .menu-small"))return!0}catch(r){return!0}if(i=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(i).hasClass("row-selected")||jq(i).find(".checkbox input:visible").is("[type=radio]"),r.shiftKey){ASC.Files.UI.lastSelectedEntry||(ASC.Files.UI.lastSelectedEntry=i);u=!0;var f=jq(".file-row").index(i),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else r.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(i,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry=u?{entryObj:i}:null,!0},ot=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input:visible:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},st=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},ht=function(n){var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("checked",n===!0||t===!0);jq("#filesSelectAllCheck").prop("indeterminate",t)},ct=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},lt=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"media":t=(ASC.Files.Utility.FileIsAudio(i)||ASC.Files.Utility.FileIsVideo(i))&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},at=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},vt=function(n,t,i){var r,u,f;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),r=n?n.entryId:null,u=n?n.entryType:null,u=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_RECENT||r==ASC.Files.Constants.FOLDER_ID_FAVORITES||r==ASC.Files.Constants.FOLDER_ID_TEMPLATES||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;f=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);u=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(f=parseInt(ASC.Files.Folders.currentFolder.access));switch(f){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.CustomFilter:case ASC.Files.Constants.AceStatusEnum.Review:case ASC.Files.Constants.AceStatusEnum.FillForms:case ASC.Files.Constants.AceStatusEnum.Comment:return!!i;default:return n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_RECENT||n.entryId===ASC.Files.Constants.FOLDER_ID_FAVORITES||n.entryId===ASC.Files.Constants.FOLDER_ID_TEMPLATES||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)?!1:ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id}},yt=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(n.remove(),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},pt=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},wt=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResources.TitleEditingFile;i&&(r=ASC.Files.FilesJSResources.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},bt=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:visible:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},kt=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},dt=function(n,t,i){var f;n=n||ASC.Files.UI.getEntryObject(t,i);var r=ASC.Files.UI.getObjectData(n),h={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length_string:r.content_length_string,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},c=ASC.Files.Common.jsonToXml(h),l=ASC.Files.TemplateManager.translateFromString(c),u=n.find(".thumb-"+t),e=jq("#entryTooltip"),o=jq(window),s=12;e.html(l);f=u.offset().top+u.outerHeight()+e.outerHeight()+s>o.height()+o.scrollTop();jq.dropdownToggle().toggle(u,"entryTooltip",f?s:0,0,!1,null,null,null,f)},gt=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},ni=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},ti=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r).show();jq(t||n).show()}else jq(t||n).hide()},ii=function(n){jq(n).unbind("keyup").bind("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ri=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ui=function(n){ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView&&ASC.Files.MediaPlayer.closePlayer();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"),jq("#mainContentHeader, .files-filter").hide());jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon, #settingAdmin").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},fi=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},ei=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsCommon)},oi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-admin").addClass("active");jq("#settingAdmin").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsAdmin)},si=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleMoreFeaturs)},hi=function(){return jq("#personalLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#personalLimitExceedStoragePanel",500),!0):!1},ci=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500),!0):!1},li=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500),!0):!1},ai=function(n,t){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t)},vi=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},yi=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&i.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:r,parseItemId:s,getEntryObject:f,getObjectData:o,getSelectorId:e,getEntryTitle:h,getObjectTitle:c,getEntryLink:l,currentPage:0,amountPage:0,countTotal:0,updateFolderView:a,switchFolderView:v,isSettingsPanel:y,blockObjectById:g,blockObject:nt,highlightExtension:ut,addRowHandlers:ft,updateMainContentHeader:ot,lastSelectedEntry:null,checkSelectAll:ct,checkSelect:lt,selectRow:st,clickRow:et,resetSelectAll:ht,displayInfoPanel:at,editingFile:tt,editableFile:rt,lockedForMe:it,checkEditing:bt,timeCheckEditing:null,checkEditingDefer:kt,lockEditFileById:pt,lockEditFile:wt,accessEdit:vt,accessDelete:yt,checkCharacter:ii,canSetDocumentTitle:!0,setDocumentTitle:ri,stickContentHeader:w,fixContentHeaderWidth:p,stickMovingPanel:b,trackShowMore:k,trackShowMoreTemplates:d,displayEntryTooltip:dt,hideEntryTooltip:gt,timeTooltip:null,checkEmptyContent:ni,checkButtonBack:ti,hideAllContent:ui,displayHelp:fi,displayCommonSetting:ei,displayAdminSetting:oi,displayMoreFeaturs:si,displayPersonalLimitStorageExceed:hi,displayTariffLimitStorageExceed:ci,displayTariffFileSizeExceed:li,blockUI:ai,setProgressValue:vi,filesSelectedHandler:u,registerUserProfilePopup:yi}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").click(function(){ASC.Files.UI.switchFolderView(!1)});jq("#switchToCompact").click(function(){ASC.Files.UI.switchFolderView(!0)});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).blur();ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").click(function(){return jq(document).scrollTop(0),!1});jq(document).keydown(function(n){var t,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);i=t.target||t.srcElement;try{if(jq(i).is("input,textarea"))return!0}catch(t){return!0}return(r=t.keyCode||t.which,r==ASC.Files.Common.keyCode.A&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").focus()},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).keyup(function(n){var t,u,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);u=t.target||t.srcElement;try{if(jq(u).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey&&!t.altKey)return ASC.Files.Folders.deleteItem(),!1;if(i==ASC.Files.Common.keyCode.F&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if(i==ASC.Files.Common.keyCode.N&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1;i==ASC.Files.Common.keyCode.F2&&jq("#filesMainContent .file-row.row-selected:visible").length==1&&(r=ASC.Files.UI.getObjectData(jq("#filesMainContent .file-row.row-selected")),ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.rename(r.entryType,r.id))}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()})})}(jQuery);
window.ASC.Files.Mouse=function(){var t=!1,n=null,i=null,e=function(){t===!1&&(t=!0);ASC.Files.Mouse.mouseBtn=!1},o=function(n){return ASC.Files.Mouse.mouseBtn||ASC.Files.Mouse.disableHover?!0:(n=jq.fixEvent(n),this.classList.toggle("row-hover",n.type=="mouseenter"),!0)},s=function(n){return n.nodeName=="HTML"?!0:jq(".popup-modal:visible").length!=0?!0:ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView?!0:jq(n).is("nav,             .nav-content,             .page-menu,             main,             .filter-content,             .mainPageTableSidePanel,             .mainPageContent,             .files-content-panel,             #mainContentHeader,             #mainContent,             .file-row:not(.row-rename):not(.row-selected),             .file-row:not(.row-rename):not(.row-selected) *")?jq(n).is(".textEdit, .checkbox, input"):!0},h=function(){jq("#filesSelector").length!=0&&(ASC.Files.Mouse.mouseSelector.entryItems=[],jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file)").each(function(){var n=jq(this).offset();n.right=n.left+this.offsetWidth;n.bottom=n.top+this.offsetHeight;n.entryObj=jq(this);ASC.Files.Mouse.mouseSelector.entryItems.push(n)}))},c=function(){n=jq("#filesMainContent").offset();n.right=n.left+jq("#filesMainContent")[0].offsetWidth;n.bottom=n.top+jq("#filesMainContent")[0].offsetHeight;n.documentWidth=jq(document).width();n.documentHeight=jq(document).height()},r=function(n,t){var i=n.x<t.x;return(i?n:t).y>(i?t:n).x},u=function(n,t){return r({x:n.top,y:n.bottom},{x:t.top,y:t.bottom})&&r({x:n.left,y:n.right},{x:t.left,y:t.right})},l=function(n){var t,i;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn=n.target.nodeName!="HTML",!(n.button==0||jq.browser.msie&&n.button==1))return!0;t=n.target||n.srcElement;try{if(s(t))return!0}catch(r){return!0}return jq(t).is(".folder-row:not(.error-entry) .thumb-folder,.file-row:not(.error-entry) .thumb-file,.file-row:not(.error-entry) .entry-title .name a,.file-row:not(.error-entry) .entry-title .name span")?(ASC.Files.Folders.folderContainer!=="trash"&&(ASC.Files.UI.clickRow(n,jq(t).closest(".file-row")),ASC.Files.Mouse.preparingMoveTo(n)),!0):(ASC.Files.Mouse.mouseSelector.startX=n.pageX,ASC.Files.Mouse.mouseSelector.startY=n.pageY,ASC.Files.Mouse.updateMainContentArea(),i=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window),i.unbind("mousemove.MouseSelect mouseup.MouseSelect").bind("mousemove.MouseSelect",ASC.Files.Mouse.continueSelecting).bind("mouseup.MouseSelect",ASC.Files.Mouse.finishSelecting),typeof SmallChat!="undefined"&&SmallChat.minimizeAllWindowsIfLoseFocus&&SmallChat.minimizeAllWindowsIfLoseFocus(n,t),!1)},a=function(t){var a,o,r,e,l,s;if(t=jq.fixEvent(t),a=t.target||t.srcElement,typeof a=="undefined")return!0;var v=2,h=Math.min(t.pageX,n.documentWidth-v),c=Math.min(t.pageY,n.documentHeight-v),y=Math.abs(h-ASC.Files.Mouse.mouseSelector.startX),p=Math.abs(c-ASC.Files.Mouse.mouseSelector.startY);if(y<5&&p<5)return!0;if(jq("#filesSelector").length==0&&(ASC.Files.Actions.hideAllActionPanels(),jq("#studioPageContent").append('<div id="filesSelector"><\/div>'),ASC.Files.Mouse.collectEntryItems(),jq("body").addClass("select-action"),ASC.Files.Mouse.disableHover=!0),o={left:Math.min(ASC.Files.Mouse.mouseSelector.startX,h),top:Math.min(ASC.Files.Mouse.mouseSelector.startY,c),right:Math.max(ASC.Files.Mouse.mouseSelector.startX,h),bottom:Math.max(ASC.Files.Mouse.mouseSelector.startY,c)},jq("#filesSelector").css({width:y+"px",height:p+"px",left:o.left+"px",top:o.top+"px"}),r=n,t.ctrlKey||u(r,o)){for(e=!1,l=ASC.Files.Mouse.mouseSelector.entryItems.length,s=l;s;s--)r=ASC.Files.Mouse.mouseSelector.entryItems[l-s],u(r,o)?e=ASC.Files.UI.selectRow(r.entryObj,!0)||e:t.ctrlKey||(e=ASC.Files.UI.selectRow(r.entryObj,!1)||e);e&&(clearTimeout(i),i=setTimeout(ASC.Files.UI.updateMainContentHeader,10))}else ASC.Files.UI.checkSelectAll(!1);return f(t),!1},f=function(n){var t=50,i=15;t>Math.abs(n.pageY-document.documentElement.scrollTop)&&window.scrollBy(0,-i);t>Math.abs(n.pageY-(document.documentElement.scrollTop+document.documentElement.clientHeight))&&window.scrollBy(0,i)},v=function(){jq("#filesSelector").remove();ASC.Files.Mouse.mouseSelector.startX=0;ASC.Files.Mouse.mouseSelector.startY=0;ASC.Files.Mouse.mouseSelector.entryItems=[];ASC.Files.Mouse.mouseBtn=!1;ASC.Files.Mouse.disableHover=!1;var n=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window);n.unbind("mousemove.MouseSelect mouseup.MouseSelect");jq("body").removeClass("select-action")},y=function(n,t){var i=["#treeViewContainer li:not(.access-read) > a",".to-parent-folder"],r;ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_TRASH&&i.push("#filesMainContent .folder-row:not(.checkloading):not(.new-folder):not(.error-entry):not(.row-selected)");r=i.join(",");jq(r).each(function(){var i,r=ASC.Files.UI.getObjectData(this),u;r?i=r.entryId:(i=jq(this).attr("data-id"),t&&i==ASC.Files.Constants.FOLDER_ID_TRASH&&(i=null));ASC.Files.Common.isCorrectId(i)&&(u=r?r.entryObject:ASC.Files.UI.getEntryObject("folder",i),i!=ASC.Files.Folders.currentFolder.id&&ASC.Files.UI.accessEdit(r,u)&&(i!=ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.UI.accessEdit())&&jq(this).addClass(n))})},p=function(n,t,i){var r,e,u,f;return(n=jq.fixEvent(n),n.type=="mouseleave")?(jq("."+i).removeClass(i),null):(r=jq("#treeViewContainer").offset().left,e=r+jq("#treeViewContainer")[0].offsetWidth,jq(this).is("#treeViewContainer *")&&(r>n.pageX||e<n.pageX))?null:(f=ASC.Files.UI.getObjectData(t),u=f?f.entryId:jq(t).attr("data-id"),ASC.Files.Common.isCorrectId(u))?(jq(t).addClass(i),u):null},w=function(n){return(n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1))?!1:ASC.Files.Folders.folderContainer=="trash"||ASC.Files.Folders.folderContainer=="privacy"?!1:jq("#treeViewPanelSelector").length==0?!1:jq("#promptRename").length!=0?!0:(ASC.Files.Mouse.moveToX=n.pageX,ASC.Files.Mouse.moveToY=n.pageY,jq("body").unbind("mouseout.MouseMove mousemove.MouseMove keyup.MouseMove keydown.MouseMove").bind("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.beginMoveTo),!0)},b=function(n){if(n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1)||ASC.Files.Mouse.mouseBtn==!1)return jq("body").unbind("mouseout.MouseMove mousemove.MouseMove keyup.MouseMove keydown.MouseMove"),!1;if(Math.abs(n.pageX-ASC.Files.Mouse.moveToX)<5&&Math.abs(n.pageY-ASC.Files.Mouse.moveToY)<5)return!1;ASC.Files.Actions.hideAllActionPanels();jq("#contentVersions").removeClass("version-highlight");jq("#filesMainContent .row-hover").removeClass("row-hover");jq(".may-row-to").removeClass("may-row-to");jq("body").addClass("user-select-none file-mouse-move");ASC.Files.Mouse.highlightFolderTo("may-row-to");jq("body").unbind("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove keyup.MouseMove keydown.MouseMove").bind("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.continueMoveTo).bind("mouseup.MouseMove",ASC.Files.Mouse.finishMoveTo).bind("keyup.MouseMove keydown.MouseMove",function(n){n=jq.fixEvent(n);var t=n.keyCode||n.which;return t==ASC.Files.Common.keyCode.ctrl?ASC.Files.Mouse.continueMoveTo(n):!0}).on("mouseenter.MouseMove mouseleave.MouseMove",".may-row-to",ASC.Files.Mouse.checkMoveTo);return!0},k=function(n){var o,u,e,i,r,t;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn==!1)return ASC.Files.Mouse.finishMoveTo(n),!0;if(ASC.Files.UI.accessEdit()&&ASC.Files.UI.accessDelete()&&!n.ctrlKey?(o=ASC.Files.FilesJSResources.InfoMoveDescribe,jq("body").removeClass("file-mouse-copy")):(o=ASC.Files.FilesJSResources.InfoCopyDescribe,jq("body").addClass("file-mouse-copy")),jq("#filesMovingTooltip").length==0&&jq("#filesMainContent").parent().after('<div id="filesMovingTooltip" class="studio-action-panel"><\/div>'),e=jq("#filesMainContent .file-row:has(.checkbox input:checked)"),u=e.length==1?ASC.Files.UI.getObjectTitle(e[0]):ASC.Files.FilesJSResources.InfoCountDescribe.format(e.length),u=o.format(u,"<b>","<\/b>","<br/>"),jq("#filesMovingTooltip").html(u),i=n.target||n.srcElement,jq(i).is("body")||jq("#filesMovingTooltip").css({left:n.pageX+"px",top:n.pageY+"px"}),jq.browser.opera){i=jq(i);i.hasClass("file-row")||(i=jq(i).closest(".file-row"));r="fix_select_text";t=i.children("#"+r);t.length==0&&(jq("#"+r).remove(),t=document.createElement("INPUT"),t.style.width=0,t.style.height=0,t.style.border=0,t.style.margin=0,t.style.padding=0,t.id=r,t.disabled=!0,i.prepend(t),t=jq("#"+r));try{t.focus()}catch(n){t.disabled=!1;t.focus();t.disabled=!0}}return f(n),!0},d=function(n){ASC.Files.Mouse.moveToFolder=ASC.Files.Mouse.getOverFolderId(n,this,"row-to")},g=function(n){var t,i;n=jq.fixEvent(n);jq("#contentVersions").addClass("version-highlight");jq(".row-to").removeClass("row-to");jq(".may-row-to").removeClass("may-row-to");jq("body").removeClass("user-select-none file-mouse-move file-mouse-copy");t=ASC.Files.Mouse.moveToFolder;ASC.Files.Mouse.moveToFolder=null;ASC.Files.Common.isCorrectId(t)&&(t==ASC.Files.Constants.FOLDER_ID_TRASH?ASC.Files.Folders.deleteItem():(ASC.Files.Folders.isCopyTo=!ASC.Files.UI.accessEdit()||!ASC.Files.UI.accessDelete()||n&&n.ctrlKey===!0,i=ASC.Files.UI.getEntryTitle("folder",t),ASC.Files.Folders.curItemFolderMoveTo(t,i)));ASC.Files.Folders.isCopyTo=!1;jq("body").unbind("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove mouseenter.MouseMove mouseleave.MouseMove keyup.MouseMove keydown.MouseMove");jq("#filesMovingTooltip").remove()},nt=function(){var n=jq(this);ASC.Files.UI.hideEntryTooltip();n.one("mouseleave",function(){ASC.Files.UI.hideEntryTooltip()});var t=ASC.Files.UI.getObjectData(n),i=t.entryId,r=t.entryType;n.attr("data-title",!0);n.removeAttr("title");ASC.Files.UI.timeTooltip=setTimeout(function(){ASC.Files.UI.displayEntryTooltip(t.entryObject,r,i)},750)};return{init:e,mouseBtn:!1,disableHover:!1,mouseSelector:{startX:0,startY:0,entryItems:[]},moveToX:0,moveToY:0,moveToFolder:"",updateMainContentArea:c,handleMove:o,collectEntryItems:h,beginSelecting:l,continueSelecting:a,finishSelecting:v,preparingMoveTo:w,beginMoveTo:b,continueMoveTo:k,checkMoveTo:d,finishMoveTo:g,overCompactTitle:nt,highlightFolderTo:y,getOverFolderId:p}}(),function(n){ASC.Files.Mouse.init();n(function(){jq("#filesMainContent").on("mousedown",".file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)",ASC.Files.Mouse.preparingMoveTo);jq("#mainContent").on("mouseover","#filesMainContent.compact .file-row:not(.checkloading):not(.new-folder):not(.new-file) .entry-title .name a",ASC.Files.Mouse.overCompactTitle);jq(document).on("mousedown.MouseSelect","#studioPageContent:has(#filesMainContent .file-row:visible:not(.checkloading):not(.new-folder):not(.new-file))",ASC.Files.Mouse.beginSelecting);jq(document).bind("mouseup.Mouse",function(){ASC.Files.Mouse.mouseBtn=!1});jq("#filesMainContent").on("mouseenter mouseleave",".file-row:not(.checkloading)",ASC.Files.Mouse.handleMove);jq(document).on("dragstart",".row-selected a",function(n){n.preventDefault()})})}(jQuery);
window.ASC.Files.Marker=function(){var n=!1,t=function(){n===!1&&(n=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MarkAsRead,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetNews,ASC.Files.Marker.onGetNews),jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,".is-new","#filesNewsPanel")}))},i=function(n){return typeof n=="undefined"||n==null?!1:(jq("#studio_sidePanel .page-menu .is-new").hide(),jq(n.childNodes).each(function(n,t){var i=t.childNodes[0],r=t.childNodes[1],f=i.textContent||i.text,u=r.textContent||r.text;u>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(f)).text(u).show()}),!0)},r=function(n,t){return ASC.Files.Marker.setNewCount(n,t,0)},u=function(n,t,i){var f=!1,o=(i|0)>0,r=ASC.Files.UI.getEntryObject(n,t).find(".is-new");if(r.is(":visible")){var s=n=="file"?-Math.pow(-1,i):i-(r.html()|0),h=ASC.Files.Tree.pathParts[0],u=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(h)),c=u.html()|0,e=c+s;u.html(e>0?e:0);e>0?u.show():u.hide();o?n=="folder"&&r.html(i):r.remove();f=!0}return n==="folder"&&(r=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(t)),r.is(":visible")&&(r.html(i>0?i:0),o?r.show():(r.hide(),jq.inArray(t+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()),f=!0)),f},f=function(n){var t,i={};return(i.entry=[],typeof n=="undefined"?jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){t=ASC.Files.UI.getObjectData(this);t.entryObject.find(".is-new").length>0&&i.entry.push(t.entryType+"_"+t.entryId)}):typeof n=="object"?(t=n,i.entry.push(t.entryType+"_"+t.entryId)):ASC.Files.Common.isCorrectId(n)&&i.entry.push("folder_"+n),i.entry.length==0)?!1:(ASC.Files.ServiceManager.markAsRead(ASC.Files.ServiceManager.events.MarkAsRead,{list:i.entry,doNow:!0},{stringList:i}),!1)},e=function(n,t){var i,r;if(ASC.Files.Actions.hideAllActionPanels(),!ASC.Files.Common.isCorrectId(t)){if(i=ASC.Files.UI.getObjectData(n),i.entryType=="file"){ASC.Files.Marker.markAsRead(i);return}t=i.entryId}trackingGoogleAnalytics("documents","shownews","folder");r={top:n.offset().top,left:n.offset().left,width:n.width(),height:n.height()};ASC.Files.ServiceManager.getNews(ASC.Files.ServiceManager.events.GetNews,{folderId:t,targetSize:r,showLoading:!0})},o=function(n){var t,i,r,u;for(jq("#studio_sidePanel .page-menu .is-new").hide(),t=0;t<n.length;t++){if(i=ASC.Files.UI.parseItemId(n[t]),i==null){if(n[t].indexOf("new_")==0){var o=n[t].substring(4).replace(/\?/g,":"),f=JSON.parse(o),s=f.key,e=f.value;e>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(s)).text(e).show()}continue}r=i.entryType;u=i.entryId;ASC.Files.UI.blockObjectById(i.entryType,i.entryId,!1,null,!0);ASC.Files.Marker.removeNewIcon(r,u);r=="folder"&&jq.inArray(u+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()}ASC.Files.UI.updateMainContentHeader();ASC.Files.Actions.showActionsViewPanel()},s=function(n,t,i){var u,c;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(u=ASC.Files.TemplateManager.translate(n),u.length){jq("#filesNewsList").html(u);jq("#filesNewsList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")});var r=t.targetSize,e=jq("#filesNewsPanel"),o=8,f=r.top+r.height+o,s=0,h=e.outerHeight();document.body.clientHeight-(f-pageYOffset+h)<0&&(f=r.top-o,s=h);e.css({top:f-s,left:r.left}).toggle().attr("data-id",t.folderId);c=jq("#filesNewsList .file-row").length;ASC.Files.Marker.setNewCount("folder",t.folderId,c)}else ASC.Files.Marker.removeNewIcon("folder",t.folderId)};return{init:t,removeNewIcon:r,setNewCount:u,markAsRead:f,markRootAsNew:i,getNews:e,onMarkAsRead:o,onGetNews:s}}(),function(n){n(function(){ASC.Files.Marker.init();jq(document).on("click",".is-new",function(){var n=jq(this),t=n.attr("data-id");return ASC.Files.Marker.getNews(n,t),!1});jq("#studioPageContent").on("click","#buttonMarkRead, #mainMarkRead.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Marker.markAsRead()});jq("#filesNewsMarkRead").click(function(){ASC.Files.Actions.hideAllActionPanels();var n=jq("#filesNewsPanel").attr("data-id");ASC.Files.Marker.markAsRead(n)});jq("#filesNewsList").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this).id;return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesNewsList").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(){var r=ASC.Files.UI.getObjectData(this),o=!0,u,i,n,t,f;if(ASC.Files.MediaPlayer&&(ASC.Files.MediaPlayer.canPlay(r.title)||ASC.Files.Utility.CanImageView(r.title))){ASC.Files.Actions.hideAllActionPanels();var s=jq("#filesNewsList .file-row:not(.folder-row):not(.error-entry) .ft_Image, #filesNewsList .file-row:not(.folder-row):not(.error-entry) .ft_Video"),e=[],h=0;for(u=0;u<s.length;u++)i=ASC.Files.UI.getObjectData(s[u]),(ASC.Files.MediaPlayer.canPlay(i.title)||ASC.Files.Utility.CanImageView(i.title))&&(e.push(i),r.id===i.id&&(h=e.length-1));n=jq("#filesNewsPanel").attr("data-id");t=jq(".is-new"+ASC.Files.UI.getSelectorId(n));ASC.Files.MediaPlayer.init(-1,{playlist:e,playlistPos:h,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(i){var u=ASC.Files.UI.getEntryObject("file",i).find(".is-new"),r;u.is(":visible")||(t.is(":visible")||(t=ASC.Files.UI.getEntryObject("folder",n).find(".is-new")),f=t.html()|0,ASC.Files.Marker.setNewCount("folder",n,f-1));ASC.Files.Marker.removeNewIcon("file",i);r=ASC.Files.MediaPlayer.getPlayHash(i);ASC.Files.Anchor.move(r,!0)},downloadAction:ASC.Files.Utility.GetFileDownloadUrl})}else o=ASC.Files.Folders.clickOnFile(r);return o||(n=jq("#filesNewsPanel").attr("data-id"),t=jq(".is-new"+ASC.Files.UI.getSelectorId(n)),t.is(":visible")||(t=ASC.Files.UI.getEntryObject("folder",n).find(".is-new")),f=t.html()|0,ASC.Files.Marker.setNewCount("folder",n,f-1)),!1});jq("#studio_sidePanel .page-menu .is-new").trackEvent("files_tree","action-click","mark_as_read")})}(jQuery);
window.ASC.Files.Actions=function(){var n=!1,i=function(){n===!1&&(n=!0,jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,"#filesActionsPanel","#filesActionsPanel",function(){ASC.Files.Mouse.disableHover=!1});jq.dropdownToggle().registerAutoHide(n,".row-selected .menu-small","#filesActionPanel",function(){jq(".row-selected .menu-small.active").removeClass("active");jq(".row-selected.row-lonely-select").removeClass("row-lonely-select");ASC.Files.Mouse.disableHover=!1})}),jq.dropdownToggle({switcherSelector:"#mainContentHeader .menuActionSelectAll",dropdownID:"filesSelectorPanel",anchorSelector:".menuActionSelectAll",addTop:4}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesVersionPanel",sideToggle:!0,switcherSelector:"#filesVersion",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesMovePanel",sideToggle:!0,switcherSelector:"#filesMove",toggleOnOver:!0}),jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"foldersMovePanel",sideToggle:!0,switcherSelector:"#foldersMove",toggleOnOver:!0}),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileSharedInfo,s),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceFileLink,c))},t=function(n){r(n);u(n);f()},r=function(n){var u=!!n.find(".dropdown-item.first-section:visible").length,r=!!n.find(".dropdown-item.second-section:visible").length,t=!!n.find(".dropdown-item.third-section:visible").length,i=!!n.find(".dropdown-item.fourth-section:visible").length;n.find(".dropdown-item-seporator.first-section").toggle(u&&(r||t||i));n.find(".dropdown-item-seporator.second-section").toggle(r&&(t||i));n.find(".dropdown-item-seporator.third-section").toggle(t&&i)},u=function(n){var t=n.find(".dropdown-content:visible"),i;if(!t.get(0).style.minWidth){var u=t.find("li"),f=u.map(function(){return jq(this).width()}),r=Math.max.apply(Math,f),e=r-t.width();t.css({minWidth:r});i=n.position();i.left+n.outerWidth()>document.documentElement.clientWidth&&n.css({left:i.left-e})}},f=function(){var n=jq("#filesGetLink:visible, #foldersGetLink:visible").first();n.length&&e(n.attr("id"));jq("#filesGetExternalLink").is(":visible")&&o()},e=function(n){var t=ASC.Files.Actions.currentEntryData.entryObject.find(".entry-title .name a").prop("href");ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);ASC.Files.Actions.clipGetLink=ASC.Clipboard.create(t,n,{onComplete:function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess);ASC.Files.Actions.hideAllActionPanels()}})},o=function(){ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetFileSharedInfo,{showLoading:!0},{stringList:{entry:[ASC.Files.Actions.currentEntryData.entryType+"_"+ASC.Files.Actions.currentEntryData.id]}})},s=function(n,t,i){if(i){ASC.Files.UI.displayInfoPanel(i,!0);return}var r=n[0],u=jq("#filesGetExternalLink .toggle");u.toggleClass("off",r.ace_status==3);ASC.Files.Actions.clipGetExternalLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetExternalLink);ASC.Files.Actions.clipGetExternalLink=ASC.Clipboard.create(r.link,"filesGetExternalLink",{onComplete:function(){u.hasClass("off")&&ASC.Files.Actions.setAceFileLink();ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess);ASC.Files.Actions.clipGetExternalLink.fromToggleBtn||ASC.Files.Actions.hideAllActionPanels();ASC.Files.Actions.clipGetExternalLink.fromToggleBtn=!1}})},h=function(){ASC.Files.ServiceManager.setAceLink(ASC.Files.ServiceManager.events.SetAceFileLink,{showLoading:!0,fileId:ASC.Files.Actions.currentEntryData.entryId,share:jq("#filesGetExternalLink .toggle").hasClass("off")?ASC.Files.Constants.AceStatusEnum.Read:ASC.Files.Constants.AceStatusEnum.Restrict})},c=function(n,t,i){if(i){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#filesGetExternalLink .toggle").toggleClass("off");ASC.Files.Actions.currentEntryData.entryObject.toggleClass("__active",n)},l=function(n){jq("#buttonUnsubscribe, #buttonDelete, #buttonMoveto, #buttonCopyto, #buttonShare, #buttonMarkRead, #buttonSendInEmail, #buttonAddFaforite").hide();jq("#mainContentHeader .unlockAction").removeClass("unlockAction");var r=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").length,o=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.folder-row):has(.checkbox input:checked)").length,s=0;ASC.Files.Tree.displayFavorites()&&ASC.Files.Folders.folderContainer!="trash"&&(s=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.on-favorite):not(.folder-row):has(.checkbox input:checked)").length);var h=r,c=0,l=ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty(),a=0,u=!1,f=0;if(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=jq(this),t,i,r;(ASC.Files.UI.editingFile(n)||!ASC.Files.UI.accessDelete(n)||ASC.Files.UI.lockedForMe(n))&&h--;n.find(".is-new:visible").length>0&&c++;t=ASC.Files.UI.getObjectData(n);ASC.Files.ThirdParty?!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(t)?a++:l=!1:l=!1;u||n.hasClass("folder-row")||(i=t.title,r=ASC.Files.Utility.GetConvertFormats(i),u=r.length>0&&!t.encrypted&&t.content_length<=ASC.Files.Constants.AvailableFileSize);!ASC.Resources.Master.Personal&&n.is(":not(.without-share)")&&ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&(!t.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(t.title)&&ASC.Desktop&&ASC.Desktop.setAccess)&&f++}),r>0&&(jq("#buttonDownload, #buttonRemoveFavorite, #buttonRemoveTemplate, #buttonUnsubscribe, #buttonRestore, #buttonCopyto").show().find("span").html(r),jq("#mainDownload, #mainRemoveFavorite, #mainRemoveTemplate, #mainUnsubscribe, #mainRestore, #mainCopy").addClass("unlockAction"),ASC.Files.Folders.folderContainer=="privacy"&&jq("#buttonCopyto").hide(),ASC.Files.Folders.folderContainer!="forme"&&jq("#buttonUnsubscribe").hide(),ASC.Files.Folders.folderContainer=="favorites"?jq("#buttonMoveto").hide():jq("#buttonRemoveFavorite").hide(),ASC.Files.Folders.folderContainer=="templates"?jq("#buttonMoveto").hide():jq("#buttonRemoveTemplate").hide()),(o>0&&f>0||ASC.Files.Folders.folderContainer=="project"&&o>0)&&jq("#buttonSendInEmail").show().find("span").html(o),s>0?jq("#buttonAddFavorite").show().find("span").html(s):jq("#buttonAddFavorite").hide(),u?jq("#buttonConvert").show().find("span").html(r):jq("#buttonConvert").hide(),jq("#mainConvert").toggleClass("unlockAction",u),c>0&&(jq("#buttonMarkRead").show().find("span").html(c),jq("#mainMarkRead").addClass("unlockAction")),h>0&&(jq("#buttonDelete, #buttonMoveto").show().find("span").html(h-a),jq("#mainDelete, #mainMove").addClass("unlockAction")),ASC.Files.Folders.folderContainer=="trash"&&(jq("#buttonDelete, #buttonMoveto, #buttonCopyto, #buttonMarkRead").hide(),jq("#mainDelete, #mainMove, #mainCopy").removeClass("unlockAction")),jq("#buttonRestore, #buttonEmptyTrash").hide(),jq("#mainRestore, #mainEmptyTrash").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"?(r>0?(jq("#buttonDownload, #buttonDelete, #buttonRestore").show(),jq("#mainDownload, #mainDelete, #mainRestore").addClass("unlockAction")):(jq("#buttonDownload, #buttonConvert").hide(),jq("#mainDownload, #mainConvert").removeClass("unlockAction")),jq("#buttonEmptyTrash").show(),jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Folders.folderContainer!="project"&&f>0&&(jq("#buttonShare").show().find("span").html(f),jq("#mainShare").addClass("unlockAction")),l&&(jq("#buttonDelete, #buttonMoveto").hide(),jq("#mainDelete, #mainMove").removeClass("unlockAction")),typeof n!="undefined"){var e=jq.fixEvent(n),i=jq("#filesActionsPanel"),v=document.body.clientWidth-(e.pageX-pageXOffset+i.innerWidth())>0?0:i.innerWidth(),y=document.body.clientHeight-(e.pageY-pageYOffset+i.innerHeight())>0?0:i.innerHeight();i.css({top:e.pageY-y,left:e.pageX-v});i.toggle();t(i);ASC.Files.Mouse.disableHover=!0}},a=function(n,i){var e,f,r,u,h,s,c;if(ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink),e=jq.fixEvent(n),f=jq(e.srcElement||e.target),f.hasClass("active"))return ASC.Files.Actions.hideAllActionPanels(),!0;if(i=i||ASC.Files.UI.getObjectData(f),r=i.entryObject,r.is(".loading"))return!0;ASC.Files.Actions.currentEntryData=i;ASC.Files.UI.checkSelectAll(!1);ASC.Files.UI.selectRow(r,!0);ASC.Files.UI.updateMainContentHeader();var l=ASC.Files.UI.accessEdit(i,r),o=ASC.Files.UI.accessDelete(r),a=Teamlab.profile.isVisitor===!0;return jq("#actionPanelFolders, #actionPanelFiles").hide(),i.entryType==="file"?(jq("#filesOpen,                #filesGotoParent,                #filesEdit,                #filesByTemplate,                #filesConvert,                #filesDownload,                #filesGetLink,                #filesShareAccess,                #filesGetExternalLink,                #filesChangeOwner,                #filesSendInEmail,                #filesLock,                #filesUnlock,                #filesDocuSign,                #filesUnsubscribe,                #filesVersion,                #filesCompleteVersion,                #filesVersions,                #filesMove,                #filesMoveto,                #filesCopyto,                #filesCopy,                #filesMarkRead,                #filesAddFavorite,                #filesRemoveFavorite,                #filesAddTemplate,                #filesRemoveTemplate,                #filesRename,                #filesRestore,                #filesRemove").show().removeClass("display-none"),u=i.title,(!ASC.Files.Utility.GetConvertFormats(u).length||i.encrypted||i.content_length>ASC.Files.Constants.AvailableFileSize)&&jq("#filesConvert").hide().addClass("display-none"),ASC.Files.Utility.CanWebView(u)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(u)||typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(u,!0)||jq("#filesOpen").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.thirdpartyAvailable()&&jq.inArray(ASC.Files.Utility.GetFileExtension(u),ASC.Files.Constants.DocuSignFormats)!=-1&&!i.encrypted||jq("#filesDocuSign").hide(),(r.find("#contentVersions").length!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#filesVersions").hide().addClass("display-none"),h=ASC.Files.UI.editingFile(r),h&&(jq("#filesCompleteVersion,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()&&jq("#filesRename").hide()),r.hasClass("on-favorite")?jq("#filesAddFavorite").hide().addClass("display-none"):(jq("#filesRemoveFavorite").hide().addClass("display-none"),ASC.Files.Tree.displayFavorites()||jq("#filesAddFavorite").hide().addClass("display-none")),ASC.Files.Folders.folderContainer=="favorites"&&jq("#filesMoveto,                    #filesRemove").hide().addClass("display-none"),r.hasClass("is-template")?jq("#filesAddTemplate").hide().addClass("display-none"):(jq("#filesByTemplate, #filesRemoveTemplate").hide().addClass("display-none"),ASC.Files.Tree.displayTemplates()&&ASC.Files.Utility.CanBeTemplate(u)||jq("#filesAddTemplate").hide().addClass("display-none")),ASC.Files.Folders.folderContainer=="templates"&&jq("#filesMoveto,                    #filesRemove").hide().addClass("display-none"),s=ASC.Files.UI.lockedForMe(r),(!ASC.Files.UI.editableFile(i)||h&&(!ASC.Files.Utility.CanCoAuhtoring(u)||r.hasClass("on-edit-alone"))||s)&&jq("#filesEdit").hide().addClass("display-none"),i.encrypted&&jq("#filesEdit,                    #filesOpen,                    #filesGetLink,                    #filesGetExternalLink,                    #filesSendInEmail,                    #filesCompleteVersion,                    #filesLock,                    #filesUnlock,                    #filesAddTemplate,                    #filesCopyto,                    #filesCopy,                    #filesByTemplate,                    #filesAddFavorite").hide().addClass("display-none"),r.hasClass("file-locked")?jq("#filesLock").hide().addClass("display-none"):jq("#filesUnlock").hide().addClass("display-none"),ASC.Files.Folders.folderContainer=="trash"?jq("#filesOpen,                    #filesGotoParent,                    #filesEdit,                    #filesByTemplate,                    #filesGetLink,                    #filesShareAccess,                    #filesGetExternalLink,                    #filesSendInEmail,                    #filesCompleteVersion,                    #filesLock,                    #filesUnlock,                    #filesDocuSign,                    #filesVersions,                    #filesMoveto,                    #filesCopyto,                    #filesMarkRead,                    #filesAddFavorite,                    #filesRemoveFavorite,                    #filesAddTemplate,                    #filesRemoveTemplate,                    #filesRename").hide().addClass("display-none"):jq("#filesRestore").hide().addClass("display-none"),(!l||s)&&(jq("#filesCompleteVersion,                    #filesRename,                    #filesLock").hide().addClass("display-none"),ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my"||jq("#filesUnlock").hide().addClass("display-none")),a&&(jq("#filesByTemplate,                    #filesLock,                    #filesDocuSign,                    #filesCompleteVersion,                    #filesAddFavorite,                    #filesRemoveFavorite,                    #filesAddTemplate,                    #filesRemoveTemplate").hide().addClass("display-none"),o||jq("#filesRename").hide().addClass("display-none")),ASC.Files.Folders.folderContainer!="corporate"&&jq("#filesChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(i)&&jq("#filesChangeOwner,                    #filesCompleteVersion,                    #filesCopy").hide().addClass("display-none"),(!o||s)&&jq("#filesChangeOwner,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),r.is(".without-share *, .without-share")?(jq("#filesShareAccess").hide().addClass("display-none"),jq("#filesGetExternalLink").hide().addClass("display-none")):jq("#filesGetExternalLink").data("trial")&&!ASC.Files.Utility.CanWebView(u)&&jq("#filesGetExternalLink").hide().addClass("display-none"),r.find(".is-new:visible").length==0&&jq("#filesMarkRead").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&(ASC.Files.Folders.folderContainer!="privacy"||o)&&jq("#filesUnsubscribe").hide().addClass("display-none"),ASC.Files.UI.accessEdit()||jq("#filesCopy").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="favorites"&&ASC.Files.Folders.folderContainer!="templates"&&ASC.Files.Folders.folderContainer!="recent"&&(!ASC.Files.Filter||!ASC.Files.Filter.getFilterSettings().isSet||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#filesGotoParent").hide().addClass("display-none"),jq("#filesVersionPanel li:not(.display-none)").length||jq("#filesVersion").hide().addClass("display-none"),jq("#filesMovePanel li:not(.display-none)").length||jq("#filesMove").hide().addClass("display-none"),jq("#actionPanelFiles").show()):(jq("#foldersOpen,                #foldersGotoParent,                #foldersDownload,                #foldersGetLink,                #foldersShareAccess,                #foldersChangeOwner,                #foldersUnsubscribe,                #foldersMove,                #foldersMoveto,                #foldersCopyto,                #foldersMarkRead,                #foldersRename,                #foldersRestore,                #foldersRemove,                #foldersRemoveThirdparty,                #foldersChangeThirdparty").show().removeClass("display-none"),ASC.Files.Folders.folderContainer=="privacy"&&jq("#foldersCopyto").hide().addClass("display-none"),ASC.Files.Folders.folderContainer=="trash"?jq("#foldersOpen,                    #foldersGotoParent,                    #foldersGetLink,                    #foldersShareAccess,                    #foldersMove,                    #foldersMoveto,                    #foldersCopyto,                    #foldersMarkRead,                    #foldersRename").hide().addClass("display-none"):jq("#foldersRestore").hide().addClass("display-none"),l&&ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT||jq("#foldersRename,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="corporate"&&jq("#foldersChangeOwner").hide().addClass("display-none"),o||(jq("#foldersChangeOwner,                    #foldersMoveto,                    #foldersRemove,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),a&&jq("#foldersRename").hide().addClass("display-none")),r.is(".without-share *, .without-share")&&jq("#foldersShareAccess").hide().addClass("display-none"),r.find(".is-new:visible").length==0&&jq("#foldersMarkRead").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&jq("#foldersUnsubscribe").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(i)?(jq("#foldersChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty.isThirdParty()||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_SHARE?jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"):(ASC.Desktop&&jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"),i.create_by_id!=Teamlab.profile.id&&jq("#foldersChangeThirdparty").hide().addClass("display-none"),jq("#foldersRemove,                        #foldersMoveto").hide().addClass("display-none"),i.error&&jq("#foldersOpen,                            #foldersDownload,                            #foldersCopyto,                            #foldersRename").hide().addClass("display-none"))):jq("#foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),(!ASC.Files.Filter||!ASC.Files.Filter.getFilterSettings().isSet||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#foldersGotoParent").hide().addClass("display-none"),jq("#foldersMovePanel li:not(.display-none)").length||jq("#foldersMove").hide().addClass("display-none"),jq("#actionPanelFolders").show()),ASC.Clipboard.enable||jq("#filesGetLink, #foldersGetLink").remove(),c=jq("#filesActionPanel"),jq.showDropDownByContext(e,f,c,function(){ASC.Files.Mouse.disableHover=!0}),t(c),f.is(".menu-small")&&r.addClass("row-lonely-select"),!0},v=function(n){var r=jq.fixEvent(n),t,u,i,f;return typeof r=="undefined"||!r?!0:(t=jq(r.srcElement||r.target),t.is("input[type=text]"))?!0:t.parents(".studio-action-panel").length?!ASC.Desktop:(ASC.Files.Actions.hideAllActionPanels(),!t.parents("#filesMainContent").length)?!ASC.Desktop:(u=ASC.Files.UI.getObjectData(t),!u)?t.is("a[href]")?!0:!1:(i=u.entryObject,i.hasClass("new-folder")||i.hasClass("row-rename")||i.hasClass("error-entry"))?!0:(jq("#filesMainContent .row-hover").removeClass("row-hover"),jq("#filesMainContent .row-lonely-select").removeClass("row-lonely-select"),jq("#filesMainContent .menu-small").removeClass("active"),f=jq("#filesMainContent .file-row.row-selected").length,f>1&&i.hasClass("row-selected")?ASC.Files.Actions.showActionsViewPanel(n):ASC.Files.Actions.showActionsPanel(n,u),!1)},y=function(){ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);jq(".studio-action-panel:visible").hide();jq("#filesMainContent .file-row.row-lonely-select").removeClass("row-lonely-select");jq("#filesMainContent .file-row .menu-small").removeClass("active");ASC.Files.UI.hideEntryTooltip()},p=function(n,t){var f=ASC.Files.UI.getEntryObject("file",n),i,r,e,u;if(ASC.Files.UI.lockEditFile(f,!0),i=ASC.Files.Utility.GetFileWebEditorUrl(n),t&&t.location?t.location.href=i:t=window.open(i,"_blank"),r=function(){var t=n;t&&(ASC.Files.UI.lockEditFileById(t,!0),ASC.Files.UI.checkEditing(),ASC.Files.Socket.subscribeChangeEditors(t))},t==undefined)ASC.Files.UI.lockEditFile(f,!0),ASC.Files.Socket.subscribeChangeEditors(n),ASC.Files.UI.checkEditingDefer();else{try{t.onload=r;jq.browser.msie&&(u=function(){e=t.document.getElementsByTagName("body");e[0]==null?setTimeout(u,10):r()},u())}catch(o){}try{t.onunload=function(){n&&ASC.Files.UI.checkEditing()}}catch(o){}}return ASC.Files.Marker.removeNewIcon("file",n)},w=function(n){if(ASC.Files.Folders.isCopyTo=n===!0,ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer!="trash"&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.UI.accessEdit()){var t=jq.grep(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)"),function(n){return ASC.Files.UI.accessDelete(n)});if(!t.length){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}}if(ASC.Files.Tree.updateTreePath(),!n&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.on-edit):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}if(ASC.Files.ThirdParty&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.ThirdParty.isThirdParty()&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.third-party-entry):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(0));return}jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").length!=0&&(jq("#treeViewPanelSelector").removeClass("without-third-party"),jq("#treeViewPanelSelector").next().is("#mainContentHeader")||jq("#treeViewPanelSelector").insertBefore("#mainContentHeader"),ASC.Files.Tree.showSelect(ASC.Files.Folders.currentFolder.id),jq.dropdownToggle().toggle(".menuActionSelectAll","treeViewPanelSelector"),jq("#treeViewPanelSelector").scrollTo(jq("#treeViewPanelSelector").find(".tree-node"+ASC.Files.UI.getSelectorId(ASC.Files.Folders.currentFolder.id))),jq("body").bind("click",ASC.Files.Actions.registerHideTree))},b=function(n){jq(n.target?n.target:n.srcElement).parents().addBack().is("#treeViewPanelSelector, #foldersMoveto, #filesMoveto, #foldersCopyto, #filesCopyto,                 #foldersRestore, #filesRestore, #buttonMoveto, #buttonCopyto, #buttonRestore,                 #mainMove, #mainCopy, #mainRestore")||(ASC.Files.Actions.hideAllActionPanels(),jq("body").unbind("click",ASC.Files.Actions.registerHideTree))};return{init:i,showActionsViewPanel:l,showActionsPanel:a,onContextMenu:v,checkEditFile:p,hideAllActionPanels:y,clipGetLink:null,clipGetExternalLink:null,currentEntryData:null,showMoveToSelector:w,registerHideTree:b,setAceFileLink:h}}(),function(n){ASC.Files.Actions.init();n(function(){jq("#filesSelectAll").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(!0)});jq("#filesSelectFile, #filesSelectFolder, #filesSelectDocument,            #filesSelectPresentation, #filesSelectSpreadsheet, #filesSelectImage, #filesSelectMedia, #filesSelectArchive").click(function(){var n=this.id.replace("filesSelect","").toLowerCase();ASC.Files.UI.checkSelect(n)});jq("#filesDownload, #foldersDownload").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesRename, #foldersRename").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.rename(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesAddFavorite, #filesRemoveFavorite").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleFavorite(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesAddTemplate, #filesRemoveTemplate").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleTemplate(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesRemove, #foldersRemove").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesShareAccess, #foldersShareAccess").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.getSharedInfo(ASC.Files.Actions.currentEntryData.entryType+"_"+ASC.Files.Actions.currentEntryData.id,ASC.Files.Actions.currentEntryData.title)});jq("#filesGetExternalLink .toggle").click(function(n){jq(this).hasClass("off")?ASC.Files.Actions.clipGetExternalLink.fromToggleBtn=!0:(n.stopPropagation(),ASC.Files.Actions.setAceFileLink())});jq("#filesMarkRead, #foldersMarkRead").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Marker.markAsRead(ASC.Files.Actions.currentEntryData)});jq("#filesChangeOwner, #foldersChangeOwner").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.changeOwnerDialog(ASC.Files.Actions.currentEntryData)});jq("#filesSendInEmail").click(function(){ASC.Files.Actions.hideAllActionPanels();window.location.href=ASC.Mail.Utility.GetDraftUrl(ASC.Files.Actions.currentEntryData.entryId)});jq("#studioPageContent").on("click","#buttonSendInEmail",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.folder-row):has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return n.entryId});window.location.href=ASC.Mail.Utility.GetDraftUrl(n.get())});jq("#filesUnsubscribe, #foldersUnsubscribe").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesConvert").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesOpen").click(function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!1),!1});jq("#filesLock, #filesUnlock").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.lockFile(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesLock .toggle, #filesUnlock .toggle").click(function(n){n.stopPropagation();jq("#filesLock, #filesUnlock").toggle();ASC.Files.Folders.lockFile(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesCompleteVersion").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.versionComplete(ASC.Files.Actions.currentEntryData.id,0,!1)});jq("#filesVersions").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.showVersions(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesEdit").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!0)});jq("#filesByTemplate").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createNewDoc(ASC.Files.Actions.currentEntryData)});jq("#filesCopy").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createDuplicate(ASC.Files.Actions.currentEntryData)});jq("#foldersOpen").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFolder(ASC.Files.Actions.currentEntryData.id)});jq("#filesGotoParent, #foldersGotoParent").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFolder(ASC.Files.Actions.currentEntryData.folder_id)});jq("#foldersRemoveThirdparty").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showDeleteDialog(null,null,null,ASC.Files.Actions.currentEntryData.title,ASC.Files.Actions.currentEntryData)});jq("#foldersChangeThirdparty").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showChangeDialog(ASC.Files.Actions.currentEntryData)});jq("body").bind("contextmenu",function(n){return ASC.Files.Actions.onContextMenu(n)});jq("#filesMainContent").on("click",".menu-small",ASC.Files.Actions.showActionsPanel);jq("#studioPageContent").on("click","#buttonMoveto, #buttonCopyto, #buttonRestore,            #mainMove.unlockAction, #mainCopy.unlockAction, #mainRestore.unlockAction,            #filesMoveto, #filesRestore, #filesCopyto,            #foldersMoveto, #foldersRestore, #foldersCopyto",function(){ASC.Files.Actions.showMoveToSelector(this.id=="buttonCopyto"||this.id=="mainCopy"||this.id=="filesCopyto"||this.id=="foldersCopyto")});jq("#filesDocuSign").click(function(){return ASC.Files.ThirdParty.showDocuSignDialog(ASC.Files.Actions.currentEntryData),ASC.Files.Actions.hideAllActionPanels(),!1})})}(jQuery);
window.ASC.Files.Anchor=function(){var t=!1,n={error:new RegExp("^error(?:/(\\S+))?"),message:new RegExp("^message(?:/(\\S+))?"),preview:new RegExp("^preview(?:/|%2F)"+ASC.Files.Constants.entryIdRegExpStr),setting:new RegExp("^setting(?:=?(\\w+)?)?"),folder:new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr),help:new RegExp("^help(?:=(\\d+))?"),more:new RegExp("^more"),anyanchor:new RegExp("^(\\S+)?")},r=function(){t===!1&&(t=!0,ASC.Files.Folders&&(ASC.Controls.AnchorController.bind(n.anyanchor,u),ASC.Controls.AnchorController.bind(n.error,f),ASC.Controls.AnchorController.bind(n.message,e),ASC.Controls.AnchorController.bind(n.folder,s),ASC.Controls.AnchorController.bind(n.preview,h),ASC.Controls.AnchorController.bind(n.setting,l),ASC.Controls.AnchorController.bind(n.help,c),ASC.Controls.AnchorController.bind(n.more,o)))},u=function(t){n.error.test(t)||n.message.test(t)||n.preview.test(t)||n.setting.test(t)||n.folder.test(t)||n.help.test(t)||n.more.test(t)||ASC.Files.Anchor.defaultFolderSet()},f=function(n){ASC.Files.UI.displayInfoPanel(decodeURIComponent(n||ASC.Files.FilesJSResources.UnknownErrorText).replace(/\+/g," "),!0);jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},e=function(n){n.length&&ASC.Files.UI.displayInfoPanel(decodeURIComponent(n).replace(/\+/g," "));jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},o=function(){ASC.Files.UI.displayMoreFeaturs()},s=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));ASC.Files.Folders.currentFolder.id=ASC.Files.Common.isCorrectId(n)?n:"";ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.updateFolderView()},h=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));typeof ASC.Files.MediaPlayer!="undefined"?ASC.Files.MediaPlayer.init(n,{allowConvert:!0,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(n){ASC.Files.Marker.removeNewIcon("file",n);var t=ASC.Files.MediaPlayer.getPlayHash(n);ASC.Files.Anchor.move(t,!0)},downloadAction:ASC.Files.Utility.GetFileDownloadUrl,canDelete:function(n){var t=ASC.Files.UI.getEntryObject("file",n);return t.length<=0?!1:!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)?!1:!0},deleteAction:function(n,t){ASC.Files.Folders.deleteItem("file",n,t)}}):ASC.Files.Anchor.defaultFolderSet()},c=function(n){ASC.Files.UI.displayHelp(n)},l=function(n){switch(n){case"thirdparty":if(ASC.Files.ThirdParty)location.hash.indexOf("code")!=-1&&(ASC.Files.Folders.eventAfter=ASC.Files.ThirdParty.processAnchor),ASC.Files.ThirdParty.showSettingThirdParty();else{ASC.Files.Anchor.defaultFolderSet();return}break;case"admin":if(!ASC.Files.Constants.ADMIN){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.displayAdminSetting();break;default:ASC.Files.UI.displayCommonSetting()}ASC.Files.CreateMenu.disableMenu()},a=function(n,t){n=ASC.Files.Common.getCorrectHash(n);t?ASC.Controls.AnchorController.safemove(n):ASC.Controls.AnchorController.move(n)},i=function(n,t){ASC.Files.Common.isCorrectId(n)||(n=ASC.Files.Folders.currentFolder.id);jq("#filesMainContent .file-row").length&&(ASC.Files.UI.lastSelectedEntry=jq("#filesMainContent .file-row:has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return{entryType:n.entryType,entryId:n.entryId}}));ASC.Files.Anchor.move(n,t===!0)},v=function(n,t){ASC.Files.UI.resetSelectAll();ASC.Files.UI.amountPage=0;t=t===!0;ASC.Files.Common.isCorrectId(n)?(t&&ASC.Files.Folders.currentFolder.id==n||(ASC.Files.Folders.currentFolder.id=n,ASC.Files.Folders.folderContainer=""),i(null,t)):(ASC.Files.Folders.currentFolder.id="",ASC.Files.Folders.folderContainer=n,i(n,t))},y=function(){if(!ASC.Resources.Master.IsAuthenticated){location.reload(!0);return}ASC.Files.Tree&&(ASC.Files.Filter.clearFilter(!0),ASC.Files.Tree.folderIdCurrentRoot?ASC.Files.Folders.currentFolder.id!=ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Anchor.navigationSet(ASC.Files.Tree.folderIdCurrentRoot):ASC.Files.Constants.FOLDER_ID_MY_FILES?(ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_MY_FILES||ASC.Files.UI.isSettingsPanel())&&ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_MY_FILES):ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_COMMON_FILES))};return{init:r,move:a,navigationSet:v,defaultFolderSet:y,modulePath:"/Products/Files/"}}(),function(n){n(function(){var n=location.href.toLowerCase();(n.indexOf(ASC.Files.Anchor.modulePath.toLowerCase())!=-1||n.indexOf("/products/projects/tmdocs.aspx"))&&ASC.Files.Anchor.init()})}(jQuery);
window.ASC.Files.Folders=function(){var t=function(n,t){if(ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PRIVACY)if(ASC.Desktop&&ASC.Desktop.encryptionSupport())jq("#privacyForDesktop").remove();else{ASC.Files.EventHandler.onGetPrivacy();return}var i=ASC.Files.Filter.getFilterSettings();ASC.Files.ServiceManager.getFolderItems(ASC.Files.ServiceManager.events.GetFolderItems,{folderId:ASC.Files.Folders.currentFolder.id,from:n?jq('#filesMainContent .file-row[name!="addRow"]').length:0,count:t||ASC.Files.Constants.COUNT_ON_PAGE,append:n===!0,filter:i.filter,subjectGroup:i.subjectGroup,subjectId:i.subject,search:i.text,orderBy:i.sorter,withSubfolders:i.withSubfolders,searchInContent:i.searchInContent},{orderBy:i.sorter})},i=function(n,t){var r={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()},i=ASC.Files.Filter.getFilterSettings();ASC.Files.ServiceManager.getItems(ASC.Files.ServiceManager.events.GetItems,{parentFolderID:t,filter:i.filter,subjectGroup:i.subjectGroup,subjectId:i.subject,search:i.text},{stringList:r})},r=function(n){var t=ASC.Files.UI.getEntryObject("folder",n);if(ASC.Files.Folders.folderContainer!="trash"||!jq("#filesMainContent").find(t).is(":visible")){if(n==ASC.Files.Constants.FOLDER_ID_PROJECT&&ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT){location.href="TMDocs.aspx";return}ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(n)}},u=function(n,t,i){var e=n.entryObject,r,u,f;return ASC.Files.Folders.folderContainer=="trash"&&jq("#filesMainContent").find(e).is(":visible")?!1:(r=n.id,u=n.title||ASC.Files.UI.getEntryTitle("file",r),t!=!1&&(i=i||n.version||0),ASC.Files.Utility.CanWebView(u))?(ASC.Files.Utility.MustConvert(u)&&n.encrypted&&(t=!1),ASC.Files.Converter.checkCanOpenEditor(r,u,i,t!=!1)):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(u)?(f=ASC.Files.ImageViewer.getPreviewHash(r),ASC.Files.Anchor.move(f),!1):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(u,!0)?(f=ASC.Files.MediaPlayer.getPlayHash(r),ASC.Files.Anchor.move(f),!1):(location.href=ASC.Files.Utility.GetFileDownloadUrl(r,i),ASC.Files.Marker.removeNewIcon("file",r))},f=function(n){var t=jq(n).prop("checked");ASC.Files.ServiceManager.updateIfExist(ASC.Files.ServiceManager.events.UpdateIfExist,{value:t})},e=function(n,t){var i,u,r,f;n?(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),i=n):i=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)");u=[];i=i.filter(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryType,o=n.entryObject,i,f;return e=="file"&&(i=o.hasClass("on-favorite"),t!==!0||!i)?(r=i,f=n.entryId,u.push(f),!0):!1});i.toggleClass("on-favorite",!r);f=t!==!0&&r?Teamlab.removeFilesFavorites:Teamlab.addFilesFavorites;f({},{fileIds:u},function(){i.toggleClass("on-favorite",!r);ASC.Files.Folders.folderContainer=="favorites"&&(i.remove(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.checkEmptyContent())},{error:function(n,t){ASC.Files.UI.displayInfoPanel(t,!0)}})},o=function(n){var t,r,i,u;n?(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),t=n):t=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)");r=[];t.each(function(){var n=ASC.Files.UI.getObjectData(this),u=n.entryType,f=n.entryObject,t;u=="file"&&(t=n.entryId,r.push(t),i=f.hasClass("is-template"))});t.toggleClass("is-template",!i);u=i?Teamlab.removeFilesTemplates:Teamlab.addFilesTemplates;u({},{fileIds:r},function(){t.toggleClass("is-template",!i);var n=i?ASC.Files.FilesJSResources.InfoTemplateRemove:ASC.Files.FilesJSResources.InfoTemplateAdd;ASC.Files.UI.displayInfoPanel(n);ASC.Files.Folders.folderContainer=="templates"&&(t.remove(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.checkEmptyContent())},{error:function(n,t){ASC.Files.UI.displayInfoPanel(t,!0)}})},s=function(n,t,i){var r=[],f,u;if(!ASC.Files.Common.isCorrectId(t)){if(r=jq("#filesMainContent .file-row:has(.checkbox input:checked)"),r.length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.EmptyListSelectedForDownload,!0);return}r.length==1&&(f=ASC.Files.UI.getObjectData(r[0]),t=f.entryId,n=f.entryType)}if(n==="file"){ASC.Files.Marker.removeNewIcon(n,t);location.href=ASC.Files.Utility.GetFileDownloadUrl(t,i);return}if(ASC.Files.Folders.bulkStatuses==!0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecondDownload,!0);return}u=[];ASC.Files.Common.isCorrectId(t)?(u.push({Key:n+"_"+t,Value:""}),ASC.Files.Marker.removeNewIcon(n,t)):r.each(function(){var n=ASC.Files.UI.getObjectData(this);u.push({Key:n.entryType+"_"+n.entryId,Value:""});ASC.Files.Marker.removeNewIcon(n.entryType,n.entryId)});ASC.Files.Folders.bulkDownload(u)},h=function(n){ASC.Files.Folders.bulkStatuses=!0;ASC.Files.ServiceManager.download(ASC.Files.ServiceManager.events.Download,{doNow:!0},n)},n=function(){return'<div class="rename-action"><div class="button gray btn-action __apply name-aplly" title='+ASC.Files.FilesJSResources.TitleCreate+'><\/div><div class="button gray btn-action __reset name-cancel" title='+ASC.Files.FilesJSResources.TitleCancel+"><\/div><\/div>"},c=function(n,t){var i=jq(t||this).closest(".file-row");i.attr("name")?(i.remove(),jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen()):(i.removeClass("row-rename").find("#promptRename, .rename-action").remove(),ASC.Files.UI.selectRow(i,!0),ASC.Files.UI.updateMainContentHeader())},l=function(){var i,f,r,e,t,u;if(!ASC.Files.MediaPlayer||!ASC.Files.MediaPlayer.isView){if(!ASC.Files.UI.accessEdit()||ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecurityException,!0);return}if(jq(document).scrollTop(0),i=ASC.Files.UI.getEntryObject("folder","0"),i.length==0){var o={folder:{id:"0",title:ASC.Files.FilesJSResources.TitleNewFolder,access:0,shared:!1,isnew:0}},s=ASC.Files.Common.jsonToXml(o),h=ASC.Files.TemplateManager.translateFromString(s);ASC.Files.EmptyScreen.hideEmptyScreen();f=jq("#filesMainContent");f.prepend(h);jq("#filesMainContent .new-folder").yellowFade().removeClass("new-folder");i=ASC.Files.UI.getEntryObject("folder","0");i.addClass("row-rename");r=i.find(".entry-title .name a");e=ASC.Files.Utility.getFolderCssClass();i.find(".thumb-folder").addClass(e);t=document.createElement("input");t.id="promptCreateFolder";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptCreateFolder");t.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH);t.addClass("textEdit input-rename");t.val(ASC.Files.FilesJSResources.TitleNewFolder);t.insertAfter(r);t.show();r.hide();t.focus();jq.browser.mobile||t.select();ASC.Files.UI.checkCharacter(t);u=function(n,t){var r=jq(t||this).closest(".file-row"),i=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFolder").val().trim()),u;(i==""||i==null||ASC.Resources.Master.CustomMode&&i==="...")&&(i=ASC.Files.FilesJSResources.TitleNewFolder);r.find(".entry-title .name a").show().text(i);r.removeClass("row-rename");jq("#promptCreateFolder").remove();r.find(".rename-action").remove();u={parentFolderID:ASC.Files.Folders.currentFolder.id,title:i};ASC.Files.UI.blockObject(r,!0,ASC.Files.FilesJSResources.DescriptCreate);ASC.Files.ServiceManager.createFolder(ASC.Files.ServiceManager.events.CreateFolder,u)};i.append(n());i.find(".name-aplly").click(u);jq("#promptCreateFolder").bind("keydown",function(n){var t,i;if(jq("#promptCreateFolder").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:u(t,this)}}})}}},a=function(t,i){var e,f,u,h,o,c,l,s,r;if(!ASC.Files.MediaPlayer||!ASC.Files.MediaPlayer.isView){if(ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SecurityException,!0);return}if(e=function(n,t,i){var r=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER),u={folderID:n,fileTitle:t,templateId:i,winEditor:r};ASC.Files.ServiceManager.createNewFile(ASC.Files.ServiceManager.events.CreateNewFile,u)},!ASC.Files.UI.accessEdit()){t?e(null,t.title,t.entryId):e();return}if(jq(document).scrollTop(0),f=ASC.Files.UI.getEntryObject("file","0"),f.remove(),t)u=t.title;else switch(ASC.Files.Folders.typeNewDoc){case"document":u=ASC.Files.FilesJSResources.TitleNewFileText+ASC.Files.Utility.Resource.InternalFormats.Document;break;case"spreadsheet":u=ASC.Files.FilesJSResources.TitleNewFileSpreadsheet+ASC.Files.Utility.Resource.InternalFormats.Spreadsheet;break;case"presentation":u=ASC.Files.FilesJSResources.TitleNewFilePresentation+ASC.Files.Utility.Resource.InternalFormats.Presentation;break;default:return}if(ASC.Files.Utility.CanWebEdit(u)){var a={file:{id:"0",title:u,access:0,shared:!1,version:0,version_group:0}},v=ASC.Files.Common.jsonToXml(a),y=ASC.Files.TemplateManager.translateFromString(v);if(ASC.Files.EmptyScreen.hideEmptyScreen(),h=jq("#filesMainContent"),h.prepend(y),jq("#filesMainContent .new-file").show().yellowFade().removeClass("new-file"),f=ASC.Files.UI.getEntryObject("file","0"),o=function(n,i){var u=jq(i||this).closest(".file-row"),r=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFile").val().trim()),f=ASC.Files.UI.getObjectTitle(u),o,s;r==""||r==null||ASC.Resources.Master.CustomMode&&r==="..."?r=f:(o=ASC.Files.Utility.GetFileExtension(f).length,r+=f.substring(f.length-o));u.removeClass("row-rename");jq("#promptCreateFile").remove();u.find(".rename-action").remove();u.find(".entry-title .name a").show().text(r);s=u.find(".entry-title .name a");ASC.Files.UI.highlightExtension(s,r);ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResources.DescriptCreate);e(ASC.Files.Folders.currentFolder.id,r,t?t.entryId:null)},i){o(null,f);return}f.addClass("row-rename");c=f.find(".entry-title .name a");l=ASC.Files.Utility.getCssClassByFileTitle(u);f.find(".thumb-file").addClass(l);s=ASC.Files.Utility.GetFileExtension(u).length;u=u.substring(0,u.length-s);r=document.createElement("input");r.id="promptCreateFile";r.type="text";r.style.display="none";document.body.appendChild(r);r=jq("#promptCreateFile");r.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-s);r.addClass("textEdit input-rename");r.val(u);r.insertAfter(c);r.show().focus();jq.browser.mobile||r.select();ASC.Files.UI.checkCharacter(r);f.append(n());f.find(".name-aplly").click(o);jq("#promptCreateFile").bind("keydown",function(n){var t,i;if(jq("#promptCreateFile").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this)}}});jq("#promptCreateFile").bind("keypress",function(n){var t,i;if(jq("#promptCreateFile").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.enter:o(t,this)}}})}}},v=function(n,t,i,r,u,f){Teamlab.updateFileStream({fileId:n,encrypted:!!r,forcesave:!!f},i,{success:function(){(ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ReplaceVersion,{fileId:n,show:!0,isStringXml:!1}),f)||(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(t)),ASC.Files.Actions.checkEditFile(n,u))},error:function(n,t){u&&u.close();ASC.Files.UI.displayInfoPanel(t[0],!0)}})},y=function(t,i){var u=ASC.Files.UI.getEntryObject(t,i),e,f,r,o;ASC.Files.Folders.folderContainer=="trash"||!ASC.Files.UI.accessEdit(null,u)||ASC.Files.UI.lockedForMe(u)||!ASC.Files.UI.accessDelete(u)&&Teamlab.profile.isVisitor===!0||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||t==="file"&&ASC.Files.UI.editingFile(u)&&ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()||(e=0,jq("#promptRename").length!=0&&jq("#filesMainContent .file-row.row-rename .name-cancel").click(),u.find("#contentVersions").length&&ASC.Files.Folders.closeVersions(),u.addClass("row-rename"),ASC.Files.UI.selectRow(u,!1),ASC.Files.UI.updateMainContentHeader(),f=ASC.Files.UI.getObjectTitle(u),t=="file"&&(e=ASC.Files.Utility.GetFileExtension(f).length,f=f.substring(0,f.length-e)),r=document.createElement("input"),r.id="promptRename",r.type="text",r.style.display="none",document.body.appendChild(r),r=jq("#promptRename"),r.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-e),r.addClass("textEdit input-rename"),r.val(f),r.insertAfter(u.find(".entry-title .name a")),r.show().focus(),jq.browser.mobile||r.select(),ASC.Files.UI.checkCharacter(r),o=function(){var r=ASC.Files.UI.getObjectData(jq("#promptRename")),t=r.entryObject,u=r.entryType,f=r.entryId,i=ASC.Files.UI.getObjectTitle(t),n=ASC.Files.Common.replaceSpecCharacter(jq("#promptRename").val().trim()),e,o;if(n==""||n==null||ASC.Resources.Master.CustomMode&&n==="..."){ASC.Files.UI.selectRow(t,!0);ASC.Files.UI.updateMainContentHeader();return}if(t.removeClass("row-rename"),t.find(".rename-action").remove(),jq("#promptRename").remove(),u=="file"&&(e=ASC.Files.Utility.GetFileExtension(i).length,n+=i.substring(i.length-e)),n==i){ASC.Files.UI.selectRow(t,!0);ASC.Files.UI.updateMainContentHeader();return}t.find(".entry-title .name a").show().text(n);u=="file"&&(o=t.find(".entry-title .name a"),ASC.Files.UI.highlightExtension(o,n));ASC.Files.UI.blockObject(t,!0,ASC.Files.FilesJSResources.DescriptRename);u=="file"?ASC.Files.ServiceManager.renameFile(ASC.Files.ServiceManager.events.FileRename,{fileId:f,name:i,newname:n,show:!0}):ASC.Files.ServiceManager.renameFolder(ASC.Files.ServiceManager.events.FolderRename,{parentFolderID:ASC.Files.Folders.currentFolder.id,folderId:f,name:i,newname:n})},u.append(n()),u.find(".name-aplly").click(o),u.removeClass("row-selected"),jq("#promptRename").bind("keydown",function(n){var t,i;if(jq("#promptRename").length!==0&&(t||(t=n),i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.esc||i==ASC.Files.Common.keyCode.enter)&&jq("#promptRename").length!=0))switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:o()}}))},p=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!ASC.Files.UI.lockedForMe(n)||ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")){var i=n.hasClass("file-locked");n.toggleClass("file-locked",!i);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.lockFile(ASC.Files.ServiceManager.events.LockFile,{fileId:t,lock:!i,fileObj:n})}},w=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!n.hasClass("folder-row"))){if(jq("#contentVersions:visible").length!=0){var i=n.find("#contentVersions").length!=0;if(ASC.Files.Folders.closeVersions(),i)return}ASC.Files.UI.blockObject(n,!0,ASC.Files.FilesJSResources.DescriptLoadVersion);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.getFileHistory(ASC.Files.ServiceManager.events.GetFileHistory,{fileId:t})}},b=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#contentVersions .version-row[data-version-group='"+n+"']:not(.version-group-head)").toggle()},k=function(n,t){jq(".version-operation").css("visibility","hidden");ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResources.DescriptSetVersion);ASC.Files.ServiceManager.setCurrentVersion(ASC.Files.ServiceManager.events.SetCurrentVersion,{fileId:n,version:t})},d=function(n,t,i){return ASC.Files.Actions.hideAllActionPanels(),jq(".version-operation").css("visibility","hidden"),ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResources.DescriptCompleteVersion),ASC.Files.ServiceManager.completeVersion(ASC.Files.ServiceManager.events.CompleteVersion,{fileId:n,version:t,continueVersion:i}),!1},g=function(){var r,t,f;if(ASC.Files.Actions.hideAllActionPanels(),r=jq(this).closest(".file-row"),!ASC.Files.UI.accessEdit(null,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r))return!0;var e=jq(this).closest(".version-row"),i=e.find(".version-comment"),u=i.attr("data-comment");ASC.Files.Folders.eraseComment();i.empty();e.addClass("version-row-comment");i.attr("colspan",4);t=document.createElement("input");t.id="promptVersionComment";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptVersionComment");t.attr("maxlength",255);t.attr("placeholder",ASC.Files.FilesJSResources.EnterComment);t.addClass("textEdit input-rename");t.val(u);i.append(t);t.show();t.focus();jq.browser.mobile||t.select();f=function(){var n=jq("#promptVersionComment");i=n.closest(".version-comment");u=i.attr("data-comment");var r=ASC.Files.UI.getObjectData(i).id,f=i.closest(".version-row").attr("data-version"),t=n.val().trim();t!=u&&ASC.Files.ServiceManager.updateComment(ASC.Files.ServiceManager.events.UpdateComment,{fileId:r,version:f,comment:t});ASC.Files.Folders.eraseComment()};i.append(n());i.find(".name-aplly").click(f);jq("#promptVersionComment").bind("keydown",function(n){var t,i;if(jq("#promptVersionComment").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.eraseComment();break;case ASC.Files.Common.keyCode.enter:f()}}});jq(document).on("click.Comment",function(n){n=jq.fixEvent(n);jq(n.target||n.srcElement).is(".version-comment:has(#promptVersionComment) *")||(ASC.Files.Folders.eraseComment(),jq(document).off("click.Comment"))});return!1},nt=function(){var n=jq(".version-row-comment .version-comment").attr("data-comment");jq(".version-row-comment .version-comment").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>").removeAttr("colspan");jq(".version-row-comment").removeClass("version-row-comment")},tt=function(){jq("#contentVersions").remove();jq(".file-row-fix").removeClass("file-row-fix")},it=function(n,t){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ReplaceVersion,{fileId:n,show:t,isStringXml:!1})},rt=function(n,t,i,r,u){var e=ASC.Files.UI.getEntryTitle("folder",t)||(ASC.Files.Tree?ASC.Files.Tree.getFolderTitle(t):""),o,s,f;if(u.length>1){for(s="",f=0;f<u.length;f++)s+='<li title="{0}">{0}<\/li>'.format(u[f].Value);jq("#overwriteList").html(s);jq("#overwriteListShow").show();o=ASC.Files.FilesJSResources.FilesAlreadyExist.format(u.length,'<b title="'+e+'">'+e+"<\/b>")}else jq("#overwriteListShow").hide(),o=ASC.Files.FilesJSResources.FileAlreadyExist.format('<span title="'+u[0].Value+'">'+u[0].Value+"<\/span>",'<b title="'+e+'">'+e+"<\/b>");jq("#overwriteList, #overwriteListHide").hide();jq("#overwriteMessage").html(o);jq("#buttonConfirmResolve").unbind("click").click(function(){var e=jq(".overwrite-resolve input:checked").val(),i;if(e==ASC.Files.Constants.ConflictResolveType.Skip){for(f=0;f<u.length;f++)ASC.Files.UI.blockObjectById("file",u[f].Key,!1,null,!0),i=jq.inArray("file_"+u[f].Key,n.entry),i!=-1&&n.entry.splice(i,1);ASC.Files.UI.updateMainContentHeader()}PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t,resolve:e,isCopyOperation:r==!0,doNow:!0},{stringList:n})});jq("#buttonCancelOverwrite").unbind("click").click(function(){for(f=0;f<n.entry.length;f++){var t=ASC.Files.UI.parseItemId(n.entry[f]);ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!1,null,!0)}ASC.Files.UI.updateMainContentHeader();PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#confirmOverwriteFiles",465);PopupKeyUpActionProvider.EnterAction='jq("#buttonConfirmResolve").click();';PopupKeyUpActionProvider.CloseDialogAction='jq("#buttonCancelOverwrite").click();'},ut=function(n,t,i,r){var f;if(ASC.Files.Actions.hideAllActionPanels(),n===ASC.Files.Folders.currentFolder.entryId){ASC.Files.Folders.isCopyTo=!1;return}if(f=typeof ASC.Files.ThirdParty!="undefined",!r&&!ASC.Files.Folders.isCopyTo&&f&&ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isDifferentThirdParty(n,ASC.Files.Folders.currentFolder.entryId)){ASC.Files.ThirdParty.showMoveThirdPartyMessage(n,t,i);return}var o=f&&(ASC.Files.Folders.isCopyTo==!0||ASC.Files.ThirdParty.isThirdParty()),e=!1,u={};u.entry=[];jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),r=n.entryType,t=n.entryObject,s=n.entryId;ASC.Files.Folders.isCopyTo!=!0&&(ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t))||(ASC.Files.Folders.isCopyTo!=!1||ASC.Files.UI.accessDelete(t)?r=="folder"&&jq.inArray(s,i)!=-1?ASC.Files.UI.displayInfoPanel(ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResources.InfoFolderCopyError:ASC.Files.FilesJSResources.InfoFolderMoveError,!0):!o&&f&&ASC.Files.ThirdParty.isThirdParty(n)||(ASC.Files.UI.blockObject(t,!0,ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResources.DescriptCopy:ASC.Files.FilesJSResources.DescriptMove,!0),u.entry.push(r+"_"+s)):e=!0)});e&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveAccessError,!0);ASC.Files.UI.updateMainContentHeader();u.entry&&u.entry.length!=0&&ASC.Files.ServiceManager.moveFilesCheck(ASC.Files.ServiceManager.events.MoveFilesCheck,{folderToTitle:t,folderToId:n,list:u,isCopyOperation:ASC.Files.Folders.isCopyTo==!0},{stringList:u});ASC.Files.Folders.isCopyTo=!1},ft=function(n){var t={};t.entry=[];jq(n).each(function(n,i){t.entry.push(i.entryType+"_"+i.id)});ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:ASC.Files.Folders.currentFolder.entryId,resolve:2,isCopyOperation:!0,doNow:!0},{stringList:t})},et=function(){jq("#pageNavigatorHolder:visible").length!=0&&jq("#pageNavigatorHolder a").text()!=ASC.Files.FilesJSResources.ButtonShowMoreLoad&&(jq("#pageNavigatorHolder a").text(ASC.Files.FilesJSResources.ButtonShowMoreLoad),ASC.Files.Folders.getFolderItems(!0))},ot=function(n){jq("#ownerSelector .change-owner-selector").text(n.create_by);jq("#ownerSelector").attr("data-id",n.create_by_id).useradvancedSelector("reset").useradvancedSelector("disable",[n.create_by_id]);jq("#changeOwnerTitle").text(n.title);jq("#buttonSaveChangeOwner").addClass("disable");jq("#changeOwner").off("click").on("click","#buttonSaveChangeOwner:not(.disable)",function(){var t=jq("#ownerSelector").attr("data-id");PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.changeOwner([n.entryType+"_"+n.entryId],t)});PopupKeyUpActionProvider.EnterAction='jq("#buttonSaveChangeOwner").click();';ASC.Files.UI.blockUI("#changeOwner",420)},st=function(n,t){var i={entry:n};ASC.Files.ServiceManager.changeOwner(ASC.Files.ServiceManager.events.ChangeOwner,{list:n,userId:t,parentFolderID:ASC.Files.Folders.currentFolder.id},{stringList:i})},ht=function(){ASC.Files.Folders.folderContainer=="trash"&&(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!0),jq("#confirmRemoveText").html(ASC.Files.FilesJSResources.ConfirmEmptyTrash),jq("#confirmRemoveList").hide(),jq("#confirmRemoveTextDescription").show(),jq("#removeConfirmBtn").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialog();ASC.Files.ServiceManager.emptyTrash(ASC.Files.ServiceManager.events.EmptyTrash,{doNow:!0})}),ASC.Files.UI.blockUI("#confirmRemove",420),PopupKeyUpActionProvider.EnterAction='jq("#removeConfirmBtn").click();')},ct=function(n,t,i){var o,r,e,u,c,l,f,a;if(ASC.Files.Actions.hideAllActionPanels(),o=ASC.Files.FilesJSResources.ConfirmRemoveList,r=[],n&&t){if(e=ASC.Files.UI.getEntryObject(n,t),!ASC.Files.UI.accessDelete(e)||ASC.Files.UI.editingFile(e)||ASC.Files.UI.lockedForMe(e))return;r.push({entryType:n,entryId:t})}else jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryObject,i=n.entryType,u=n.entryId;if(ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(n))return!0;!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)||r.push({entryType:i,entryId:u})});if(r.length!=0){r.length==1&&(o=r[0].entryType=="file"?ASC.Files.FilesJSResources.ConfirmRemoveFile:ASC.Files.FilesJSResources.ConfirmRemoveFolder);var s="",h="",v='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';for(u=0;u<r.length;u++)c=ASC.Files.UI.getEntryTitle(r[u].entryType,r[u].entryId),r[u].entryType=="file"?h+=v.format(c,r[u].entryType,r[u].entryId):s+=v.format(c,r[u].entryType,r[u].entryId);jq("#confirmRemoveText").html(o);jq("#confirmRemoveList dd.confirm-remove-files").html(h);jq("#confirmRemoveList dd.confirm-remove-folders").html(s);jq("#confirmRemoveList .confirm-remove-folders, #confirmRemoveList .confirm-remove-files").show();s==""&&jq("#confirmRemoveList .confirm-remove-folders").hide();h==""&&jq("#confirmRemoveList .confirm-remove-files").hide();l=function(){jq("#confirmRemoveList .confirm-remove-folders-count").text(jq("#confirmRemoveList dd.confirm-remove-folders :checked").length);jq("#confirmRemoveList .confirm-remove-files-count").text(jq("#confirmRemoveList dd.confirm-remove-files :checked").length)};l();jq("#confirmRemoveList dd [type='checkbox']").change(l);f=jq(".files-content-panel").attr("data-deleteConfirm");jq("#cbxDeleteConfirm").length&&(f=jq("#cbxDeleteConfirm").prop("checked")==!0);ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()?(f=!0,jq("#confirmRemoveSharpBoxTextDescription").show()):jq("#confirmRemoveSharpBoxTextDescription").hide();ASC.Files.Folders.folderContainer=="trash"||ASC.Files.Folders.folderContainer=="privacy"?(f=!0,jq("#confirmRemoveTextDescription").show()):jq("#confirmRemoveTextDescription").hide();a=function(){PopupKeyUpActionProvider.CloseDialog();var n={},t=jq("#confirmRemoveList input:checked");t.length!=0&&(n.entry=jq(t).map(function(n,t){var i=jq(t).attr("entryType"),r=jq(t).attr("entryId"),u=ASC.Files.UI.getEntryObject(i,r);return ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResources.DescriptRemove,!0),i+"_"+r}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.deleteItem(ASC.Files.ServiceManager.events.DeleteItem,{list:n.entry,doNow:!0},{stringList:n}),typeof i=="function"&&i())};f?(jq("#removeConfirmBtn").unbind("click").click(a),ASC.Files.UI.blockUI("#confirmRemove",420),PopupKeyUpActionProvider.EnterAction='jq("#removeConfirmBtn").click();'):a()}},lt=function(){ASC.Files.Folders.bulkStatuses=!1;ASC.Files.UI.setProgressValue("#tasksProgress",0);jq("#tasksProgress .asc-progress-percent").text("0%");jq("#tasksProgress .progress-dialog-header span").text("");jq("#tasksProgress").hide()},at=function(){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.ServiceManager.terminateTasks(ASC.Files.ServiceManager.events.TerminateTasks,{isTerminate:!0,doNow:!0})},vt=function(n){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.Folders.tasksTimeout=setTimeout(function(){ASC.Files.ServiceManager.getTasksStatuses(ASC.Files.ServiceManager.events.GetTasksStatuses,{doNow:!1})},ASC.Files.Constants.REQUEST_STATUS_DELAY/(n===!0?8:1))},yt=function(n){ASC.Files.ServiceManager.getTemplates(ASC.Files.ServiceManager.events.GetTemplates,{filter:ASC.Files.Constants.FilterType.None,from:n?jq("#filesTemplateList .file-row").length:0,count:ASC.Files.Constants.COUNT_ON_PAGE,append:n===!0,subjectGroup:!1,subjectId:"",search:"",searchInContent:!1})};return{eventAfter:null,currentFolder:{},folderContainer:"",isCopyTo:!1,cancelEnter:c,createFolder:l,replaceVersion:it,lockFile:p,showVersions:w,closeVersions:tt,toggleVersionSublist:b,makeCurrentVersion:k,enterComment:g,eraseComment:nt,versionComplete:d,showOverwriteMessage:rt,curItemFolderMoveTo:ut,createDuplicate:ft,changeOwnerDialog:ot,changeOwner:st,rename:y,deleteItem:ct,emptyTrash:ht,toggleFavorite:e,toggleTemplate:o,getFolderItems:t,getItems:i,clickOnFolder:r,clickOnFile:u,updateIfExist:f,showMore:et,createNewDoc:a,typeNewDoc:"",replaceFileStream:v,getTemplateList:yt,download:s,bulkDownload:h,getTasksStatuses:vt,cancelTasksStatuses:lt,terminateTasks:at,tasksTimeout:null,bulkStatuses:!1,isFirstLoad:!0}}(),function(n){n(function(){jq("#pageNavigatorHolder a").click(function(){return ASC.Files.Folders.showMore(),!1});jq("#topNewFolder a").click(function(){ASC.Files.Folders.createFolder()});jq("#buttonDelete, #mainDelete").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem()});jq("#buttonEmptyTrash, #mainEmptyTrash").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.emptyTrash()});jq("#studioPageContent").on("click","#buttonDownload, #mainDownload.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download()});jq("#filesSelectAllCheck").click(function(n){n.stopPropagation();ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(jq("#filesSelectAllCheck").prop("checked")==!0);jq(this).blur()});jq("#filesMainContent").on("click",".file-lock",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.lockFile(this),!1});jq("#filesMainContent").on("click",".favorite",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.toggleFavorite(this),!1});jq("#filesMainContent").on("click",".template-action",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this);return n.id!=0&&ASC.Files.Folders.createNewDoc(n),!1});jq("#filesTemplatesPanel").on("click",function(){ASC.Files.Actions.hideAllActionPanels()});jq("#filesTemplatesPanel").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this);return n.id!=0&&ASC.Files.Folders.createNewDoc(n),!1});jq("#buttonRemoveFavorite, #mainRemoveFavorite, #buttonAddFavorite").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleFavorite(null,this.id=="buttonAddFavorite")});jq("#buttonRemoveTemplate, #mainRemoveTemplate").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleTemplate()});jq("#filesMainContent").on("click",".version",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.showVersions(this),!1});jq("#filesMainContent").on("click",".version-close",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.closeVersions(),!1});jq("#filesMainContent").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(n){if(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1;var t=ASC.Files.UI.getObjectData(this).id;return t!=0&&ASC.Files.Folders.clickOnFolder(t),!1});jq(".to-parent-folder, .empty-folder-toparent").on("click",function(){var n=jq(this).attr("data-id");return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesMainContent").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){if(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1;var t=ASC.Files.UI.getObjectData(this);return t.id!=0&&(t.entryObject.hasClass("is-template")?ASC.Files.Folders.createNewDoc(t):ASC.Files.Folders.clickOnFile(t)),!1});jq("#filesMainContent").on("mouseup",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){var t,i,r;return n.which==2&&(t=ASC.Files.UI.getObjectData(this),t.id!=0&&(i=t.title||ASC.Files.UI.getEntryTitle("file",t.id),!ASC.Files.Utility.MustConvert(i)&&(ASC.Files.Utility.CanWebView(i)||ASC.Files.Utility.CanWebEdit(i))&&(r=t.entryObject,ASC.Files.UI.lockEditFile(r,!0),ASC.Files.Socket.subscribeChangeEditors(t.id),ASC.Files.UI.checkEditingDefer(),ASC.Files.Actions.hideAllActionPanels()))),!0});jq("#filesMainContent").on("click","#contentVersions",function(){return!1});jq("#filesMainContent").on("click",".version-comment:not(:has(input)):not(:has(.version-comment-fix:empty)), .version-comment-edit",ASC.Files.Folders.enterComment);jq("#filesMainContent").on("click",".version-complete, .version-continue",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version"),i=jq(this).hasClass("version-continue");ASC.Files.Folders.versionComplete(n,t,i)});jq("#filesMainContent").on("click",".version-group-head .version-sublist-toggle",function(){var n=jq(this).closest(".version-row").attr("data-version-group");return ASC.Files.Folders.toggleVersionSublist(n),!1});jq("#filesMainContent").on("click",".version-preview",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this),t=jq(this).closest(".version-row").attr("data-version")||0;return ASC.Files.Folders.clickOnFile(n,!1,t),!1});jq("#filesMainContent").on("click",".version-download",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.download("file",n,t),!1});jq("#filesMainContent").on("click",".version-restore span",function(){var n=ASC.Files.UI.getObjectData(this).id,t=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.makeCurrentVersion(n,t),!1});jq("#filesMainContent").on("click",".version-comment .name-cancel",ASC.Files.Folders.eraseComment);jq("#filesMainContent").on("click",".file-row > .rename-action > .name-cancel",function(n){return ASC.Files.Folders.cancelEnter(n,this),!1});jq(".overwrite-resolve").on("click","input",function(){jq(".overwrite-resolve.selected").removeClass("selected");jq(this).closest(".overwrite-resolve").addClass("selected")});jq("#overwriteListShow").click(function(){jq("#overwriteList, #overwriteListHide").show();jq("#overwriteListShow").hide()});jq("#overwriteListHide").click(function(){jq("#overwriteListShow").show();jq("#overwriteList, #overwriteListHide").hide()});jq("#cbxDeleteConfirm").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.changeDeleteConfrim(ASC.Files.ServiceManager.events.ChangeDeleteConfrim,{value:n===!0}),!1});jq("#cbxFavorites").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayFavorites(n,{success:function(n,t){ASC.Files.Tree.displayFavorites(t===!0);jq("#cbxFavorites").prop("checked",ASC.Files.Tree.displayFavorites())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#cbxRecent").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayRecent(n,{success:function(n,t){ASC.Files.Tree.displayRecent(t===!0);jq("#cbxRecent").prop("checked",ASC.Files.Tree.displayRecent())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#cbxTemplates").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayTemplates(n,{success:function(n,t){ASC.Files.Tree.displayTemplates(t===!0);ASC.Files.CreateMenu.toggleCreateByTemplate(t===!0);jq("#cbxTemplates").prop("checked",ASC.Files.Tree.displayTemplates())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#ownerSelector").useradvancedSelector({inPopup:!0,itemsChoose:[],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,t){jq(this).attr("data-id",t.id).find(".change-owner-selector").html(t.title);jq("#buttonSaveChangeOwner").removeClass("disable");jq("#ownerSelector").useradvancedSelector("reset");jq("#ownerSelector").useradvancedSelector("disable",[t.id])});jq(".update-if-exist").change(function(){ASC.Files.Folders.updateIfExist(this)});jq("#cbxForcesave").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.forcesave(ASC.Files.ServiceManager.events.Forcesave,{value:n===!0}),!1});jq("#cbxStoreForcesave").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.storeForcesave(ASC.Files.ServiceManager.events.StoreForcesave,{value:n===!0}),!1});typeof ASC.Files.Share=="undefined"&&jq("#files_shareaccess_folders, #filesShareAccess,                #filesUnsubscribe, #foldersUnsubscribe").remove();jq(window).scroll(function(){return ASC.Files.UI.stickContentHeader(),ASC.Files.UI.trackShowMore(!1),!0});jq(".mainPageContent").scroll(function(){return ASC.Files.UI.trackShowMore(!0),!0});jq("#filesTemplateList").scroll(function(){ASC.Files.UI.trackShowMoreTemplates()});ASC.Files.Folders.eventAfter=function(){ASC.Files.Folders.isFirstLoad?(ASC.Files.Folders.isFirstLoad=!1,jq("#emptyContainer").is(":visible")||jq(".advansed-filter").advansedFilter("resize")):LoadingBanner.hideLoading()};ASC.Files.Folders.isFirstLoad||LoadingBanner.displayLoading();jq.browser.msie&&setInterval(function(){ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title)},200)})}(jQuery);
window.ASC.Files.EventHandler=function(){var r=!1,t=null,f=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.EventHandler.onGetFolderItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetItems,ASC.Files.EventHandler.onGetItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CheckEditing,ASC.Files.EventHandler.onCheckEditing),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.LockFile,ASC.Files.EventHandler.onLockFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateIfExist,ASC.Files.EventHandler.onUpdateIfExist),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.EventHandler.onGetHelpCenter),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateFolder,ASC.Files.EventHandler.onCreateFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateNewFile,ASC.Files.EventHandler.onCreateNewFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FolderRename,ASC.Files.EventHandler.onRenameFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FileRename,ASC.Files.EventHandler.onRenameFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeOwner,ASC.Files.EventHandler.onChangeOwner),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.EventHandler.onGetFileHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetCurrentVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CompleteVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ReplaceVersion,ASC.Files.EventHandler.onGetFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateComment,ASC.Files.EventHandler.onUpdateComment),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveFilesCheck,ASC.Files.EventHandler.onMoveFilesCheck),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTemplates,ASC.Files.EventHandler.onGetTemplates),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveItems,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteItem,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.EmptyTrash,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.Download,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.TerminateTasks,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTasksStatuses,ASC.Files.EventHandler.onGetTasksStatuses))},e=function(t,i,r){var u,f,e;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.Tree&&ASC.Files.Tree.resetFolder(ASC.Files.Tree.getParentId(i.folderId));ASC.Files.Anchor.defaultFolderSet();return}if(!o(t.getElementsByTagName("folder_info")[0])){ASC.Files.Anchor.defaultFolderSet();return}if(!s(t.getElementsByTagName("path_parts")[0])){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.Marker&&ASC.Files.Marker.markRootAsNew(t.getElementsByTagName("root_folders_id_marked_as_new")[0]);u=t.getElementsByTagName("total")[0];ASC.Files.UI.countTotal=parseInt(u.text||u.textContent)||0;i.append||(jq("#filesMainContent").empty(),jq(document).scrollTop(0));f=ASC.Files.TemplateManager.translate(t);n(f);f!==""&&ASC.Files.Filter&&(e=ASC.Files.Filter.getFilterSettings()).isSet?(jq("#filesBreadCrumbs").is(":visible")||(jq("#filesBreadCrumbs").show(),jq(".to-parent-folder").hide()),jq("#filesBreadCrumbs").addClass("with-search-crumbs"),jq("#searchBreadCrumbs").attr("data-id",ASC.Files.Folders.currentFolder.id).attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)).attr("title",ASC.Files.Folders.currentFolder.title).text(ASC.Files.Folders.currentFolder.title),jq("#searchBreadCrumbsSub").toggle(e.withSubfolders&&(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty()))):jq("#filesBreadCrumbs").removeClass("with-search-crumbs");jq(ASC.Files.UI.lastSelectedEntry).each(function(){var n=ASC.Files.UI.getEntryObject(this.entryType,this.entryId);ASC.Files.UI.selectRow(n,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null);ASC.Files.CreateMenu&&ASC.Files.CreateMenu.disableMenu(ASC.Files.UI.accessEdit());ASC.Files.UI.stickContentHeader()},n=function(n,t){var f,i,r,u,e,o;return ASC.Files.UI.resetSelectAll(),ASC.Files.EmptyScreen.hideEmptyScreen(),n==""?t||ASC.Files.EmptyScreen.displayEmptyScreen():(t?t.length?(f=t.hasClass("row-selected")||t.attr("data-selected")=="true",t.after(n),i=t.next(),t.remove()):(jq("#filesMainContent").prepend(n),i=jq('#filesMainContent .file-row[name="addRow"]')):(jq("#filesMainContent").append(n),i=jq("#filesMainContent .file-row:gt(-"+(ASC.Files.Constants.COUNT_ON_PAGE+1)+")")),jq('#filesMainContent .file-row[name="addRow"]').each(function(){var n=ASC.Files.UI.getObjectData(this),t=ASC.Files.UI.getEntryObject(n.entryType,n.id);t.filter('[name!="addRow"]').remove()}),r=parseInt(ASC.Files.Constants.COUNT_ON_PAGE)||0,ASC.Files.UI.amountPage=parseInt((ASC.Files.UI.countTotal/r).toFixed(0)),ASC.Files.UI.amountPage-ASC.Files.UI.countTotal/r<0&&ASC.Files.UI.amountPage++,ASC.Files.UI.currentPage=parseInt((jq('#filesMainContent .file-row[name!="addRow"]').length-1)/r)+1,u=ASC.Files.UI.countTotal-jq("#filesMainContent .file-row").length,ASC.Files.UI.currentPage<ASC.Files.UI.amountPage&&u>0?(jq("#pageNavigatorHolder").show(),ASC.Files.FilesJSResources&&jq("#pageNavigatorHolder a").text(r<u?ASC.Files.FilesJSResources.ButtonShowMoreOf.format(r,u):ASC.Files.FilesJSResources.ButtonShowMore.format(u))):jq("#pageNavigatorHolder").hide(),ASC.Files.Mouse&&ASC.Files.Mouse.collectEntryItems(),ASC.Files.UI.addRowHandlers(i),f&&(ASC.Files.UI.selectRow(i,f),ASC.Files.UI.updateMainContentHeader()),e=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),e.length>0&&(o=jq(e).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray(),ASC.Files.Socket.subscribeChangeEditors(o)),ASC.Files.UI.checkEditingDefer()),i&&i.attr("name",""),i},o=function(n){var t,i;if(typeof n=="undefined"||n==null)return!1;if(!ASC.Files.Folders)return!0;ASC.Files.Folders.currentFolder={};t=jq(n.childNodes);for(i in t)i&&typeof t[i]=="object"&&(ASC.Files.Folders.currentFolder[t[i].tagName]=t[i].textContent||t[i].text||"");if(ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))ASC.Files.Folders.currentFolder.entryId=ASC.Files.Folders.currentFolder.id;else return!1;if(ASC.Files.Folders.currentFolder.entryType="folder",ASC.Files.Share){if(ASC.Files.Folders.currentFolder.access=parseInt(ASC.Files.Folders.currentFolder.access||ASC.Files.Constants.AceStatusEnum.None),ASC.Files.Folders.currentFolder.access==ASC.Files.Constants.AceStatusEnum.Restrict)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1;ASC.Files.Folders.currentFolder.shareable=ASC.Files.Folders.currentFolder.shareable==="true"}return ASC.Files.Tree&&ASC.Files.Folders.currentFolder.id==ASC.Files.Tree.folderIdCurrentRoot&&(ASC.Files.Folders.currentFolder.title=ASC.Files.FilesJSResources.ProjectFiles),ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title),!0},s=function(n){var t,i;if(typeof n=="undefined"||n==null||(t=jq(n.childNodes).map(function(n,t){var i=t.childNodes[0];return i.textContent||i.text}),t.length==0))return!1;i=parseInt(t[0]);ASC.Files.Tree&&(ASC.Files.Tree.pathParts=t);jq("#mainContentHeader .menuAction").removeClass("unlockAction").hide();jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("recentFiles").removeClass("favoritesFiles").removeClass("templatesFiles").removeClass("privacyFiles").removeClass("trashFiles").removeClass("projectFiles");switch(i){case ASC.Files.Constants.FOLDER_ID_MY_FILES:ASC.Files.Folders.folderContainer="my";jq("#filesMainContent").addClass("myFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_SHARE:ASC.Files.Folders.folderContainer="forme";jq("#filesMainContent").addClass("shareformeFiles");jq("#mainDownload, #mainCopy, #mainMarkRead, #mainUnsubscribe, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_RECENT:ASC.Files.Folders.folderContainer="recent";jq("#filesMainContent").addClass("recentFiles");jq("#mainDownload, #mainCopy, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_FAVORITES:ASC.Files.Folders.folderContainer="favorites";jq("#filesMainContent").addClass("favoritesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveFavorite").show();break;case ASC.Files.Constants.FOLDER_ID_TEMPLATES:ASC.Files.Folders.folderContainer="templates";jq("#filesMainContent").addClass("templatesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveTemplate").show();break;case ASC.Files.Constants.FOLDER_ID_PRIVACY:ASC.Files.Folders.folderContainer="privacy";jq("#filesMainContent").addClass("privacyFiles");jq("#mainDownload, #mainMove, #mainDelete").show();break;case ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Folders.folderContainer="corporate";jq("#filesMainContent").addClass("corporateFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_PROJECT:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_TRASH:ASC.Files.Folders.folderContainer="trash";jq("#filesMainContent").addClass("trashFiles");jq("#mainDownload, #mainRestore, #mainDelete, #mainEmptyTrash, #mainConvert").show();jq("#mainEmptyTrash").addClass("unlockAction");break;case ASC.Files.Tree.folderIdCurrentRoot:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;default:if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))return!1}return ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&!ASC.Resources.Master.Personal&&jq("#mainShare").show(),ASC.Files.Filter&&ASC.Files.Filter.disableFilter(),jq("#filesMainContent").toggleClass("without-share",!(ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable)),ASC.Files.Tree&&ASC.Files.Tree.updateTreePath(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),!0},h=function(){ASC.Files.Folders.currentFolder={access:ASC.Files.Constants.AceStatusEnum.Read,entryId:ASC.Files.Constants.FOLDER_ID_PRIVACY,entryType:"folder",id:ASC.Files.Constants.FOLDER_ID_PRIVACY,shareable:!1,title:ASC.Files.FilesJSResources.PrivacyRoom};ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title);jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("recentFiles").removeClass("favoritesFiles").removeClass("templatesFiles").removeClass("privacyFiles").removeClass("trashFiles").removeClass("projectFiles");ASC.Files.Folders.folderContainer="privacy";jq("#filesMainContent").addClass("privacyFiles");ASC.Files.Tree&&(ASC.Files.Tree.pathParts=[ASC.Files.Constants.FOLDER_ID_PRIVACY],ASC.Files.Tree.updateTreePath());ASC.Files.Filter&&ASC.Files.Filter.disableFilter();ASC.Files.UI.countTotal=0;jq("#filesMainContent").empty();jq(document).scrollTop(0);jq("#emptyContainer_privacy .emptyScrBttnPnl").remove();ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter=null;ASC.Files.CreateMenu&&ASC.Files.CreateMenu.disableMenu(!1)},c=function(t,i,r){var e,u,o,f,s;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.parentFolderID){for(i.lonelyType&&(t.__type=i.lonelyType,t=[t]),e="",u=0;u<t.length;u++)o=ASC.Files.Common.jsonToXml(t[u].__type.toLowerCase().indexOf("folder")==-1?{file:t[u]}:{folder:t[u]}),e+=ASC.Files.TemplateManager.translateFromString(o);f=n(e,{});f&&(s=f.hasClass("new-folder"),f.removeClass("new-file new-folder").show().yellowFade(),ASC.Files.Tree&&s&&ASC.Files.Tree.resetFolder(i.parentFolderID))}},l=function(t,i,r){var h=ASC.Files.UI.getEntryObject("file","0"),f,c,u;if(ASC.Files.UI.blockObject(h),f=i.winEditor,typeof r!="undefined"){h.remove();f&&f.close();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}if(c=ASC.Files.TemplateManager.translate(t),ASC.Files.Folders.currentFolder.id==i.folderID){u=n(c,h);u.show().yellowFade().removeClass("new-file");var e=ASC.Files.UI.getObjectData(u),s=e.title,o=e.entryId;if(ASC.Files.Folders.folderContainer=="privacy"&&ASC.Desktop&&ASC.Desktop.setAccess){ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResources.DescriptCreate);ASC.Desktop.setAccess(o,function(n){n?(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.DesktopMessageStoring),ASC.Files.Folders.replaceFileStream(o,s,n,!0,f)):(ASC.Files.UI.blockObject(u),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(s)))});return}ASC.Files.Actions.checkEditFile(o,f)}else u=jq(c),e=ASC.Files.UI.getObjectData(u),s=e.title,o=e.entryId,ASC.Files.Actions.checkEditFile(o,f);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(s))},a=function(t,i,r){var e=ASC.Files.UI.getEntryObject("folder","0"),o,u,f;if(typeof r!="undefined"){e.remove();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}ASC.Files.Folders.currentFolder.id==i.parentFolderID?(o=ASC.Files.TemplateManager.translate(t),u=n(o,e),u.yellowFade().removeClass("new-folder"),f=ASC.Files.UI.getObjectData(u).title):f=i.title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFolder.format(f));trackingGoogleAnalytics("documents","create","folder")},v=function(t,i,r){var f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var e=ASC.Files.TemplateManager.translate(t),o=i.folderId,u=ASC.Files.UI.getEntryObject("folder",o);u=n(e,u);u.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(u,!0);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectData(u).title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFolder.format(i.name,f))},y=function(n,t,i){var r,u;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=ASC.Files.EventHandler.onGetFile(n,t,i);ASC.Files.UI.selectRow(r.entryObject,!0);ASC.Files.UI.updateMainContentHeader();u=r.title;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFile.format(t.name,u))},p=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u,f;jq(i.list).each(function(e,o){var h=ASC.Files.UI.parseItemId(o),l,v,c;if(jq(t).each(function(n,t){return t.id==h.entryId?(l=t,!1):!0}),h.entryType=="folder"){var a=ASC.Files.Common.jsonToXml({folder:l}),y=ASC.Files.TemplateManager.translateFromString(a),p=h.entryId,s=ASC.Files.UI.getEntryObject("folder",p);s=n(y,s);s.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(s,!0);ASC.Files.UI.updateMainContentHeader();ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);v=ASC.Files.UI.getObjectData(s);u=v.create_by;f=v.title}else a=ASC.Files.Common.jsonToXml({file:l}),c=ASC.Files.EventHandler.onGetFile(a,{fileId:h.entryId,isStringXml:!0,show:!0},r),ASC.Files.UI.selectRow(c.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),u=c.create_by,f=c.title});i.list.length>1?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwnerArray.format(Encoder.htmlEncode(u),i.list.length)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwner.format(Encoder.htmlEncode(u),f))},w=function(n,t,i){var f=t.fileId,e=ASC.Files.UI.getEntryObject("file",f),r,u;if(typeof i!="undefined"){ASC.Files.UI.blockObject(e);jq(".version-operation").css("visibility","");ASC.Files.UI.displayInfoPanel(i,!0);return}jq.extend(t,{isStringXml:!0,show:!0});r=ASC.Files.Common.jsonToXml({file:n.key});ASC.Files.EventHandler.onGetFile(r,t);u=ASC.Files.Common.jsonToXml({fileList:{entry:n.value}});ASC.Files.EventHandler.onGetFileHistory(u,t)},b=function(n,t,i){var h=t.fileId,r=ASC.Files.UI.getEntryObject("file",h),s,u,e,o,f;if(ASC.Files.UI.blockObject(r),ASC.Files.UI.updateMainContentHeader(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}s=t.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(n):ASC.Files.TemplateManager.translate(n);jq("#contentVersions").remove();r.append(s).addClass("file-row-fix");u=ASC.Files.UI.getObjectData(r);e=!0;!ASC.Files.UI.accessEdit(u,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r)||Teamlab.profile.isVisitor||u.encrypted?(jq(".version-comment-edit").remove(),jq(".version-operation.version-restore").empty(),jq(".version-complete, .version-continue").remove(),jq(".version-num span").addClass("display-num"),e=!1):jq("#contentVersions").addClass("version-edit");jq("#contentVersions").addClass("version-highlight");ASC.Files.Utility.CanWebView(u.title)&&jq(".not-preview").removeClass("not-preview");o=jq("#contentVersions .version-row:first").attr("data-version");jq("#contentVersions .version-row[data-version='"+o+"'] .version-restore").empty();f=-1;jq("#contentVersions .version-row").each(function(){var n=jq(this),i=n.attr("data-version-group"),r=n.attr("data-version"),t;i!=f?(r==o?n.find(".version-continue").remove():n.find(".version-complete").remove(),f=i,n.addClass("version-group-head"),t=jq("#contentVersions .version-row[data-version-group="+f+"]"),t.length>1&&n.find(".version-sublist span").addClass("version-sublist-toggle").text(jq.format(ASC.Files.FilesJSResources.RevisionCount,t.length))):e?n.find(".version-num span, .version-continue").remove():n.find(".version-num").empty()});ASC.Files.UI.registerUserProfilePopup(jq("#contentVersions"))},k=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}n=n||"";var r=ASC.Files.UI.getEntryObject("file",t.fileId);r.find(".version-row[data-version="+t.version+"]").removeClass("version-row-comment").find(".version-comment").attr("data-comment",n).attr("title",n.length?n:"").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>")},d=function(t,i,r){var e,o,u,f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(e=i.fileId,ASC.Files.Common.isCorrectId(e))return o=i.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(t):ASC.Files.TemplateManager.translate(t),ASC.Files.Marker.removeNewIcon("file",e),u=ASC.Files.UI.getEntryObject("file",e),u=n(o,u),f=ASC.Files.UI.getObjectData(u),!f||(u=f.entryObject,i.show&&(ASC.Files.EmptyScreen.hideEmptyScreen(),u.removeClass("new-file").show().yellowFade()),u.find(".is-new").is(":visible")&&ASC.Files.Marker.setNewCount(f.entryType,f.entryId,1)),ASC.Files.UI.updateMainContentHeader(),f},g=function(n,t,i){if(typeof i!="undefined"){jq(t.list.entry).each(function(){var n=ASC.Files.UI.parseItemId(this);ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.displayInfoPanel(i,!0);return}n!=null&&n.length>0?ASC.Files.Folders.showOverwriteMessage(t.list,t.folderToId,t.folderToTitle,t.isCopyOperation,n):(ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t.folderToId,resolve:ASC.Files.Constants.ConflictResolveType.Duplicate,isCopyOperation:t.isCopyOperation,doNow:!0},{stringList:t.list}),ASC.Files.Folders.isCopyTo=!1)},u=function(n,t,i){var e=ASC.Files.UI.parseItemId(n[0]).entryId,u,o,r,s,h,l,y,p,w;for(n=n.slice(1),u=[],o=[],r=0;r<n.length;r++)(s=ASC.Files.UI.parseItemId(n[r]),s!=null)&&(r%2?o.push(s):(u.push(s),ASC.Files.UI.blockObjectById(s.entryType,s.entryId,!1,null,!0)));ASC.Files.UI.updateMainContentHeader();h=ASC.Files.UI.getEntryObject("folder",e);h.removeClass("row-to");var a,v=0,c=0,f="";for(u.length==1&&(f=ASC.Files.UI.getEntryTitle(u[0].entryType,u[0].entryId),(typeof f==undefined||f==null)&&(f="")),r=0;r<u.length;r++)l=ASC.Files.UI.getEntryObject(u[r].entryType,u[r].entryId),u[r].entryType=="file"?c++:(v+=1+(parseInt(l.find(".countFolders").html())||0),c+=parseInt(l.find(".countFiles").html())||0,ASC.Files.Tree&&!a&&(a=ASC.Files.Tree.getParentId(u[r].entryId))),t||ASC.Files.Folders.currentFolder.id==e||(ASC.Files.Marker.removeNewIcon(u[r].entryType,u[r].entryId),l.remove());if(v>0&&(y=h.find(".countFolders"),y.html((parseInt(y.html())||0)+v),ASC.Files.Tree&&(ASC.Files.Tree.reloadFolder(e),t||e==ASC.Files.Folders.currentFolder.id||ASC.Files.Tree.reloadFolder(a||ASC.Files.Folders.currentFolder.id))),c>0&&(p=h.find(".countFiles"),p.html((parseInt(p.html())||0)+c)),u.length>0&&ASC.Files.Folders.currentFolder.id!=e&&ASC.Files.UI.checkEmptyContent(),t?u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyGroup.format(i)):u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(i)),ASC.Files.Folders.currentFolder.id==e){for(w=[],r=0;r<o.length;r++)ASC.Files.UI.getEntryObject(o[r].entryType,o[r].entryId).length||w.push(o[r].entryType+"_"+o[r].entryId);ASC.Files.Folders.getItems(w,e)}},nt=function(n,t){var s=ASC.Files.UI.parseItemId(n[0]).entryId,i,r,f,c;for(n=n.slice(1),i=[],r=0;r<n.length;r++)(f=ASC.Files.UI.parseItemId(n[r]),f!=null)&&(i.push(f),ASC.Files.UI.blockObjectById(f.entryType,f.entryId,!1,null,!0));ASC.Files.UI.updateMainContentHeader();var o,e=!1,u="",h=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>0&&(ASC.Files.Tree.pathParts[0]!=ASC.Files.Constants.FOLDER_ID_TRASH||s==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty());for(i.length==1&&(u=ASC.Files.UI.getEntryTitle(i[0].entryType,i[0].entryId),(typeof u==undefined||u==null)&&(u="")),r=0;r<i.length;r++)c=ASC.Files.UI.getEntryObject(i[r].entryType,i[r].entryId),i[r].entryType=="folder"&&(e||(e=!0),ASC.Files.Tree&&!o&&(o=ASC.Files.Tree.getParentId(i[r].entryId))),h&&(ASC.Files.Marker.removeNewIcon(i[r].entryType,i[r].entryId),c.remove());e&&ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(o||ASC.Files.Folders.currentFolder.id);i.length>0&&h&&ASC.Files.UI.checkEmptyContent();i.length==1&&u!=""?e>0?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFolder.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFile.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveGroup.format(i.length,t));s==ASC.Files.Constants.FOLDER_ID_TRASH&&ASC.Files.ChunkUploads.initTenantQuota()},tt=function(n,t,i){var s,u,e,o,r,c;if(clearTimeout(ASC.Files.UI.timeCheckEditing),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}for(n||(n=[]),s=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),u=0;u<s.length;u++){var h=ASC.Files.UI.getObjectData(s[u]),l=h.entryObject,f=h.entryId;for(ASC.Files.UI.lockEditFile(l,!1),e=!0,o=0;o<n.length&&e;o++)f==n[o].Key&&(e=!1);e&&ASC.Files.Folders.replaceVersion(f,!0)}for(r=0;r<n.length;r++)f=n[r].Key,c=n[r].Value,ASC.Files.UI.lockEditFileById(f,!0,c);n.length>0&&ASC.Files.UI.checkEditingDefer()},it=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq(".update-if-exist").prop("checked",n===!0)},rt=function(n,t,i){var u,r;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}u=t.lock;u?(r=t.fileObj,r.addClass("file-locked"),ASC.Files.UI.addRowHandlers(r)):(t.show=!0,ASC.Files.Actions.currentEntryData=ASC.Files.EventHandler.onGetFile(n,t,i))},ut=function(n,t,i){if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Actions.hideAllActionPanels();return}jq("#filesTemplateLoader").hide();var r=ASC.Files.TemplateManager.translate(n),u=!r.length;(t.append||(jq("#filesTemplateEmpty").toggle(u),jq("#filesTemplateList").toggle(!u)),u)||(t.append?jq("#filesTemplateList").append(r):jq("#filesTemplateList").html(r),jq("#filesTemplateList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")}))},ft=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Anchor.defaultFolderSet();return}t.update&&(jq("#helpPanel").html(n),StudioManager.initImageZoom());LoadingBanner.hideLoading();jq("#helpPanel").show();showHelpPage(t.helpId);ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsHelp);ASC.Files.CreateMenu.disableMenu()},et=function(n,r,f){var h,s,e;if(typeof n!="object"&&typeof f!="undefined"||n==null){ASC.Files.Folders.cancelTasksStatuses();ASC.Files.UI.displayInfoPanel(f,!0);return}if(n.length==0){ASC.Files.Folders.cancelTasksStatuses();return}var o=0,c=!1,l,a=[ASC.Files.FilesJSResources.TasksOperationMove,ASC.Files.FilesJSResources.TasksOperationCopy,ASC.Files.FilesJSResources.TasksOperationDelete,ASC.Files.FilesJSResources.TasksOperationBulkdownload,ASC.Files.FilesJSResources.TasksOperationMarkAsRead],v=[ASC.Files.FilesJSResources.DescriptMove,ASC.Files.FilesJSResources.DescriptCopy,ASC.Files.FilesJSResources.DescriptRemove,ASC.Files.FilesJSResources.DescriptBulkdownload,ASC.Files.FilesJSResources.DescriptMarkAsRead];for(n.length!=0&&(jq("#tasksProgress:visible").length==0&&(clearTimeout(t),jq("#tasksProgress").length==0&&(jq("#progressTemplate").clone().attr("id","tasksProgress").prependTo("#bottomLoaderPanel"),jq("#tasksProgress .progress-dialog-header").append('<a title="{0}" class="actions-container close">&times;<\/a>'.format(ASC.Files.FilesJSResources.TitleCancel)),jq("#tasksProgress .progress-dialog-header").append("<span><\/span>")),ASC.Files.UI.setProgressValue("#tasksProgress",0),jq("#tasksProgress .asc-progress-percent").text("0%"),jq("#tasksProgress .progress-dialog-header span").text(""),jq("#tasksProgress").show(),jq.browser.mobile&&(jq("#bottomLoaderPanel").css("bottom","auto"),jq("#bottomLoaderPanel").css("top",jq(window).scrollTop()+jq(window).height()-jq("#bottomLoaderPanel").height()+"px"))),l=n.length>1?ASC.Files.FilesJSResources.TasksOperationMixed.format(n.length):a[n[0].operation],jq("#tasksProgress .progress-dialog-header span").text(l)),i=0;i<n.length;i++)if(h=":",s=n[i].source.trim().split(h),jq(s).each(function(){var t=ASC.Files.UI.parseItemId(this);if(t==null)return!0;ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!0,v[n[i].operation],!0)}),ASC.Files.UI.updateMainContentHeader(),o+=n[i].progress,n[i].finished){if(n[i].result!=null){e=n[i].result.trim().split(h);switch(n[i].operation){case 0:u(e,!1,n[i].processed);break;case 1:u(e,!0,n[i].processed);break;case 2:nt(e,s.length);break;case 3:e[0]&&(location.href=e[0]);ASC.Files.Folders.bulkStatuses=!1;break;case 4:ASC.Files.Marker.onMarkAsRead(e)}}jq(s).each(function(){var n=ASC.Files.UI.parseItemId(this);if(n==null)return!0;ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();n[i].error!=null&&ASC.Files.UI.displayInfoPanel(n[i].error,!0)}else c=!0;o=n.length==0?100:o/n.length;ASC.Files.UI.setProgressValue("#tasksProgress",o);jq("#tasksProgress .asc-progress-percent").text(o+"%");c?ASC.Files.Folders.getTasksStatuses(r.doNow):(clearTimeout(t),t=setTimeout(ASC.Files.Folders.cancelTasksStatuses,500))};return{init:f,onGetFolderItems:e,onGetPrivacy:h,onGetItems:c,onGetFile:d,onCreateNewFile:l,onCreateFolder:a,onRenameFolder:v,onRenameFile:y,onChangeOwner:p,onUpdateHistory:w,onGetFileHistory:b,onUpdateComment:k,onCheckEditing:tt,onLockFile:rt,onGetTemplates:ut,onUpdateIfExist:it,onGetHelpCenter:ft,onMoveFilesCheck:g,onGetTasksStatuses:et}}(),function(n){n(function(){ASC.Files.EventHandler.init();jq("#bottomLoaderPanel").on("click","#tasksProgress a.close",function(){return ASC.Files.Folders.terminateTasks(),!1})})}(jQuery);
window.ASC.Files.Socket=function(){var n=!1,t,i=function(){if(n===!1&&ASC.SocketIO&&!ASC.SocketIO.disabled()){n=!0;t=ASC.SocketIO.Factory.files;t.connect(function(){}).on("changeEditors",function(){ASC.Files.UI.checkEditing()})}},r=function(i){n!==!1&&t.emit("subscribeChangeEditors",i,function(){})};return{init:i,subscribeChangeEditors:r}}(),function(n){n(function(){ASC.Files.Socket.init()})}(jQuery);
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});
jQuery.url=function(){var i={},n={},t={url:window.location,strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},u=function(){str=decodeURI(t.url);for(var r=t.parser[t.strictMode?"strict":"loose"].exec(str),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(i,r,u){r&&(n[t.q.name][r]=u)}),n},f=function(t){return(n.length||r(),t=="base")?n.port!==null&&n.port!==""?n.protocol+"://"+n.host+":"+n.port+"/":n.protocol+"://"+n.host+"/":n[t]===""?null:n[t]},e=function(t){return n.length||r(),n.queryKey[t]===null?null:n.queryKey[t]},r=function(){n=u();o()},o=function(){var t=n.path;i=[];i=n.path.length==1?{}:(t.charAt(t.length-1)=="/"?t.substring(1,t.length-1):path=t.substring(1)).split("/")};return{setMode:function(n){return strictMode=n=="strict"?!0:!1,this},setUrl:function(n){return t.url=n===undefined?window.location:n,r(),this},segment:function(t){return(n.length||r(),t===undefined)?i.length:i[t]===""||i[t]===undefined?null:i[t]},attr:f,param:e}}();
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery-ui/ui/widget"],n):typeof exports=="object"?n(require("jquery"),require("./vendor/jquery.ui.widget")):n(window.jQuery)})(function(n){"use strict";function t(t){var i=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var u=r.dataTransfer;u&&n.inArray("Files",u.types)!==-1&&this._trigger(t,n.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),i&&(u.dropEffect="copy"))}}n.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||n('<input type="file"/>').prop("disabled"));n.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);n.support.xhrFormDataFileUpload=!!window.FormData;n.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&n.each(i,function(n,i){t=t.replace("{"+n+"}",i)}),t},formData:function(n){return n.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||i.autoUpload!==!1&&n(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:n.support.blobSlice&&function(){var n=this.slice||this.webkitSlice||this.mozSlice;return n.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(n,t,i){var r=n-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=n),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&n.support.xhrFileUpload||n.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return n.type(t.formData)==="function"?t.formData(t.form):n.isArray(t.formData)?t.formData:n.type(t.formData)==="object"?(i=[],n.each(t.formData,function(n,t){i.push({name:n,value:t})}),i):[]},_getTotal:function(t){var i=0;return n.each(t,function(n,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?n.extend(t._progress,i):t._progress=i},_initResponseObject:function(n){var t;if(n._response)for(t in n._response)n._response.hasOwnProperty(t)&&delete n._response[t];else n._response={}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),u;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r;u=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=u-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=u;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,u,i.bitrateInterval);this._trigger("progress",n.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",n.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var r=this,i=t.xhr?t.xhr():n.ajaxSettings.xhr();i.upload&&(n(i.upload).bind("progress",function(n){var i=n.originalEvent;n.lengthComputable=i.lengthComputable;n.loaded=i.loaded;n.total=i.total;r._onProgress(n,t)}),t.xhr=function(){return i})},_isInstanceOf:function(n,t){return Object.prototype.toString.call(t)==="[object "+n+"]"},_initXHRData:function(t){var f=this,i,r=t.files[0],e=t.multipart||!n.support.xhrFileUpload,u=n.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=n.extend({},t.headers);t.contentRange&&(t.headers["Content-Range"]=t.contentRange);e&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.uploadName||r.name)+'"');e?n.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:u,value:t.blob}):n.each(t.files,function(r,f){i.push({name:n.type(t.paramName)==="array"&&t.paramName[r]||u,value:f})})):(f._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,n.each(this._getFormData(t),function(n,t){i.append(t.name,t.value)})),t.blob?i.append(u,t.blob,r.uploadName||r.name):n.each(t.files,function(r,e){(f._isInstanceOf("File",e)||f._isInstanceOf("Blob",e))&&i.append(n.type(t.paramName)==="array"&&t.paramName[r]||u,e,e.uploadName||e.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r);t.blob=null},_initIframeSettings:function(t){var i=n("<a><\/a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(n){this._isXHRUpload(n)?(this._chunkedUpload(n,!0)||(n.data||this._initXHRData(n),this._initProgressListener(n)),n.postMessage&&(n.dataType="postmessage "+(n.dataType||""))):this._initIframeSettings(n)},_getParamName:function(t){var r=n(t.fileInput),i=t.paramName;return i?n.isArray(i)||(i=[i]):(i=[],r.each(function(){for(var t=n(this),u=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(u),r-=1}),i.length||(i=[r.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=n(t.fileInput.prop("form")),t.form.length||(t.form=n(this.options.fileInput.prop("form"))));t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||n.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=n.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(n){return n.state?n.state():n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},_enhancePromise:function(n){return n.success=n.done,n.error=n.fail,n.complete=n.always,n},_getXHRPromise:function(t,i,r){var u=n.Deferred(),f=u.promise();return i=i||this.options.context||f,t===!0?u.resolveWith(i,r):t===!1&&u.rejectWith(i,r),f.abort=u.promise,this._enhancePromise(f)},_addConvenienceMethods:function(t,i){var r=this,u=function(t){return n.Deferred().resolveWith(r,t).promise()};i.process=function(t,f){return(t||f)&&(i._processQueue=this._processQueue=(this._processQueue||u([this])).then(function(){return i.errorThrown?n.Deferred().rejectWith(r,[i]).promise():u(arguments)}).then(t,f)),this._processQueue||u([this])};i.submit=function(){return this.state()!=="pending"&&(i.jqXHR=this.jqXHR=r._trigger("submit",n.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()};i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))};i.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(n){var i=n.getResponseHeader("Range"),t=i&&i.split("-"),r=t&&t.length>1&&parseInt(t[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var u=this,e=t.files[0],o=e.size,r=t.uploadedBytes,f=t.maxChunkSize||o,l=this._blobSlice,s=n.Deferred(),h=s.promise(),a,c;return!(this._isXHRUpload(t)&&l&&(r||(n.type(f)==="function"?f(t):f)<o))||t.data?!1:i?!0:r>=o?(e.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",e.error])):(c=function(){var i=n.extend({},t),h=i._progress.loaded;i.blob=l.call(e,r,r+(n.type(f)==="function"?f(i):f),e.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+r+"-"+(r+i.chunkSize-1)+"/"+o;u._initXHRData(i);u._initProgressListener(i);a=(u._trigger("chunksend",null,i)!==!1&&n.ajax(i)||u._getXHRPromise(!1,i.context)).done(function(f,e,l){r=u._getUploadedBytes(l)||r+i.chunkSize;h+i.chunkSize-i._progress.loaded&&u._onProgress(n.Event("progress",{lengthComputable:!0,loaded:r-i.uploadedBytes,total:r-i.uploadedBytes}),i);t.uploadedBytes=i.uploadedBytes=r;i.result=f;i.textStatus=e;i.jqXHR=l;u._trigger("chunkdone",null,i);u._trigger("chunkalways",null,i);r<o?c():s.resolveWith(i.context,[f,e,l])}).fail(function(n,t,r){i.jqXHR=n;i.textStatus=t;i.errorThrown=r;u._trigger("chunkfail",null,i);u._trigger("chunkalways",null,i);s.rejectWith(i.context,[n,t,r])})},this._enhancePromise(h),h.abort=function(){return a.abort()},c(),h)},_beforeSend:function(n,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,u){var f=u._progress.total,e=u._response;u._progress.loaded<f&&this._onProgress(n.Event("progress",{lengthComputable:!0,loaded:f,total:f}),u);e.result=u.result=t;e.textStatus=u.textStatus=i;e.jqXHR=u.jqXHR=r;this._trigger("done",null,u)},_onFail:function(n,t,i,r){var u=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total);u.jqXHR=r.jqXHR=n;u.textStatus=r.textStatus=t;u.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(n,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r=this,f,s,e,h,u=r._getAJAXSettings(i),o=function(){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,f=f||((s||r._trigger("send",n.Event("send",{delegatedEvent:t}),u)===!1)&&r._getXHRPromise(!1,u.context,s)||r._chunkedUpload(u)||n.ajax(u)).done(function(n,t,i){r._onDone(n,t,i,u)}).fail(function(n,t,i){r._onFail(n,t,i,u)}).always(function(n,t,i){if(r._onAlways(n,t,i,u),r._sending-=1,r._active-=1,u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending)for(var f=r._slots.shift();f;){if(r._getDeferredState(f)==="pending"){f.resolve();break}f=r._slots.shift()}r._active===0&&r._trigger("stop")})};return(this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(e=n.Deferred(),this._slots.push(e),h=e.then(o)):(this._sequence=this._sequence.then(o,o),h=this._sequence),h.abort=function(){return(s=[undefined,"abort","abort"],!f)?(e&&e.rejectWith(u.context,s),o()):f.abort()},this._enhancePromise(h)):o()},_onAdd:function(t,i){var a=this,p=!0,f=n.extend({},this.options,i),u=i.files,v=u.length,o=f.limitMultiFileUploads,c=f.limitMultiFileUploadSize,b=f.limitMultiFileUploadSizeOverhead,w=0,l=this._getParamName(f),s,e,h,r,y=0;if(!v)return!1;if(c&&u[0].size===undefined&&(c=undefined),(f.singleFileUploads||o||c)&&this._isXHRUpload(f))if(f.singleFileUploads||c||!o)if(!f.singleFileUploads&&c)for(h=[],s=[],r=0;r<v;r=r+1)w+=u[r].size+b,(r+1===v||w+u[r+1].size+b>c||o&&r+1-y>=o)&&(h.push(u.slice(y,r+1)),e=l.slice(y,r+1),e.length||(e=l),s.push(e),y=r+1,w=0);else s=l;else for(h=[],s=[],r=0;r<v;r+=o)h.push(u.slice(r,r+o)),e=l.slice(r,r+o),e.length||(e=l),s.push(e);else h=[u],s=[l];return i.originalFiles=u,n.each(h||u,function(r,u){var f=n.extend({},i);return f.files=h?u:[u],f.paramName=s[r],a._initResponseObject(f),a._initProgressObject(f),a._addConvenienceMethods(t,f),p=a._trigger("add",n.Event("add",{delegatedEvent:t}),f)}),p},_replaceFileInput:function(t){var i=t.fileInput,r=i.clone(!0),u=i.is(document.activeElement);t.fileInputClone=r;n("<form><\/form>").append(r)[0].reset();i.after(r).detach();u&&r.focus();n.cleanData(i.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(n,t){return t===i[0]?r[0]:t});i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,i){var s=this,r=n.Deferred(),u=[],e,f=function(n){n&&!n.entry&&(n.entry=t);r.resolve([n])},h=function(n){s._handleFileTreeEntries(n,i+t.name+"/").done(function(n){r.resolve(n)}).fail(f)},o=function(){e.readEntries(function(n){n.length?(u=u.concat(n),o()):h(u)},f)};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(n){n.relativePath=i;r.resolve(n)},f):t.isDirectory?(e=t.createReader(),o()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var r=this;return n.when.apply(n,n.map(t,function(n){return r._handleFileTreeEntry(n,i)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(n.map(i,function(n){var t;return n.webkitGetAsEntry?(t=n.webkitGetAsEntry(),t&&(t._file=n.getAsFile()),t):n.getAsEntry()})):n.Deferred().resolve(n.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=n(t);var r=t.prop("webkitEntries")||t.prop("entries"),i,u;if(r&&r.length)return this._handleFileTreeEntries(r);if(i=n.makeArray(t.prop("files")),i.length)i[0].name===undefined&&i[0].fileName&&n.each(i,function(n,t){t.name=t.fileName;t.size=t.fileSize});else{if(u=t.prop("value"),!u)return n.Deferred().resolve([]).promise();i=[{name:u.replace(/^.*\\/,"")}]}return n.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return!(t instanceof n)||t.length===1?this._getSingleFileInputFiles(t):n.when.apply(n,n.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var r=this,i={fileInput:n(t.target),form:n(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(u){i.files=u;r.options.replaceFileInput&&r._replaceFileInput(i);r._trigger("change",n.Event("change",{delegatedEvent:t}),i)!==!1&&r._onAdd(t,i)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};i&&i.length&&(n.each(i,function(n,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),this._trigger("paste",n.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var u=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i;u._trigger("drop",n.Event("drop",{delegatedEvent:t}),r)!==!1&&u._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));n.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,i){var r=n.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers();this._super(t,i);r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof n||(t.fileInput=n(t.fileInput));t.dropZone instanceof n||(t.dropZone=n(t.dropZone));t.pasteZone instanceof n||(t.pasteZone=n(t.pasteZone))},_getRegExp:function(n){var t=n.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&n.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,r=this.element.data();n.each(this.element[0].attributes,function(n,u){var f=u.name.toLowerCase(),e;/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(n){return n.charAt(1).toUpperCase()}),e=r[f],t._isRegExpOption(f,e)&&(e=t._getRegExp(e)),i[f]=e)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(n){t.files=n;i._onAdd(null,t)}):(t.files=n.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=n.Deferred(),u=i.promise(),r,f;return u.abort=function(){return(f=!0,r)?r.abort():(i.reject(null,"abort","abort"),u)},this._getFileInputFiles(t.fileInput).always(function(n){if(!f){if(!n.length){i.reject();return}t.files=n;r=e._onSend(null,t);r.then(function(n,t,r){i.resolve(n,t,r)},function(n,t,r){i.reject(n,t,r)})}}),this._enhancePromise(u)}if(t.files=n.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});
window.ASC.Files.Share=function(){var l=!1,n,t,i,s=[],u,f=null,e,o=!1,a="*",w=function(){if(l===!1){l=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfo,ht);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfoShort,p);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceObject,ct);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceLink,vt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UnSubscribeMe,lt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetShortenLink,at);f=new SharingSettingsManager(undefined,null);f.OnSave=y;f.OnChange=ft;f.OnCopyLink=function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess)};jq(".embedded-size-item").on("click",c);jq(".embedded-size-custom").on("change",c);jq.dropdownToggle({switcherSelector:"#toggleEmbeddPanel",dropdownID:"shareEmbeddedPanel",inPopup:!0,rightPos:!0,addTop:10,afterShowFunction:function(){jq("#shareEmbedded").focus().select()}});jq(".sharing-empty").html(jq.format(ASC.Files.FilesJSResources.SharingSettingsEmpty,"<br />"))}},r=function(n){if(n=="owner")return ASC.Files.FilesJSResources.AceStatusEnum_Owner;n=parseInt(n);switch(n){case ASC.Files.Constants.AceStatusEnum.Read:return ASC.Files.FilesJSResources.AceStatusEnum_Read;case ASC.Files.Constants.AceStatusEnum.ReadWrite:return ASC.Files.FilesJSResources.AceStatusEnum_ReadWrite;case ASC.Files.Constants.AceStatusEnum.CustomFilter:return ASC.Files.FilesJSResources.AceStatusEnum_CustomFilter;case ASC.Files.Constants.AceStatusEnum.Restrict:return ASC.Files.FilesJSResources.AceStatusEnum_Restrict;case ASC.Files.Constants.AceStatusEnum.Varies:return ASC.Files.FilesJSResources.AceStatusEnum_Varies;case ASC.Files.Constants.AceStatusEnum.Review:return ASC.Files.FilesJSResources.AceStatusEnum_Review;case ASC.Files.Constants.AceStatusEnum.FillForms:return ASC.Files.FilesJSResources.AceStatusEnum_FillForms;case ASC.Files.Constants.AceStatusEnum.Comment:return ASC.Files.FilesJSResources.AceStatusEnum_Comment;default:return""}},h=function(){if(!ASC.Clipboard.enable){jq("#shareLinkCopy, #shareEmbedCopy").remove();return}ASC.Files.Share.clip=ASC.Clipboard.destroy(ASC.Files.Share.clip);ASC.Files.Share.clip=ASC.Clipboard.create(jq("#shareLink").val(),"shareLinkCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Resources.Master.Resource.LinkCopySuccess):jq("#shareLink, #shareLinkCopy").yellowFade()},textareaId:"shareLink"});ASC.Files.Share.clipEmbed=ASC.Clipboard.destroy(ASC.Files.Share.clipEmbed);ASC.Files.Share.clipEmbed=ASC.Clipboard.create(jq("#shareEmbedded").val(),"shareEmbedCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Files.FilesJSResources.CodeCopySuccess):jq("#shareEmbedded, #shareEmbedCopy").yellowFade()},textareaId:"shareEmbedded"})},v=function(n){var i=jq("#shareViaSocPanel"),r=encodeURIComponent(n);ASC.Resources.Master.UrlShareFacebook?i.find(".facebook").attr("href",ASC.Resources.Master.UrlShareFacebook.format(r,encodeURIComponent(t),"","")):i.find(".facebook").remove();ASC.Resources.Master.UrlShareTwitter?i.find(".twitter").attr("href",ASC.Resources.Master.UrlShareTwitter.format(r)):i.find(".twitter").remove();var u=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t),f=ASC.Files.FilesJSResources.shareLinkMailBody.format(t,n);i.find(".mail").attr("href","mailto:?subject={1}&body={0}".format(encodeURIComponent(f),encodeURIComponent(u)))},b=function(){var n=jq("#shareLinkOpen").is(":checked")?ASC.Files.Constants.AceStatusEnum.Read:ASC.Files.Constants.AceStatusEnum.Restrict;jq("#sharingLinkAce select").val()!=n&&jq("#sharingLinkAce select").val(n).change()},k=function(){var t=e,i=parseInt(jq("#sharingLinkAce select").val()),n;u!=i&&(o=!0);u=i;n=u==ASC.Files.Constants.AceStatusEnum.Restrict;jq("#shareLinkOpen").is(":checked")==n&&jq("#shareLinkOpen").prop("checked",!n);n?t="":(jq("#getShortenLink").hide(),u==ASC.Files.Constants.AceStatusEnum.Restrict||it()||jq("#getShortenLink").show());jq("#shareLinkPanel, #sharingLinkAce").toggle(!n);jq("#shareLinkDescr").toggle(n);jq("#sharingSettingsItems").toggleClass("with-share-link",!n);jq("#shareLink").val(t);jq("#shareLink").is(":visible")&&jq("#shareLink").focus().select();v(t);h();o&&et()},d=function(){if(jq("#shareLinkBody").show(),jq("#studio_sharingSettingsDialog #shareLinkBody").length==0){jq("#sharingSettingsDialogBody").prepend(jq("#shareLinkBody"));jq("#shareLinkPanel").on("click","#getShortenLink",st);jq("#shareViaSocPanel").on("click","a:not(.mail)",function(){return window.open(jq(this).attr("href"),"new","height=600,width=1020,fullscreen=0,resizable=0,status=0,toolbar=0,menubar=0,location=1"),!1});if(!ASC.Resources.Master.Personal)jq("#shareViaSocPanel").on("click","a.mail",function(){var u=jq(this).attr("href"),n=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER),i=new ASC.Mail.Message;i.subject=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t);var r='<a href="{0}">{1}<\/a>',f=r.format(Encoder.htmlEncode(e),Encoder.htmlEncode(t)),o=r.format(Encoder.htmlEncode(e),Encoder.htmlEncode(e)),s=ASC.Files.FilesJSResources.shareLinkMailBody.format(f,o);return i.body=s,ASC.Mail.Utility.SaveMessageInDrafts(i).done(function(t,i){var r=i.messageUrl;n&&n.location?n.location.href=r:n=window.open(r,"_blank")}).fail(function(){n.close();window.location.href=u}),!1});jq("#shareLinkOpen").on("click",b);jq("#sharingLinkAce select").on("change",k)}ASC.Files.Utility.CanWebView(t)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t)?(jq("#shareLinkPanel").removeClass("without-emb"),c()):jq("#shareLinkPanel").addClass("without-emb");jq("#sharingLinkAce select").val(u).change();jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.ReadWrite+"]").attr("disabled",!ASC.Files.Utility.CanWebEdit(t)||ASC.Files.Utility.MustConvert(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.CustomFilter+"]").attr("disabled",!ASC.Files.Utility.CanWebCustomFilterEditing(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.Review+"]").attr("disabled",!ASC.Files.Utility.CanWebReview(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.FillForms+"]").attr("disabled",!ASC.Files.Utility.CanWebRestrictedEditing(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.Comment+"]").attr("disabled",!ASC.Files.Utility.CanWebComment(t));jq("#sharingLinkAce select").tlcombobox()},c=function(){var i=jq(this),n,t;i.is(".embedded-size-item")&&(i.hasClass("embedded-size-6x8")?(jq("#embeddSizeWidth").val("600px"),jq("#embeddSizeHeight").val("800px")):i.hasClass("embedded-size-4x6")?(jq("#embeddSizeWidth").val("400px"),jq("#embeddSizeHeight").val("600px")):(jq("#embeddSizeWidth").val("100%"),jq("#embeddSizeHeight").val("100%")));n=jq("#embeddSizeWidth").val();t=jq("#embeddSizeHeight").val();n=(/\d+(px|%)?/gim.exec(n.toLowerCase().trim())||["100%"])[0];n==Math.abs(n)&&(n+="px");t=(/\d+(px|%)?/gim.exec(t.toLowerCase().trim())||["100%"])[0];t==Math.abs(t)&&(t+="px");jq("#embeddSizeWidth").val(n);jq("#embeddSizeHeight").val(t);jq(".embedded-size-item").removeClass("selected");n=="600px"&&t=="800px"?jq(".embedded-size-6x8").addClass("selected"):n=="400px"&&t=="600px"?jq(".embedded-size-4x6").addClass("selected"):n=="100%"&&t=="100%"&&jq(".embedded-size-1x1").addClass("selected");g(n,t)},g=function(n,i){var u,r;if(n=n||"100%",i=i||"100%",u=e,ASC.Files.Utility.CanWebView(t))r='<iframe src="{0}" width="{1}" height="{2}" frameborder="0" scrolling="no" allowtransparency><\/iframe>',u=u+"&action=embedded";else if(typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t))r='<img src="{0}" width="{1}" height="{2}" alt="" />';else return;r=r.format(u,n,i);jq("#shareEmbedded").val(r).attr("title",r)},nt=function(n,t){var i;if(ASC.Files.Folders.folderContainer=="forme"||ASC.Files.Folders.folderContainer=="privacy"){var e=[],r="",u="",f='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';(n&&t?(e.push({entryType:n,entryId:t}),i=ASC.Files.UI.getEntryTitle(n,t),n=="file"?u+=f.format(i,n,t):r+=f.format(i,n,t)):jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){var t=ASC.Files.UI.getObjectData(this),n=t.entryType,o=t.entryId;e.push({entryType:n,entryId:o});i=t.title;n=="file"?u+=f.format(i,n,o):r+=f.format(i,n,o)}),e.length!=0)&&(jq("#confirmUnsubscribeList dd.confirm-remove-files").html(u),jq("#confirmUnsubscribeList dd.confirm-remove-folders").html(r),jq("#confirmUnsubscribeList .confirm-remove-folders, #confirmUnsubscribeList .confirm-remove-files").show(),r==""&&jq("#confirmUnsubscribeList .confirm-remove-folders").hide(),u==""&&jq("#confirmUnsubscribeList .confirm-remove-files").hide(),ASC.Files.UI.blockUI("#filesConfirmUnsubscribe",420),PopupKeyUpActionProvider.EnterAction='jq("#unsubscribeConfirmBtn").click();')}},tt=function(){o?ASC.Files.Share.getSharedInfoShort():p(null)},it=function(){return!new RegExp("/Products/Files/","i").test(e)},rt=function(r,u,f,e,o){var s,p,y,w;n=r;i=!1;typeof n=="object"&&n.length==1&&(n=n[0],u?typeof u=="object"&&u.length==1&&(u=u[0]):(s=ASC.Files.UI.parseItemId(n),u=ASC.Files.UI.getEntryTitle(s.entryType,s.entryId)));typeof n=="string"&&(s=ASC.Files.UI.parseItemId(n),p=ASC.Files.UI.getEntryObject(s.entryType,s.entryId),y=ASC.Files.UI.getObjectData(p),y?i=y.encrypted:f===!0&&ASC.Desktop&&ASC.Desktop.setAccess&&(i=!0));f===!0&&o&&(a=o);t=typeof n=="object"?ASC.Files.FilesJSResources.SharingSettingsCount.format(n.length):u;var h=!1,c=!1,l=!1,v=!1;typeof n!="object"?(h=ASC.Files.Utility.CanWebCustomFilterEditing(t),c=ASC.Files.Utility.CanWebReview(t),l=ASC.Files.Utility.CanWebRestrictedEditing(t),v=ASC.Files.Utility.CanWebComment(t)):typeof u=="object"&&(h=!0,c=!0,l=!0,v=!0,jq(u).each(function(n,t){return ASC.Files.UI.parseItemId(r[n]).entryType=="folder"?(h=c=l=v=!1,!1):(ASC.Files.Utility.CanWebCustomFilterEditing(t)||(h=!1),ASC.Files.Utility.CanWebReview(t)||(c=!1),ASC.Files.Utility.CanWebRestrictedEditing(t)||(l=!1),ASC.Files.Utility.CanWebComment(t)||(v=!1),h||c||l||v)}));w={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()};ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetSharedInfo,{showLoading:!0,asFlat:f===!0,rootFolderType:e,canWebCustomFilterEditing:h,canWebReview:c,canWebRestrictedEditing:l,canWebComment:v},{stringList:w})},ut=function(){ASC.Files.ServiceManager.getSharedInfoShort(ASC.Files.ServiceManager.events.GetSharedInfoShort,{showLoading:!0,objectID:n})},ft=function(n){n&&(!ASC.Files.Folders||ASC.Files.Folders.folderContainer=="my"||ASC.Files.Folders.folderContainer=="forme"||ASC.Files.Folders.folderContainer=="privacy")&&(jq("#studio_sharingSettingsDialog #shareMessagePanel").show(),jq("#sharingSettingsItems").addClass("with-message-panel"))},y=function(t){var h=t.items,u=[],r,f,e;if(jq(h).each(function(n,t){var i=!0;jq(s).each(function(n,r){return r.id===t.id?(i=r.selectedAction.id!=t.selectedAction.id,!1):!0});i&&u.push({id:t.id,is_group:t.isGroup,ace_status:t.selectedAction.id})}),jq(s).each(function(n,t){var i=!0;jq(h).each(function(n,r){return t.id===r.id?(i=!1,!1):!0});i&&u.push({id:t.id,is_group:t.isGroup,ace_status:ASC.Files.Constants.AceStatusEnum.None})}),r=jq("#shareOwnerSelector").attr("data-id"),r=r!=jq("#shareOwnerSelector").attr("data-id-old")?r:null,u.length)o=!0;else{r&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],r);return}return f={entries:{entry:n},aces:{entry:u},message:""},e=jq("#shareMessageSend").prop("checked")==!0,e&&(f.message=(jq("#shareMessage:visible").val()||"").trim()),ASC.Files.ServiceManager.setAceObject(ASC.Files.ServiceManager.events.SetAceObject,{owner:r,showLoading:!0,notify:e},{ace_collection:f}),!i},et=function(){ASC.Files.ServiceManager.setAceLink(ASC.Files.ServiceManager.events.SetAceLink,{showLoading:!0,fileId:ASC.Files.UI.parseItemId(n).entryId,share:u})},ot=function(){var t,n,i;jq("#filesConfirmUnsubscribe:visible").length!=0&&(PopupKeyUpActionProvider.CloseDialog(),t=jq("#confirmUnsubscribeList input:checked"),t.length!=0)&&(n={},n.entry=[],i=t.map(function(t,i){var r=jq(i).attr("entryType"),u=jq(i).attr("entryId"),f=ASC.Files.UI.getEntryObject(r,u);return ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResources.DescriptRemove,!0),n.entry.push(r+"_"+u),{entryId:u,entryType:r}}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.unSubscribeMe(ASC.Files.ServiceManager.events.UnSubscribeMe,{parentFolderID:ASC.Files.Folders.currentFolder.id,showLoading:!0,list:i},{stringList:n}))},st=function(){var t=ASC.Files.UI.parseItemId(n).entryId;ASC.Files.ServiceManager.getShortenLink(ASC.Files.ServiceManager.events.GetShortenLink,{fileId:t});jq("#getShortenLink").hide()},ht=function(c,l,a){var y,g,tt,v,rt,k,w,it,nt,p,b,ut;if(typeof a!="undefined"||typeof c=="undefined"){ASC.Files.UI.displayInfoPanel(a,!0);return}if(s=c,o=!1,g=[],u=ASC.Files.Constants.AceStatusEnum.None,jq(c).each(function(n){var t=c[n];t.id===ASC.Files.Constants.ShareLinkId?(e=t.link,u=t.ace_status,tt=t.ace_status,i=!1):g.push({id:t.id,name:t.title,isGroup:t.is_group,canEdit:!(t.locked||t.owner),hideRemove:t.disable_remove,selectedAction:{id:t.ace_status,name:r(t.owner?"owner":t.ace_status),defaultAction:!1}});t.owner&&(y=t)}),v=[{id:ASC.Files.Constants.AceStatusEnum.ReadWrite,name:r(ASC.Files.Constants.AceStatusEnum.ReadWrite),defaultAction:i,defaultStyle:"full"}],i||(l.canWebCustomFilterEditing&&(v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.CustomFilter,name:r(ASC.Files.Constants.AceStatusEnum.CustomFilter),defaultAction:!1,defaultStyle:"customfilterEditing"}])),l.canWebReview&&(v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.Review,name:r(ASC.Files.Constants.AceStatusEnum.Review),defaultAction:!1,defaultStyle:"review"}])),l.canWebRestrictedEditing&&(v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.FillForms,name:r(ASC.Files.Constants.AceStatusEnum.FillForms),defaultAction:!1,defaultStyle:"restrictedEditing"}])),l.canWebComment&&(v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.Comment,name:r(ASC.Files.Constants.AceStatusEnum.Comment),defaultAction:!1,defaultStyle:"comment"}])),v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.Read,name:r(ASC.Files.Constants.AceStatusEnum.Read),defaultAction:!0,defaultStyle:"read"}])),v=v.concat([{id:ASC.Files.Constants.AceStatusEnum.Restrict,name:r(ASC.Files.Constants.AceStatusEnum.Restrict),defaultAction:!1,defaultStyle:"restrict"},{id:ASC.Files.Constants.AceStatusEnum.Varies,name:r(ASC.Files.Constants.AceStatusEnum.Varies),defaultAction:!1,disabled:!0}]),rt={actions:v,items:g},s=g,k=null,typeof n!="object"&&(i?tt=!1:(w=ASC.Files.UI.parseItemId(n),k=ASC.Files.UI.getEntryLink(w.entryType,w.entryId,t),it=document.createElement("a"),it.href=k,k=jq(it).prop("href"))),f.UpdateSharingData(rt,k),jq("#shareLinkBody").hide(),nt=460,tt&&(d(),nt=550,ASC.Resources.Master.Personal&&(nt=260)),f.ShowDialog(null,nt,l.asFlat,i),l.asFlat&&(PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Share.updateForParent();",PopupKeyUpActionProvider.ForceBinding=!0),ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),h(),p=jq(".share-container-head"),p.is("span")&&(p.replaceWith('<div class="share-container-head"><\/div>'),p=jq(".share-container-head"),p.html(ASC.Files.FilesJSResources.SharingSettingsHeader.format("<span><\/span>"))),b=jq(".share-container-head-corporate"),l.rootFolderType?jq("#studio_sharingSettingsDialog #shareMessagePanel").remove():jq("#studio_sharingSettingsDialog #shareMessagePanel").hide(),jq("#sharingSettingsItems").removeClass("with-message-panel"),l.rootFolderType||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"?(b.length||(p.after('<div class="share-container-head-corporate"><\/div>'),b=jq(".share-container-head-corporate"),b.html(ASC.Files.FilesJSResources.AccessSettingsHeader.format("<span><\/span>"))),b.show().find("span").attr("title",t).text(t),p.hide()):(p.show().find("span").attr("title",t).text(t),b.hide()),w)var ft=ASC.Files.UI.getEntryObject(w.entryType,w.entryId),et=ASC.Files.UI.getObjectData(ft),ot=ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(et);!ASC.Files.Folders||ASC.Files.Folders.folderContainer!="corporate"||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()||ot||!y||(ut=jq("#sharingSettingsItems .userLink[data-uid='"+y.id+"']"),ut.replaceWith('<div id="shareOwnerSelector" class="advanced-selector-select" data-id=""><div class="change-owner-selector"><\/div><\/div>'),jq("#shareOwnerSelector").useradvancedSelector({inPopup:!0,itemsChoose:[],itemsDisabledIds:[y.id],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,t){jq(this).attr("data-id",t.id).find(".change-owner-selector").html(t.title);t.id!=y.id&&f.WhereChanges(!0);jq("#shareOwnerSelector").useradvancedSelector("reset");jq("#shareOwnerSelector").useradvancedSelector("disable",[t.id])}).attr("data-id",y.id).attr("data-id-old",y.id).find(".change-owner-selector").text(y.title))},p=function(n,t,i){var r,u;if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=n?{needUpdate:!0,sharingSettings:n}:{needUpdate:!1};r.Referer="onlyoffice";u=JSON.stringify(r);window.parent.postMessage(u,a)},ct=function(t,r,u){if(typeof u!="undefined"){ASC.Files.UI.displayInfoPanel(u,!0);return}if(jq(typeof n=="object"?n:[n]).each(function(n,i){e=ASC.Files.UI.parseItemId(i);var r=ASC.Files.UI.getEntryObject(e.entryType,e.entryId);r.toggleClass("__active",jq.inArray(i,t)!=-1)}),r.owner&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],r.owner),i&&ASC.Desktop.setAccess){LoadingBanner&&LoadingBanner.displayLoading();var e=ASC.Files.UI.parseItemId(n);ASC.Files.UI.blockObject(n,!0,ASC.Files.FilesJSResources.DescriptCreate);ASC.Desktop.setAccess(e.entryId,function(n){n&&(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.DesktopMessageStoring),ASC.Files.Folders?ASC.Files.Folders.replaceFileStream(e.entryId,"",n,!0,null,!0):Teamlab.updateFileStream({fileId:e.entryId,encrypted:!0,forcesave:!0},n));LoadingBanner&&LoadingBanner.hideLoading();f.CloseDialog()})}},lt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var u=t.list,r=!1;jq(u).each(function(n,t){r||t.entryType!="folder"||(r=!0);ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId);ASC.Files.UI.getEntryObject(t.entryType,t.entryId).remove()});r&&ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(t.parentFolderID);ASC.Files.UI.checkEmptyContent()},at=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(n!=null&&n!=""){jq("#shareLink").val(n);var r=parseInt(jq("#sharingLinkAce select").val());r!=ASC.Files.Constants.AceStatusEnum.Restrict&&(e=n);v(n);h()}},vt=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u=ASC.Files.UI.parseItemId(n),f=ASC.Files.UI.getEntryObject(u.entryType,u.entryId);f.toggleClass("__active",t)};return{init:w,updateForParent:tt,getSharedInfo:rt,getSharedInfoShort:ut,setAceObject:y,unSubscribeMe:nt,confirmUnSubscribe:ot,clip:null,clipEmbed:null}}();jq(document).ready(function(){(function(n){jq("#shareLinkBody").length!=0&&(ASC.Files.Share.init(),n(function(){jq("#studioPageContent").on("click","#buttonUnsubscribe, #mainUnsubscribe.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe()});jq("#studioPageContent").on("click","#buttonShare, #mainShare.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();var n=[],t=[];jq("#filesMainContent .file-row:not(.without-share):not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.files-encrypted):has(.checkbox input:checked)").each(function(){var i=ASC.Files.UI.getObjectData(this),r=i.entryType,u=i.entryId;n.push(r+"_"+u);t.push(i.title)});ASC.Files.Share.getSharedInfo(n,t)});jq("#unsubscribeConfirmBtn").click(function(){ASC.Files.Share.confirmUnSubscribe()});jq("#filesMainContent").on("click",".btn-row",function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.entryType,r=n.title;return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(n.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),ASC.Files.Share.getSharedInfo(i+"_"+t,r),!1});jq("#studio_sharingSettingsDialog .containerBodyBlock").addClass("clearFix");jq("#shareLink, #shareEmbedded").on("mousedown",function(){return jq(this).select(),!1});jq("#shareLink, #shareEmbedded").on("keypress",function(n){return n.ctrlKey&&(n.charCode===ASC.Files.Common.keyCode.C||n.keyCode===ASC.Files.Common.keyCode.insertKey)})}))})(jQuery)});
jq(function(){jq(".mobile-app-win").trackEvent("mobileApp-banner","action-click","app-win");jq(".mobile-app-max").trackEvent("mobileApp-banner","action-click","app-max");jq(".mobile-app-linux").trackEvent("mobileApp-banner","action-click","app-linux");jq(".mobile-app-android").trackEvent("mobileApp-banner","action-click","app-android");jq(".mobile-app-ios").trackEvent("mobileApp-banner","action-click","app-store")});
window.ASC.Files.ChunkUploads=function(){var nt=!1,o=null,u,f=0,i={fisrt:!0,can:!1},tt=0,c=null,l=!0,a=document.body,it=null,vt="value"in document.createElement("progress"),n={QUEUED:0,STARTED:1,STOPED:2,DONE:3,FAILED:4,WAITCONFIRM:5},yt=function(n){nt===!1&&(nt=!0,ASC.Files.ChunkUploads.tenantQuota=n,rt(),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,rr),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,ci));b(!0)||jq("#emptyContainer .emptyContainer_dragDrop").remove();window.onbeforeunload=function(){if(ASC.Files.ChunkUploads.uploaderBusy)return ASC.Files.FilesJSResources.ConfirmLeavePage||"Are you sure you want to leave the current page. Downloading files will be interrupted."}},pt=function(){window.Teamlab.getQuotas({},{success:function(n,t){ASC.Files.ChunkUploads.tenantQuota=t;rt()}})},wt=function(n){var i=jq.format("{0}files/{1}/upload/create_session.json",ASC.Resources.Master.ApiPath,n.fid),t=null;return jq.ajax({type:"POST",data:{fileName:n.name,fileSize:n.size,relativePath:n.relativePath||"",encrypted:n.encrypted},url:jq.format(i,n.fid),async:!1,success:function(n){t=n.response},error:function(n){try{var r=jq.parseJSON(n.responseText),i=r.error.message}catch(u){i=n.statusText}t={success:!1,message:i}}}),t},bt=function(){var t=ASC.Files.Constants.storageKeyUploaderCompactView,n=localStorageManager.getItem(t);jq("#chunkUploadDialog").toggleClass("min",n===!0);jq("#uploadCompactViewCbx").prop("checked",n===!0);jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal===!0)},kt=function(){var n="fileupload",t=jq("<input/>").attr("id",n).attr("type","file").attr("multiple","multiple").css("width","0").css("height","0").hide();t.appendTo(jq("#buttonUpload").parent());jq("#buttonUpload").on("click",function(t){t.preventDefault();jq("#"+n).removeAttr("webkitdirectory").removeAttr("mozdirectory").removeAttr("directory");ASC.Files.Folders.folderContainer=="privacy"&&ASC.Desktop&&ASC.Desktop.encryptionUploadDialog?ASC.Desktop.encryptionUploadDialog(nr):jq("#"+n).click()});jq("#uploadActions").on("click","#buttonFolderUpload:not(.disable)",function(t){t.preventDefault();jq("#"+n).attr("webkitdirectory",!0).attr("mozdirectory",!0).attr("directory",!0);jq("#"+n).click()})},rt=function(){(ai(),jq("#buttonUpload").hasClass("not-ready")||jq("#buttonFolderUpload").hasClass("not-ready"))&&(f=0,kt(),o=jq("#fileupload").fileupload({url:null,autoUpload:!1,singleFileUploads:!0,sequentialUploads:!0,maxChunkSize:ASC.Files.Constants.CHUNK_UPLOAD_SIZE,progressInterval:1e3}),o.bind("fileuploadadd",ti).bind("fileuploadsubmit",ii).bind("fileuploadsend",ut).bind("fileuploadchunksend",ut).bind("fileuploadprogress",ft).bind("fileuploadchunkdone",ft).bind("fileuploaddone",et).bind("fileuploadfail",ri).bind("fileuploadalways",ui).bind("fileuploadstart",dt).bind("fileuploadstop",gt).bind("fileuploaddrop",ni),b(!0)&&(jq(a).bind("dragenter",function(){return!1}).bind("dragleave",fi).bind("dragover",ei).bind("drop",oi),jq(a).css({position:"static"})),jq("#buttonUpload, #buttonFolderUpload").removeClass("not-ready"))},dt=function(){w(ASC.Files.FilesJSResources.Uploading);ur();ASC.Files.ChunkUploads.uploaderBusy=!0;jq("#abortUploadigBtn").show()},gt=function(){f&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoUploadedSuccess.format(f));ASC.Files.ChunkUploads.initTenantQuota();w(ASC.Files.FilesJSResources.UploadComplete);ASC.Files.ChunkUploads.uploaderBusy=!1;jq("#abortUploadigBtn").hide();f=0;tt++;ASC.Files.ChunkUploads.createdSubfolders={}},ni=function(n,t){u&&(jq.each(t.files,function(n,t){t.fid=u}),u=null)},ti=function(i,r){var u=r.files[0],e;if(u){var f=ASC.Files.Folders.currentFolder.id,s=ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&(!ASC.Resources.Master.Personal||ASC.Files.Utility.CanWebEdit(u.name)),o=!0;ASC.Files.Common.isCorrectId(u.fid)?f=u.fid:o=ASC.Files.UI.accessEdit();o&&(u.id=at(),u.percent=0,u.loaded=0,(e=si(u,f))===!0?(!u.relativePath&&u.webkitRelativePath&&(u.relativePath=u.webkitRelativePath.slice(0,-u.name.length)),u.name=ASC.Files.Common.replaceSpecCharacter(u.name),u.fid=f,u.canShare=s,u.status=n.QUEUED,y(u,!1),r.id=at(),r.session=tt,st(u)&&l&&(u.status=n.WAITCONFIRM,ASC.Files.ConfrimConvert.showDialog(sr,"ASC.Files.ChunkUploads.abortForWaitingConfirm();",!0)),ASC.Files.ChunkUploads.uploadQueue.push(r)):e!==!1&&(u.canShare=!1,u.status=n.FAILED,y(u,!1),t(u.id,e)));ASC.Files.ChunkUploads.uploaderBusy||k()}},ii=function(i,u){var f=u.files[0],e=wt(f),o;e.success?(u.url=e.data.location,f.status=n.STARTED,jq(this).fileupload("option","url",e.data.location),li(f.fid,f.relativePath,e.data.path||[])):(f.status=n.FAILED,jq(this).fileupload("option","url",null),o=r(e.message),ASC.Files.UI.displayInfoPanel(o,!0),t(f.id,o))},ut=function(t,i){var r=i.files[0];return r.status==n.STARTED},ft=function(i,u){var f=u.files[0],s=u.result,o,h;typeof s=="undefined"||s&&s.success?(f.percent=parseInt(u.loaded/u.total*100,10),f.loaded=u.loaded,f.actionText==ASC.Files.FilesJSResources.FileUploading&&(p(f),w(null,u.session)),s&&s.data&&s.data.uploaded&&(et(i,u),o=e(n.STARTED),o&&o.files[0].id==f.id&&o.abort())):(o=e(n.STARTED),f.percent=100,f.loaded=f.size,f.status=n.FAILED,h=r(session.message),ASC.Files.UI.displayInfoPanel(h,!0),t(f.id,h),o&&o.files[0].id==f.id&&o.abort())},et=function(i,u){var e=u.files[0],s,o,l,a,h,c;e.status!=n.DONE&&(e.percent=100,e.loaded=e.size,s=u.result,s.success?(e.status=n.DONE,e.data=s.data,f++,o=st(e),l=!o||o&&ASC.Files.Common.storeOriginal,e.data.folderId!=ASC.Files.Folders.currentFolder.id||ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?(a=(e.relativePath||"").split("/")[0],h=e.fid+"/"+a,ASC.Files.ChunkUploads.createdSubfolders[h]?d(ASC.Files.ChunkUploads.createdSubfolders[h]):d(e.data.folderId)):ASC.Files.UI.isSettingsPanel()||hi(e.data.id,e.data.version,l),o?(tr(e.data.id,e.data.version),y(e,!0),ASC.Files.ChunkUploads.converterBusy||(ASC.Files.ChunkUploads.converterBusy=!0,ct())):p(e),trackingGoogleAnalytics("documents","upload","file")):(e.status=n.FAILED,c=r(session.message),ASC.Files.UI.displayInfoPanel(c,!0),t(e.id,c)))},ri=function(i,u){var f=u.files[0],e,o;f.percent=100;f.loaded=f.size;u.errorThrown=="abort"||u.textStatus=="abort"?f.status!=n.FAILED&&(f.status=n.STOPED,h(f.id),e=jq(this).fileupload("option","url"),e+=(e.indexOf("?")==-1?"?":"&")+"abort=true",jq.ajax({type:"POST",url:e,async:!0,success:function(n){n.success||ASC.Files.UI.displayInfoPanel(n.message,!0)},error:function(n,t,i){ASC.Files.UI.displayInfoPanel(i,!0)}})):(f.status=n.FAILED,o=u.errorThrown||u.textStatus,o&&(error=r(o),ASC.Files.UI.displayInfoPanel(error,!0),t(f.id,error)))},ui=function(){k()},fi=function(n){n.relatedTarget==null&&(it=setTimeout(ASC.Files.ChunkUploads.hideDragHighlight,1))},ei=function(n){clearTimeout(it);var t=n.originalEvent.dataTransfer;return ot(t)?(jq.browser.webkit&&(t.dropEffect="copy"),yi(n),!1):!0},oi=function(n){var t=n.originalEvent.dataTransfer;return ot(t)?(ASC.Files.ChunkUploads.hideDragHighlight(),!1):!0},si=function(n,t){var f=ASC.Files.Utility.GetFileExtension(n.name),i,r,u;if(ASC.Files.Constants.UPLOAD_FILTER&&jq.inArray(f,ASC.Files.Utility.Resource.ExtsUploadable)==-1)return i=ASC.Files.FilesJSResources.ErrorMassage_NotSupportedFormat,ASC.Files.UI.displayInfoPanel(i,!0),i;if(r=n.size,r<=0)return i=ASC.Files.FilesJSResources.ErrorMassage_EmptyFile,ASC.Files.UI.displayInfoPanel(i,!0),i;if(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty(null,"folder",t)){if(ASC.Files.ChunkUploads.tenantQuota==null)return!1;if(u=jq(".popup-modal:visible").length!=0,ASC.Resources.Master.Personal&&ASC.Files.ChunkUploads.tenantQuota.userStorageSize&&ASC.Files.ChunkUploads.tenantQuota.userAvailableSize<r)return i=jq.format(ASC.Files.FilesJSResources.ErrorMassage_StorageSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.userAvailableSize)),(u||!ASC.Files.UI.displayPersonalLimitStorageExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i;if(ASC.Files.ChunkUploads.tenantQuota.availableSize<r)return i=jq.format(ASC.Files.FilesJSResources.ErrorMassage_StorageSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.availableSize)),(u||!ASC.Files.UI.displayTariffLimitStorageExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i;if(ASC.Files.ChunkUploads.tenantQuota.maxFileSize<r)return i=jq.format("{0} ({1})",ASC.Files.FilesJSResources.ErrorMassage_FileSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.maxFileSize)),(u||!ASC.Files.UI.displayTariffFileSizeExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i}return!0},s=function(n){if(n=jq(n),n.is(".fu-row")||(n=n.closest(".fu-row")),n.length==0)return null;var t=n.attr("id");return v(t)},v=function(n,t){for(var i=null,r=ASC.Files.ChunkUploads.uploadQueue.length;r>0;r--)if(i=ASC.Files.ChunkUploads.uploadQueue[r-1].files[0],(i.id==n||i.data&&i.data.id==n)&&(!t||i.data&&i.data.version==parseInt(t)))return i;return i},hi=function(n,t,i){ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,{fileId:n,version:t,show:i,isStringXml:!1})},ci=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}lt(t.fileId,n,t.show)},li=function(n,t,i){var f,e,r,u;n==ASC.Files.Folders.currentFolder.id&&(f=i[i.length-1],n&&f&&n!=f)&&((t=(t||"").split("/")[0],e=n+"/"+t,ASC.Files.ChunkUploads.createdSubfolders[e])||(r=-1,jq(i).each(function(t,i){return i==n?(r=t,!1):!0}),r!=-1)&&((u=i[r+1],ASC.Files.ChunkUploads.createdSubfolders[e]=u,ASC.Files.UI.getEntryObject("folder",u).length)||ASC.Files.ServiceManager.getFolder(ASC.Files.ServiceManager.events.GetItems,{folderId:u,parentFolderID:n,lonelyType:"folder"})))},r=function(n){return((n=n||"error")=="error"||n.indexOf("NetworkError:")===0)&&(n=ASC.Files.FilesJSResources.UnknownErrorText),n},y=function(n,t){if(n){n.fileTypeCssClass=ASC.Files.Utility.getCssClassByFileTitle(n.name,!0);n.percent=0;n.showAnim=!vt;t?(n.actionText=ASC.Files.FilesJSResources.FileConverting,n.completeActionText=ASC.Files.FilesJSResources.FileConverted):(n.actionText=ASC.Files.FilesJSResources.FileUploading,n.completeActionText=ASC.Files.FilesJSResources.FileUploaded);var i=jq("#fileUploaderRowTmpl").tmpl(n),r=jq("#"+n.id);r.length!=0?r.replaceWith(i):(jq("#uploadFilesTable tbody").append(i),jq("#uploadFilesTable").parent().scrollTo("#"+n.id));t?jq("#"+n.id).addClass("convert"):jq("#"+n.id).addClass("upload")}},p=function(t){if(t){var i=jq("#"+t.id);ASC.Files.UI.setProgressValue(i,t.percent);t.status==n.DONE&&t.percent==100&&setTimeout(function(){i.removeClass("upload").removeClass("convert").addClass("done");t.hasOwnProperty("convertedData")&&(i.find(".fu-title-cell span").text(t.convertedData.title).attr("title",t.convertedData.title),i.find(".ftFile_21").attr("class",ASC.Files.Utility.getCssClassByFileTitle(t.convertedData.title,!0)))},ASC.Files.Constants.REQUEST_CONVERT_DELAY/4)}},t=function(n,t){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("canceled").addClass("error");jq("#"+n+" .popup_helper").text(t||ASC.Files.FilesJSResources.UnknownErrorText)},h=function(n){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("error").addClass("canceled")},w=function(t,i){var r;if(!t){var u=0,f=0,e=0;jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,r){if(r.session==i){var o=r.files[0];o.status!=n.STOPED&&(u++,f+=o.size,e+=o.loaded)}});r=parseInt(e/f*100,10);r==100&&(r=99);t=r>0?ASC.Files.FilesJSResources.UploadingProgress.format(u,r):ASC.Files.FilesJSResources.Uploading}jq("#chunkUploadDialogHeader").text(t)},ai=function(){var n=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.usedSize),t=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.storageSize);jq("#chunkUploadDialog .upload-info-container .free-space").text(ASC.Files.FilesJSResources.UsedSize.format(n,t))},b=function(n){var t=function(){var t="draggable"in document.createElement("span");return n?t:t?ASC.Desktop&&ASC.Files.Folders.folderContainer=="privacy"?!1:!0:!1}();return o.fileupload({dropZone:t?jq(a):null}),t},ot=function(n){return b()?jq.browser.safari?!1:n?n.types.contains&&!n.types.contains("Files")?!1:n.types.indexOf&&n.types.indexOf("Files")==-1?!1:!0:!1:!1},vi=function(){jq(".may-drop-to").removeClass("may-drop-to");jq(".drop-to").removeClass("drop-to");jq("#mainContent").removeClass("selected");i.fisrt=!0},yi=function(n){i.fisrt&&(ASC.Files.Mouse.highlightFolderTo("may-drop-to",!0),i.can=ASC.Files.UI.accessEdit(),jq("#mainContent").toggleClass("selected",i.can),i.fisrt=!1);jq(".drop-to").removeClass("drop-to");var r=n.target||n.srcElement,t=jq(r).closest(".may-drop-to");t.length?(u=ASC.Files.Mouse.getOverFolderId(n,t,"drop-to"),jq("#mainContent").toggleClass("selected",!1)):(jq("#mainContent").toggleClass("selected",i.can),u=null)},e=function(n){for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)if(ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n)return ASC.Files.ChunkUploads.uploadQueue[t];return null},k=function(){var t=e(n.QUEUED);t&&(ASC.Files.ChunkUploads.uploaderBusy=!0,t.submit())},pi=function(t){var i=s(t),r;i!=null&&(r=e(n.STARTED),r&&r.files[0].id==i.id?r.abort():i.status==n.QUEUED&&(i.percent=100,i.loaded=i.size,i.status=n.STOPED,h(i.id)))},wi=function(t){jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,i){var r=i.files[0];r.status==n.QUEUED&&(r.percent=100,r.loaded=r.size,r.status=n.STOPED)});var i=e(n.STARTED);i&&i.abort();t?(jq("#uploadFilesTable tbody").html(""),ASC.Files.ChunkUploads.uploadQueue=[]):jq("#uploadFilesTable .fu-row:not(.done)").each(function(){var n=jq(this).attr("id");h(n)})},bi=function(n){var t=s(n),i;t.canShare&&(i=t.convertedData?t.convertedData:t.data,ASC.Files.Share.getSharedInfo("file_"+i.id,i.title))},ki=function(n){var e=s(n),u=e.convertedData?e.convertedData:e.data,o,i,h,f,r,t;if(ASC.Files.MediaPlayer&&(ASC.Files.MediaPlayer.canPlay(u.title)||ASC.Files.Utility.CanImageView(u.title))){for(o=jq("#chunkUploadDialog .fu-row.done .ft_Image, #chunkUploadDialog .fu-row.done .ft_Video"),i=[],f=0;f<o.length;f++)r=s(o[f]),t=r.convertedData?r.convertedData:r.data,t.uploadId=r.id,(ASC.Files.MediaPlayer.canPlay(t.title)||ASC.Files.Utility.CanImageView(t.title))&&(i.push(t),u.id===t.id&&(h=i.length-1));ASC.Files.MediaPlayer.init(-1,{playlist:i,playlistPos:h,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(n){ASC.Files.Marker.removeNewIcon("file",n);var t=ASC.Files.MediaPlayer.getPlayHash(n);ASC.Files.Anchor.move(t,!0)},downloadAction:ASC.Files.Utility.GetFileDownloadUrl,canDelete:function(n){var t=ASC.Files.UI.getEntryObject("file",n);return!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)?!1:!0},deleteAction:function(n,t){ASC.Files.Folders.deleteItem("file",n,function(){var r=i.filter(function(t){return t.id===n});jq("#"+r[0].uploadId).remove();t()})}})}else ASC.Files.Folders.clickOnFile(u,!0)},di=function(n){var t=jq(n).closest(".fu-row"),i=t.attr("id");jq(n).helper({BlockHelperID:i+" .popup_helper",position:"fixed"})},gi=function(n){jq("#fileupload").prop("disabled",n)},nr=function(n,t){n.encrypted=t;o.fileupload("add",{files:[n]})},st=function(n){return ASC.Files.Constants.ENABLE_UPLOAD_CONVERT?n.encrypted?!1:ASC.Files.Utility.MustConvert(n.name):!1},tr=function(n,t){ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.ChunkUploads.convertQueue.push({id:n,version:t,needToRun:!0})},ht=function(n,t){var i=-1;jq.each(ASC.Files.ChunkUploads.convertQueue,function(r,u){u.id==n&&u.version==t&&(i=r)});i!=-1&&ASC.Files.ChunkUploads.convertQueue.splice(i,1)},ir=function(n,t){jq.each(ASC.Files.ChunkUploads.convertQueue,function(i,r){r.id==n&&r.version==t&&(r.needToRun=!1)})},ct=function(){var n={};n.entry=[];jq.each(ASC.Files.ChunkUploads.convertQueue,function(t,i){n.entry.push({entry:[i.id,i.version,i.needToRun===!0]})});n.entry.length>0?ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,{},{stringListList:n}):ASC.Files.ChunkUploads.converterBusy=!1},rr=function(n,i,u){var h,o,f,e,y;if(typeof n!="object"&&typeof u!="undefined"||n==null?u=u||ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert:n.length||(u=ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert),typeof u!="undefined"){h=r(u);ASC.Files.UI.displayInfoPanel(u,!0);clearTimeout(c);jq.each(ASC.Files.ChunkUploads.convertQueue,function(n,i){var r=v(i.id,i.version);r&&t(r.id,h)});g();ASC.Files.ChunkUploads.convertQueue.clear();ASC.Files.ChunkUploads.converterBusy=!1;return}for(o=0;o<n.length;o++)if(f=jq.parseJSON(n[o].source),e=v(f.id,f.version),ir(f.id,f.version),n[o].error!="")h=r(n[o].error),ASC.Files.UI.displayInfoPanel(h,!0),ht(f.id,f.version),e&&(t(e.id,h),g(e.data.id));else{var l=n[o].progress||0,a=!1,s=null;n[o].result&&(s=jq.parseJSON(n[o].result));l==100&&s&&(s.folderId!=ASC.Files.Folders.currentFolder.id||ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?d(e.fid):ASC.Files.UI.isSettingsPanel()||(y=s.fileXml,lt(ASC.Files.Common.storeOriginal?s.id:e.data.id,y,!0)),g(f.id),l=100,a=!0,ht(f.id,f.version));e&&(e.percent=l,a&&s&&(e.convertedData=s),p(e))}ASC.Files.ChunkUploads.convertQueue.length==0?(ASC.Files.ChunkUploads.converterBusy=!1,clearTimeout(c)):c=setTimeout(ct,ASC.Files.Constants.REQUEST_CONVERT_DELAY)},d=function(n){var i=ASC.Files.UI.getEntryObject("folder",n),t=i.find(".countFiles");t.html((parseInt(t.html())||0)+1)},ur=function(){jq("#chunkUploadDialog:visible").length==0&&(ASC.Files.Actions.hideAllActionPanels(),bt(),jq("#chunkUploadDialog").show())},fr=function(){ASC.Files.ChunkUploads.abortUploading(!0);jq("#chunkUploadDialog").hide();l=!0},er=function(){jq("#chunkUploadDialog").toggleClass("min")},or=function(n){var t=jq(n).prop("checked"),i=ASC.Files.Constants.storageKeyUploaderCompactView;localStorageManager.setItem(i,t)},lt=function(n,t,i){var r={fileId:n,show:i,isStringXml:!0};ASC.Files.EventHandler.onGetFile(t,r)},g=function(n){var t,i;n?(t=ASC.Files.UI.getEntryObject("file",n),t.length!=0&&t.hasClass("new-file")&&(ASC.Files.EmptyScreen.hideEmptyScreen(),t.removeClass("new-file").show().yellowFade())):(i=jq("#filesMainContent .new-file"),i.length>0&&(ASC.Files.EmptyScreen.hideEmptyScreen(),i.removeClass("new-file").show().yellowFade()))},at=function(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},sr=function(){setTimeout(function(){l=!1;for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n.WAITCONFIRM&&(ASC.Files.ChunkUploads.uploadQueue[t].files[0].status=n.QUEUED);ASC.Files.ChunkUploads.uploaderBusy||k()})},hr=function(){for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n.WAITCONFIRM&&(ASC.Files.ChunkUploads.uploadQueue[t].files[0].percent=100,ASC.Files.ChunkUploads.uploadQueue[t].files[0].loaded=ASC.Files.ChunkUploads.uploadQueue[t].files[0].size,ASC.Files.ChunkUploads.uploadQueue[t].files[0].status=n.STOPED,h(ASC.Files.ChunkUploads.uploadQueue[t].files[0].id))};return{uploadQueue:[],uploaderBusy:!1,convertQueue:[],converterBusy:!1,init:yt,initTenantQuota:pt,tenantQuota:null,abortFileUploading:pi,abortUploading:wi,abortForWaitingConfirm:hr,clickOnUploadedFile:ki,shareUploadedFile:bi,showUploadingErrorText:di,disableBrowseButton:gi,closeUploadDialod:fr,toggleUploadDialod:er,changeCompactView:or,createdSubfolders:{},hideDragHighlight:vi}}(),function(n){n(function(){if(jq("#chunkUploadDialog").length!=0){ASC.Files.Common.storeOriginal=jq("#chunkUploadDialog .store-original").prop("checked");jq("#chunkUploadDialog .actions-container.close").click(function(){ASC.Files.ChunkUploads.closeUploadDialod()});jq("#chunkUploadDialog .actions-container.minimize, #chunkUploadDialog .actions-container.maximize").click(function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("dblclick",".progress-dialog-header",function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("click",".fu-row.done .share",function(){ASC.Files.ChunkUploads.shareUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.done .ftFile_21,.fu-row.done .fu-title-cell span",function(){ASC.Files.ChunkUploads.clickOnUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.upload .abort-file-uploadig",function(){ASC.Files.ChunkUploads.abortFileUploading(this)});jq("#chunkUploadDialog").on("click","#abortUploadigBtn",function(){ASC.Files.ChunkUploads.abortUploading(!1)});jq("#chunkUploadDialog").on("click",".upload-error",function(){ASC.Files.ChunkUploads.showUploadingErrorText(this)});jq.dropdownToggle({switcherSelector:"#uploadSettingsSwitcher",dropdownID:"uploadSettingsPanel",afterShowFunction:function(){var n=jq("#uploadSettingsSwitcher").position(),t=jq("#uploadSettingsSwitcher").height()+5;jq("#uploadSettingsPanel").css({top:n.top+t+"px",left:n.left+"px"})}});jq("#chunkUploadDialog").on("change","#uploadCompactViewCbx",function(){ASC.Files.ChunkUploads.changeCompactView(this)});jq("#chunkUploadDialog .files-container").scroll(function(){ASC.Files.Actions.hideAllActionPanels()})}})}(jQuery);
window.ASC.Files.Converter=function(){var t=!1,i=function(){t===!1&&(t=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ConvertCurrentFile,ASC.Files.Converter.onConvertCurrentFile))},r=function(n,t,i,r){var f,u,e;if(!ASC.Files.Utility.MustConvert(t)||r==!1)return r==!1||!ASC.Files.Utility.CanWebEdit(t)?(f=ASC.Files.Utility.GetFileWebViewerUrl(n,r?null:i),window.open(f,"_blank"),ASC.Files.Marker.removeNewIcon("file",n)):(u=ASC.Files.UI.getEntryObject("file",n),u.find("#contentVersions:visible").length==0||ASC.Files.UI.editingFile(u)||(ASC.Files.Folders.closeVersions(),ASC.Files.Folders.showVersions(u)),e=ASC.Files.Actions.checkEditFile(n),ASC.Files.UI.updateMainContentHeader(),e);if(jq("#progressCopyConvertId").val(n),jq("#progressCopyConvertVersion").val(i),jq("#progressCopyConvertView").val(r==!1),!ASC.Files.Utility.FileIsDocument(t)&&!ASC.Files.Utility.FileIsSpreadsheet(t)&&!ASC.Files.Utility.FileIsPresentation(t))return!0;if(ASC.Files.UI.blockUI("#confirmCopyConvert",500),jq("#convertPassword").val(""),PopupKeyUpActionProvider.EnterAction='jq("#confirmCopyConvert .blue:visible:not(.disable):first").click()',jq("#progressCopyConvert, #convertPasswordPanel, #copyAndConvertOpen").hide(),jq("#copyConvertDescript, #confirmCopyAndConvert").show(),jq("#goToCopySplitter, #goToCopyFolder, #confirmCopyConvertToMyText, #confirmCopyConvertLabelText").hide(),u=ASC.Files.UI.getEntryObject("file",n),u.is(":visible"))if(ASC.Files.UI.accessEdit())ASC.Files.UI.accessDelete(u)&&!ASC.Files.UI.lockedForMe(u)&&(jq("#confirmCopyConvertLabelText").show(),jq("#confirmCopyConvertLabelText input").attr("disabled",!1));else{if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),location.href=ASC.Files.Utility.GetFileDownloadUrl(n,i),ASC.Files.Marker.removeNewIcon("file",n);jq("#confirmCopyConvertToMyText").show()}else if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),location.href=ASC.Files.Utility.GetFileDownloadUrl(n,i),ASC.Files.Marker.removeNewIcon("file",n);return!0},u=function(){PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Converter.convertFileEnd(null, null, true);";jq("#copyConvertDescript, #convertPasswordPanel, #confirmCopyAndConvert, #progressCopyConvert .convert-status").hide();jq("#progressCopyConvert, #copyAndConvertOpen, #progressCopyConvertRun").show();jq("#copyAndConvertOpen").addClass("disable");var n=jq("#progressCopyConvertId").val(),t=jq("#progressCopyConvertVersion").val(),i=jq("#convertPassword").val();ASC.Files.UI.setProgressValue("#progressCopyConvert",0);jq("#progressCopyConvert .asc-progress-percent").text("0%");ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.Converter.convertFileStep(n,t,i,!0)},f=function(n,t,i){var c,f,s,e,u,l;if(PopupKeyUpActionProvider.CloseDialogAction="",jq("#progressCopyConvert .convert-status").hide(),!t){i?PopupKeyUpActionProvider.CloseDialog():jq("#progressCopyConvertError").show();return}jq("#copyAndConvertOpen").removeClass("disable");var a=jq.parseJSON(n),v=a.id,r=jq.parseJSON(t),o=r.id,h=r.title;if(jq("#progressCopyConvertId").val(o),jq("#progressCopyConvertEnd").show(),r.folderId!=ASC.Files.Folders.currentFolder.id){jq("#progressCopyConvertEndTo, #goToCopySplitter, #goToCopyFolder").show();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFileIn.format(h,r.folderTitle));jq(".convert-end-to").html(r.folderTitle);jq("#goToCopyFolder").attr("data-id",r.folderId);return}c=r.fileXml;f=ASC.Files.TemplateManager.translateFromString(c);ASC.Files.EmptyScreen.hideEmptyScreen();s=ASC.Files.UI.getEntryObject("file",v);s.length==0||ASC.Files.Common.storeOriginal?(e=ASC.Files.UI.getEntryObject("file",o),e.length?(e.after(f),e.remove()):jq("#filesMainContent").prepend(f)):s.replaceWith(f);u=ASC.Files.UI.getEntryObject("file",o);l=ASC.Files.UI.getObjectData(u);u=l.entryObject;u.removeClass("new-file").yellowFade();ASC.Files.UI.addRowHandlers(u);ASC.Files.UI.resetSelectAll();ASC.Files.Actions.showActionsViewPanel();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(h))},e=function(){var n,t;PopupKeyUpActionProvider.CloseDialog();n=jq("#progressCopyConvertId").val();jq("#progressCopyConvertView").val()=="true"?(t=ASC.Files.Utility.GetFileWebViewerUrl(n),window.open(t,"_blank")):ASC.Files.Actions.checkEditFile(n)},o=function(){PopupKeyUpActionProvider.CloseDialogAction="";jq("#progressCopyConvert, #copyAndConvertOpen").hide();jq("#convertPasswordPanel, #confirmCopyAndConvert").show();jq("#convertPassword").val("").focus()},s=function(t){var i;t=t||jq("#filesMainContent .file-row:has(.checkbox input:checked)");i={documents:[],spreadsheets:[],presentations:[],other:[]};jq("#convertFileZip").toggle(jq(t).length>1);jq(t).each(function(){var r=ASC.Files.UI.getObjectData(this),n=r.title,u=r.id,f,s,e,o,t;if(r.entryType=="file"){if(f=[{name:ASC.Files.FilesJSResources.OriginalFormat,value:ASC.Files.Utility.GetFileExtension(n)}],!r.encrypted&&r.content_length<=ASC.Files.Constants.AvailableFileSize&&(e=ASC.Files.Utility.GetConvertFormats(n),e))for(o=0;o<e.length;o++)f.push({name:e[o],value:e[o]});s=ASC.Files.Utility.getCssClassByFileTitle(n);u="file_"+u}else f=[{name:"",value:""}],s=ASC.Files.Utility.getFolderCssClass(),u="folder_"+u;t={fileConvertFormats:{format:f},fileCssClass:s,fileTitle:n,fileId:u};f.length==1?i.other.push(t):ASC.Files.Utility.FileIsDocument(n)?i.documents.push(t):ASC.Files.Utility.FileIsSpreadsheet(n)?i.spreadsheets.push(t):ASC.Files.Utility.FileIsPresentation(n)?i.presentations.push(t):i.other.push(t)});var r=[{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Document),blockTitle:ASC.Files.FilesJSResources.Documents,blockFormats:{format:n(i.documents)},files:{file:i.documents}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet),blockTitle:ASC.Files.FilesJSResources.Spreedsheets,blockFormats:{format:n(i.spreadsheets)},files:{file:i.spreadsheets}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Presentation),blockTitle:ASC.Files.FilesJSResources.Presentations,blockFormats:{format:n(i.presentations)},files:{file:i.presentations}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(),blockTitle:ASC.Files.FilesJSResources.Other,blockFormats:{format:[]},files:{file:i.other}}],u=ASC.Files.Common.jsonToXml({entryData:{fileTypeBlock:r}}),f=ASC.Files.TemplateManager.translateFromString(u);jq("#convertFileList").html(f);jq("#convertFileList select").each(function(){jq(this).tlcombobox()});jq(".cnvrt-file-block-body .cnvrt-title-content").each(function(){var n=jq(this),t=n.text();ASC.Files.UI.highlightExtension(n,t)});ASC.Files.UI.blockUI("#convertAndDownload",600)},n=function(n){var i=[],h,u,t,f,o,r,s,e;if(n.length==0)return i;for(i.push({name:ASC.Files.FilesJSResources.OriginalFormat,value:"original"}),h=n[0].fileConvertFormats.format.length,u=0,t=1;t<n.length;t++)n[t].fileConvertFormats.format.length<h&&(u=t);for(t=0;t<n[u].fileConvertFormats.format.length;t++){for(f=n[u].fileConvertFormats.format[t].value,o=!0,r=0;r<n.length;r++){for(s=!1,e=0;e<n[r].fileConvertFormats.format.length;e++)n[r].fileConvertFormats.format[e].value==f&&(s=!0);s||(o=!1)}o&&i.push({name:f,value:f})}return i.push({name:ASC.Files.FilesJSResources.CustomFormat,value:"custom"}),i},h=function(n){var o=jq(n).find("option:selected").text(),r,t,f;if(jq(n).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(o),jq(n).attr("file-id"))r=jq(n).parents(".cnvrt-file-block").find(".cnvrt-file-block-head"),t=jq(r).find("select.select-format"),jq(t).val("custom"),jq(t).tlcombobox(),f=jq(t).find("option:selected").text(),jq(r).find(".cnvrt-format-title").text(f);else{var i=jq(n).parents(".cnvrt-file-block"),e=jq(i).find(".cnvrt-file-block-body"),u=jq(n).val();u=="original"?(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){var n=jq(this).find("option:first").val(),t=jq(this).find("option:first").text();jq(this).val(n);jq(this).tlcombobox();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(t)})):u=="custom"?jq(i).removeClass("cnvrt-file-block-closed").addClass("cnvrt-file-block-open"):(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){jq(this).val(u);jq(this).tlcombobox();var n=jq(this).find("option:selected").text();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(n)}))}},c=function(n,t,i,r){var u={},f;u.entry=[];f={entry:[n,t,r===!0,i]};u.entry.push([f]);ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ConvertCurrentFile,{fileId:n,version:t,password:i},{stringListList:u})},l=function(n,t,i){if(typeof n!="object"&&typeof i!="undefined"||n==null)i=i||ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert;else if(n.length&&n[0]){if(n[0].error&&(i=n[0].error,n[0].result=="password")){!t.password||ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_PasswordFile,!0);ASC.Files.Converter.convertFilePasswordRequest();return}}else i=ASC.Files.FilesJSResources.ErrorMassage_ErrorConvert;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Converter.convertFileEnd();return}var r=n[0],u=r.progress||0;if(ASC.Files.UI.setProgressValue("#progressCopyConvert",u),jq("#progressCopyConvert .asc-progress-percent").text(u+"%"),u>=100){ASC.Files.Converter.convertFileEnd(r.source,r.result);return}setTimeout(function(){ASC.Files.Converter.convertFileStep(t.fileId,t.version,t.password)},ASC.Files.Constants.REQUEST_CONVERT_DELAY)};return{init:i,checkCanOpenEditor:r,convertCurrentFile:u,convertFileStep:c,convertFileEnd:f,convertFileOpen:e,convertFilePasswordRequest:o,showToConvert:s,changeFormat:h,onConvertCurrentFile:l}}(),function(n){n(function(){ASC.Files.Converter.init();jq("#studioPageContent").on("click","#buttonConvert, #mainConvert.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert()});jq("#filesMainContent").on("click",".pencil.file-edit, .can-coauthoring .pencil.file-editing, .pencil.convert-action",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.title,r=n.version;return ASC.Files.Converter.checkCanOpenEditor(t,i,r),!1});jq("#convertFileList").on("click",".cnvrt-status-content, .cnvrt-file-block-head .cnvrt-title-content, .cnvrt-file-block-head .cnvrt-format-icon-content",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(n).hasClass("cnvrt-file-block-open");jq(n).toggleClass("cnvrt-file-block-open",!t).toggleClass("cnvrt-file-block-closed",t)});jq("#convertFileList").on("change","select.select-format",function(){ASC.Files.Converter.changeFormat(this)});jq("#convertFileList").on("click",".cnvrt-file-block-head input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(this).prop("checked");jq(n).toggleClass("cnvrt-file-block-active",t);jq(n).find("input[type=checkbox]").prop("checked",t);jq(n).find(".cnvrt-file-row").toggleClass("cnvrt-file-row-active",t)});jq("#convertFileList").on("click",".cnvrt-file-block-body input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),r=jq(this).parents(".cnvrt-file-row"),u=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]").length,t=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]:checked").length,i=jq(this).prop("checked");jq(r).toggleClass("cnvrt-file-row-active",i);i?(jq(n).addClass("cnvrt-file-block-active"),t==u?jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!1):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!0)):(jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!1).prop("indeterminate",!1),t==0?jq(n).removeClass("cnvrt-file-block-active"):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!0))});jq("#buttonStartConvert").click(function(){var n=[],t;if(jq("#convertFileList .cnvrt-file-block-body select.select-format").each(function(){var u=jq(this).parents(".cnvrt-file-row"),r,t,i;jq(u).hasClass("cnvrt-file-row-active")&&(r=jq(this).val(),t=jq(this).attr("file-id"),n.push({Key:t,Value:r}),i=ASC.Files.UI.parseItemId(t),ASC.Files.Marker.removeNewIcon(i.entryType,i.entryId))}),jq("#convertFileList .cnvrt-file-block-body input[type=hidden]").each(function(){var r=jq(this).parents(".cnvrt-file-row"),i,t;jq(r).hasClass("cnvrt-file-row-active")&&(i=jq(this).val(),fileId=jq(this).attr("file-id"),n.push({Key:fileId,Value:i}),t=ASC.Files.UI.parseItemId(fileId),ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId))}),n.length!=0){if(PopupKeyUpActionProvider.CloseDialog(),n.length==1&&(t=ASC.Files.UI.parseItemId(n[0].Key),t.entryType=="file")){fileId=t.entryId;location.href=ASC.Files.Utility.GetFileDownloadUrl(fileId,0,n[0].Value);return}ASC.Files.Folders.bulkDownload(n)}});jq("#confirmCopyAndConvert").click(ASC.Files.Converter.convertCurrentFile);jq("#confirmCopyConvert").on("click","#copyAndConvertOpen:not(.disable)",function(){ASC.Files.Converter.convertFileOpen()});jq("#confirmCopyConvert").on("click","#goToCopyFolder",function(){var n=jq(this).attr("data-id");ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(n);PopupKeyUpActionProvider.CloseDialog()})})}(jQuery);
window.ASC.Files.ConfrimConvert=function(){var n=!1,t=function(){n===!1&&(n=!0,jq(".store-original").change(function(){r(this)}))},i=function(n,t,i){if(!(jq("#confirmConvert:visible").length>0)){i=i===!0;var r=jq("#confirmConvert").attr(i?"data-save":"data-open");if(r=="true"){typeof n=="function"&&n.call();return}jq("#confirmConvertSave,#confirmConvertSaveDescript").toggle(i);jq("#confirmConvertEdit,#confirmConvertEditDescript").toggle(!i);jq("#confirmConvertContinue").off("click").on("click",function(){jq("#confirmConvertContinue").off("click");jq("#confirmConvertHide").prop("checked")&&Teamlab.hideConfirmConvert(i,{success:function(){jq("#confirmConvert").attr(i?"data-save":"data-open",!0)}});PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();typeof n=="function"&&n.call()});PopupKeyUpActionProvider.CloseDialogAction=t;ASC.Files.UI.blockUI("#confirmConvert",510)}},r=function(n){var t=jq(n).prop("checked");Teamlab.filesStoreOriginal(t,{success:function(n,t){ASC.Files.Common.storeOriginal=t===!0;jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal)},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}})};return{init:t,showDialog:i}}(),function(n){n(function(){ASC.Files.ConfrimConvert.init()})}(jQuery);
window.ASC.Files.CreateMenu=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#menuCreateNewButton:not(.disable)",dropdownID:"newDocumentPanel",inPopup:!0,addTop:4});jq.dropdownToggle({switcherSelector:"#menuUploadActionsButton:not(.disable)",dropdownID:"uploadActions",rightPos:!0,beforeShowFunction:function(){jq("#buttonFolderUpload").toggleClass("disable",ASC.Files.Folders.folderContainer=="privacy")},inPopup:!0,addTop:4});jq.dropdownToggle({switcherSelector:"#createByTemplate:not(.disable)",dropdownID:"filesTemplatesPanel",sideToggle:!0,addLeft:4,beforeShowFunction:function(){jq("#filesTemplateLoader").show();jq("#filesTemplateEmpty, #filesTemplateList").hide();ASC.Files.Folders.getTemplateList()}})},i=function(){ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)||(jq("#createDocument").remove(),jq("#emptyContainer .empty-folder-create-document").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet)||(jq("#createSpreadsheet").remove(),jq("#emptyContainer .empty-folder-create-spreadsheet").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Presentation)||(jq("#createPresentation").remove(),jq("#emptyContainer .empty-folder-create-presentation").remove());jq(".empty-folder-create-editor a").length||jq(".empty-folder-create-editor").remove()},r=function(n){var t=jq("#menuUploadActionsButton, #buttonUpload, #buttonFolderUpload, #createDocument, #createSpreadsheet, #createPresentation, #createNewFolder"+(ASC.Files.Tree.folderIdCurrentRoot?"":", .page-menu .menu-actions .menu-main-button"));t.toggleClass("disable",!n);ASC.Files.ChunkUploads.disableBrowseButton(!n)},u=function(n){jq("#createByTemplate").toggleClass("display-none",!n)};return{init:t,updateCreateDocList:i,disableMenu:r,toggleCreateByTemplate:u}}(),function(n){ASC.Files.CreateMenu.init();n(function(){ASC.Files.CreateMenu.updateCreateDocList();jq(document).on("click","#createDocument:not(.disable), #createSpreadsheet:not(.disable), #createPresentation:not(.disable)",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=this.id.replace("create","").toLowerCase();ASC.Files.Folders.createNewDoc()});jq("#emptyContainer .empty-folder-create a").click(function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=jq(this).hasClass("empty-folder-create-document")?"document":jq(this).hasClass("empty-folder-create-spreadsheet")?"spreadsheet":jq(this).hasClass("empty-folder-create-presentation")?"presentation":"";ASC.Files.Folders.createNewDoc()});jq(document).on("click","#createNewFolder:not(.disable), #emptyContainer .empty-folder-create-folder",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createFolder()})})}(jQuery);
window.ASC.Files.EmptyScreen=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#emptyContainer .hintCreate",dropdownID:"hintCreatePanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintUpload",dropdownID:"hintUploadPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintOpen",dropdownID:"hintOpenPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintEdit",dropdownID:"hintEditPanel",fixWinSize:!1})},i=function(){ASC.Files.UI.hideAllContent(!0);ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting());jq("#filesMainContent, #switchViewFolder, #mainContentHeader, #pageNavigatorHolder, #filesBreadCrumbs").hide();jq("#emptyContainer > div").hide();ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?jq("#emptyContainer_filter").show():(jq(".files-filter").hide(),jq("#emptyContainer .empty-folder-create").toggle(ASC.Files.UI.accessEdit()),!ASC.Files.Tree||ASC.Files.Tree.pathParts.length>1?(jq("#emptyContainer_subfolder").show(),ASC.Files.UI.checkButtonBack(".empty-folder-toparent")):jq("#emptyContainer_"+ASC.Files.Folders.folderContainer).show());jq("#emptyContainer").show();ASC.Files.UI.stickContentHeader()},r=function(){jq("#filesMainContent").is(":visible")&&jq("#mainContentHeader").is(":visible")||(ASC.Files.UI.hideAllContent(!0),ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),jq("#emptyContainer").hide(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),jq(".files-filter").show(),ASC.Files.Filter&&ASC.Files.Filter.resize(),jq("#filesMainContent, #switchViewFolder, #mainContentHeader").show(),ASC.Files.UI.stickContentHeader())};return{init:t,hideEmptyScreen:r,displayEmptyScreen:i}}(),function(n){jq("#hintCreatePanel").length!=0&&(ASC.Files.EmptyScreen.init(),n(function(){}))}(jQuery);
window.ASC.Files.ThirdParty=function(){var r=!1,s={Box:{key:"Box",customerTitle:ASC.Files.FilesJSResources.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResources.TypeTitleBoxNet,getTokenUrl:ASC.Files.Constants.URL_OAUTH_BOX},BoxNet:{key:"BoxNet",customerTitle:ASC.Files.FilesJSResources.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResources.TypeTitleBoxNet},DropBox:{key:"DropBox",customerTitle:ASC.Files.FilesJSResources.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResources.TypeTitleDropBox},DropboxV2:{key:"DropboxV2",customerTitle:ASC.Files.FilesJSResources.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResources.TypeTitleDropBox,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DROPBOXV2},DocuSign:{key:"DocuSign",customerTitle:ASC.Files.FilesJSResources.FolderTitleDocuSign,providerTitle:ASC.Files.FilesJSResources.TypeTitleDocuSign,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DOCUSIGN,link:ASC.Files.Constants.URL_OAUTH_DOCUSIGN_LINK},Google:{key:"Google",customerTitle:ASC.Files.FilesJSResources.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResources.TypeTitleGoogle,getTokenUrl:"http://www.onlyoffice.com"},GoogleDrive:{key:"GoogleDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResources.TypeTitleGoogle,getTokenUrl:ASC.Files.Constants.URL_OAUTH2_GOOGLE},OneDrive:{key:"OneDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResources.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},SharePoint:{key:"SharePoint",customerTitle:ASC.Files.FilesJSResources.FolderTitleSharePoint,providerTitle:ASC.Files.FilesJSResources.TypeTitleSharePoint,urlRequest:!0},SkyDrive:{key:"SkyDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResources.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},WebDav:{key:"WebDav",customerTitle:ASC.Files.FilesJSResources.FolderTitleWebDav,providerTitle:ASC.Files.FilesJSResources.TypeTitleWebDav,urlRequest:!0},kDrive:{key:"kDrive",customerTitle:ASC.Files.FilesJSResources.FolderTitlekDrive,providerTitle:ASC.Files.FilesJSResources.TypeTitlekDrive},Yandex:{key:"Yandex",customerTitle:ASC.Files.FilesJSResources.FolderTitleYandex,providerTitle:ASC.Files.FilesJSResources.TypeTitleYandex}},n,h=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetThirdParty,bt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveThirdParty,kt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteThirdParty,dt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,gt),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveDocuSign,ni),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SendDocuSign,ti),jq(document).click(function(n){jq.dropdownToggle().registerAutoHide(n,".account-row .menu-small","#thirdPartyActionPanel")}));jq("#thirdpartyToDocuSignAddMessage").on("click",function(){return st(),!1});jq("#thirdpartyToDocuSignRemoveMessage").on("click",function(){return f(),jq("#thirdpartyToDocuSignMessage").val(""),!1});jq.dropdownToggle({dropdownID:"thirdpartyToDocuSignFolderSelector",inPopup:!0,switcherSelector:"#thirdpartyToDocuSignFolder"});n=new ASC.Files.TreePrototype("#docuSignFolderSelector");n.clickOnFolder=e;jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector({inPopup:!0,showGroups:!0,showme:!1}).on("showList",ht);jq("#thirdpartyToDocuSignRecipientsList").on("click",".ds-user-link-delete",ct)},c=function(n,i,r){return n||i?n||(n=ASC.Files.UI.getObjectData(ASC.Files.UI.getEntryObject(i,r)),!n&&i=="folder"&&ASC.Files.Tree&&(n=ASC.Files.Tree.getFolderData(r))):n=ASC.Files.Folders.currentFolder,t(n)!=null},t=function(n){return ASC.Files.ThirdParty.thirdPartyList[n.provider_key]},l=function(){jq("#thirdPartyEditor").length!=0&&(yt(),ASC.Files.UI.hideAllContent(),jq("#treeSetting").addClass("currentCategory open"),jq(".settings-link-thirdparty").addClass("active"),jq("#settingThirdPartyPanel").show(),ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsThirdParty))},a=function(n){var u=t(n),i=jq.extend(u,{id:n.provider_id,customerTitle:n.title,folderId:n.id}),r;jq('#thirdPartyEditor div[id$="InfoPanel"]').hide();jq("#thirdPartyConnectionUrl, #thirdPartyPassword").val("");jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").hide();jq("#thirdPartyPassword").closest(".thirdparty-editor-row").hide();i.getTokenUrl?jq("#thirdPartyAccount").attr("data-provider",i.key).attr("data-providerId",i.id).closest(".thirdparty-editor-row").show():(jq("#thirdPartyAccount").closest(".thirdparty-editor-row").hide(),jq("#thirdPartyPassword").closest(".thirdparty-editor-row").show(),i.urlRequest&&jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").show());for(r in ASC.Files.ThirdParty.thirdPartyList)jq("#thirdPartyAccount span, #thirdPartyTitle").removeClass(r);jq("#thirdPartyAccount").attr("data-token","");jq("#thirdPartyAccount span, #thirdPartyTitle").addClass(i.key);jq("#thirdPartyTitle").focus();jq("#thirdPartyTitle").val(i.customerTitle);ASC.Files.UI.checkCharacter(jq("#thirdPartyTitle"));jq("#thirdPartyPanel input").removeAttr("disabled");jq("#thirdPartyCorporate").removeAttr("checked");LoadingBanner.hideLoaderBtn("#thirdPartyEditor");jq("#submitThirdParty").unbind("click").click(function(){return v(i),!1});jq("#thirdPartyCorporate").prop("checked",ASC.Files.Folders.folderContainer=="corporate");jq("#thirdPartyDialogCaption").text(ASC.Files.FilesJSResources.ThirdPartyEditorCaption.format(i.providerTitle));ASC.Files.UI.blockUI("#thirdPartyEditor",400);PopupKeyUpActionProvider.EnterAction='jq("#submitThirdParty").click();'},v=function(n){var r=jq("#thirdPartyConnectionUrl").val().trim(),u=jq("#thirdPartyPassword").val().trim(),t=jq("#thirdPartyTitle").val().trim();t=ASC.Files.Common.replaceSpecCharacter(t);var f=jq("#thirdPartyCorporate").prop("checked")===!0,e=jq("#thirdPartyAccount").attr("data-token"),i=jq('#thirdPartyEditor div[id$="InfoPanel"]');if(i.hide(),t==""){i.show().find("div").text(ASC.Files.FilesJSResources.ErrorMassage_FieldsIsEmpty);return}jq("#thirdPartyPanel input").attr("disabled","disabled");LoadingBanner.showLoaderBtn("#thirdPartyEditor");n.folderId&&ASC.Files.UI.blockObjectById("folder",n.folderId,!0,ASC.Files.FilesJSResources.DescriptChangeInfo);o(n.id,n.key,t,r,"",u,e,f,n.folderId)},y=function(n,i,r,u,f){if(n=n||(f?f.provider_id:null),n!=null||i==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){var e=f?f.entryId:null;r=r||t(f).providerTitle;jq("#thirdPartyDeleteDescr").html(ASC.Files.FilesJSResources.ConfirmDeleteThirdParty.format(u,r));jq("#deleteThirdParty").unbind("click").click(function(){return ASC.Files.UI.blockObjectById("folder",e,!0,ASC.Files.FilesJSResources.DescriptRemove),PopupKeyUpActionProvider.CloseDialog(),pt(n,i,u,e),!1});ASC.Files.UI.blockUI("#thirdPartyDelete",400);PopupKeyUpActionProvider.EnterAction='jq("#deleteThirdParty").click();'}},p=function(n){if(!n)return!1;var t=jq("#account_"+n.key);return t.length>0?(jq(t).find("input:visible:first").focus(),jq(t).yellowFade(),!1):(n.getTokenUrl?(OAuthCallback=function(t){i(n,t)},OAuthPopup(n.getTokenUrl,n.key)):i(n),!1)},w=function(n){return OAuthCallback=function(t){var i=jq("#account_"+n.provider_id);i.find(".account-hidden-token").val(t)},OAuthPopup(n.getTokenUrl,null,n.provider_id),!1},b=function(){if(!jq("#thirdPartyEditor").is(":visible"))return!1;var t=jq("#thirdPartyAccount").attr("data-provider"),n=ASC.Files.ThirdParty.thirdPartyList[t];return n?(OAuthCallback=function(n){jq("#thirdPartyAccount").attr("data-token",n)},OAuthPopup(n.getTokenUrl,null,jq("#thirdPartyAccount").attr("data-providerId")),!1):!1},i=function(n,t){var r={canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:!1,customer_title:n.customerTitle,isNew:!0,link:n.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:n.key,provider_key:n.key,provider_title:n.providerTitle,getTokenUrl:n.getTokenUrl},u,f,i;if(n.key==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){if(t){ASC.Files.ServiceManager.saveDocuSign(ASC.Files.ServiceManager.events.SaveDocuSign,{thirdParty:n},t);return}r.canEdit=!1;r.isNew=!1;ASC.Files.ThirdParty.docuSignAttached(!0)}u=ASC.Files.Common.jsonToXml({third_partyList:{entry:r}});f=ASC.Files.TemplateManager.translateFromString(u);jq("#thirdPartyAccountList").append(f);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show();i=jq("#account_"+r.provider_id);r.isNew&&(ASC.Files.UI.checkCharacter(jq(i).find(".account-input-folder")),jq(i).find(".account-hidden-token").val(t),jq(i).find(".account-settings-container").show(),n.getTokenUrl||(jq(i).find(".account-log-pass-container").show(),n.urlRequest&&jq(i).find(".account-field-url").show()),jq(i).find("input:visible:first").focus());jq(i).yellowFade()},u=function(n){var t=jq(n).is(".account-row")?jq(n):jq(n).parents(".account-row"),r,u,i;ASC.Files.UI.checkCharacter(jq(t).find(".account-input-folder"));r=jq(t).find(".account-hidden-customer-title").val().trim();jq(t).find(".account-input-folder").val(r);jq(t).find(".account-settings-container").show();u=jq(t).find(".account-hidden-provider-key").val().trim();i=ASC.Files.ThirdParty.thirdPartyList[u];i&&!i.getTokenUrl&&(jq(t).find(".account-log-pass-container").show(),i.urlRequest&&jq(t).find(".account-field-url").show());jq(t).find("input:visible:first").focus()},k=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val());if(!i){jq(t).remove();jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show());return}jq(t).find(".account-settings-container").hide()},d=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val()),r=jq(t).find(".account-hidden-provider-key").val().trim(),u=jq(t).find(".account-hidden-provider-title").val().trim(),f=jq(t).find(".account-hidden-customer-title").val().trim();ASC.Files.ThirdParty.showDeleteDialog(i,r,u,f)},g=function(n){var t=jq(n).parents(".account-row"),i=null,u=parseInt(jq(t).find(".account-hidden-provider-id").val());u&&(i=u);var f=jq(t).find(".account-hidden-provider-key").val().trim(),e=jq(t).find(".account-input-folder").val().trim(),s=jq(t).find(".account-input-url").val().trim(),h=(jq(t).find(".account-input-login").val()||"").trim(),c=jq(t).find(".account-input-pass").val().trim(),l=jq(t).find(".account-hidden-token").val().trim(),a=jq(t).find(".account-cbx-corporate").prop("checked")===!0,r=ASC.Files.ThirdParty.thirdPartyList[f];if(e==""||!i&&!r.getTokenUrl&&(h==""||c=="")||!i&&r.urlRequest&&s==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_FieldsIsEmpty,!0);return}if(!i&&r.getTokenUrl&&l==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_MustLogin,!0);return}jq(t).find("input").attr("disabled",!0);jq(t).find("a.button.account-save-link").addClass("disable");o(i,f,e,s,h,c,l,a)},nt=function(n){var t=jq(n).prop("checked");wt(t===!0);jq(".settings-link-thirdparty, .tree-thirdparty").toggleClass("display-none",t!==!0)},tt=function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.blockUI("#thirdPartyNewAccount",500)},it=function(n){var r=jq.fixEvent(n),t=jq(r.srcElement||r.target),f=jq(t).parents(".account-row"),i;return jq(f).is(":has(.account-settings-container)")?jq("#accountEditLinkContainer").show().unbind("click").click(function(){ASC.Files.Actions.hideAllActionPanels();u(t)}):jq("#accountEditLinkContainer").hide(),jq("#accountDeleteLinkContainer").unbind("click").click(function(){ASC.Files.Actions.hideAllActionPanels();d(t)}),i=jq("#thirdPartyActionPanel"),i.css({top:t.offset().top+t.outerHeight(),left:"auto",right:jq(window).width()-t.offset().left-t.width()-2,margin:"5px -8px 0 0"}),i.toggle(),!0},rt=function(n,t){if(!ASC.Files.Common.isCorrectId(n)||!ASC.Files.Common.isCorrectId(t))return!1;var i=function(n){var t=/^\d+/.exec(n),i;return t!=null?"onlyoffice":(i=/([^\|]+)(\|.*)?/,t=i.exec(n)[1],(t||"").replace(/-$/,""))},r=i(n),u=i(t);return r!=u},ut=function(n,i,r){var u=t(ASC.Files.Folders.currentFolder).providerTitle;jq("#moveThirdPartyMessage").html(jq.format(ASC.Files.FilesJSResources.ConfirmThirdPartyMoveMessage,"<br/><br/>",u));jq("#buttonMoveThirdParty").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCopyThirdParty").unbind("click").click(function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.isCopyTo=!0;ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCancelMoveThirdParty").unbind("click").click(function(){ASC.Files.Folders.isCopyTo=!1;PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#thirPartyConfirmMove",420);PopupKeyUpActionProvider.EnterAction='jq("#buttonMoveThirdParty").click();';PopupKeyUpActionProvider.CloseDialogAction='jq("#buttonCancelMoveThirdParty").click();'},ft=function(){return!!jq(".settings-link-thirdparty").length},et=function(n){return typeof n!="undefined"&&jq(".add-account-button.DocuSign").attr("data-signed",!!n),jq(".add-account-button.DocuSign").attr("data-signed")=="true"},ot=function(t){var u,r,i,s,o;if(jq("#thirdpartyToDocuSignHelper").length){ASC.Files.UI.blockUI("#thirdpartyToDocuSignHelper",500);return}if(!ASC.Files.ThirdParty.docuSignAttached()){ASC.Files.ThirdParty.addAccountButton(null,ASC.Files.ThirdParty.thirdPartyList.DocuSign.key);return}u=ASC.Files.FilesJSResources.DocuSignDialogHeader.format(t.title);jq("#thirdpartyToDocuSign .thirdparty-todocusign-header").attr("title",u).text(u);r=jq("#thirdpartyToDocuSign .thirdparty-todocusign-title");r.attr("title",t.title).attr("placeholder",t.title).val(t.title);ASC.Files.UI.checkCharacter(r);i=ASC.Files.Folders.currentFolder.id;s=n.getFolderData(i);ASC.Files.UI.accessEdit(s)||(i=ASC.Files.Constants.FOLDER_ID_MY_FILES);e(i);n.setCurrent(i);jq("#thirdpartyToDocuSignRecipientsList").hide();jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("reset");o=function(){var n=r.val(),u,f;if(n.length<1)return r.focus(),!1;i=jq("#thirdpartyToDocuSignFolder").attr("data-id");u=jq("#thirdpartyToDocuSignMessage:visible").val();f=jq("#thirdpartyToDocuSignRecipientsList .userLink").map(function(n,t){return jq(t).attr("data-uid")}).toArray();PopupKeyUpActionProvider.CloseDialog();ASC.Files.UI.blockObject(t.entryObject,!0,ASC.Files.FilesJSResources.DescriptDocuSign);var e={docusign_data:{folderId:i,message:u,name:n,users:{entry:f}}},o=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER),s={fileId:t.id,entryObject:t.entryObject,winSign:o};return ASC.Files.ServiceManager.sendDocuSign(ASC.Files.ServiceManager.events.SendDocuSign,s,e),!1};jq("#thirdpartyToDocuSignSend").unbind("click").click(o);jq("#thirdpartyToDocuSign").bind("keydown",function(n){var t,i,r;if(!jq("#thirdpartyToDocuSign").is(":visible")||(t||(t=n),i=jq(t.srcElement||t.target),jq(i).is("#thirdpartyToDocuSignMessage")&&!t.ctrlKey))return!0;r=t.keyCode||t.which;switch(r){case ASC.Files.Common.keyCode.enter:o()}return!0});f();ASC.Files.UI.blockUI("#thirdpartyToDocuSign",400)},f=function(){jq("#thirdpartyToDocuSignRemoveMessage").hide();jq("#thirdpartyToDocuSign").removeClass("with-message");jq("#thirdpartyToDocuSignAddMessage").show()},st=function(){jq("#thirdpartyToDocuSignAddMessage").hide();jq("#thirdpartyToDocuSign").addClass("with-message");jq("#thirdpartyToDocuSignRemoveMessage").show()},ht=function(n,t){jq("#thirdpartyToDocuSignRecipientsList").empty();t.forEach(function(n){n.decodedTitle=Encoder.htmlDecode(n.title);var t=ASC.Files.Common.jsonToXml({userItem:n}),i=ASC.Files.TemplateManager.translateFromString(t);jq("#thirdpartyToDocuSignRecipientsList").append(i)});jq("#thirdpartyToDocuSignRecipientsList").show();ASC.Files.UI.registerUserProfilePopup(jq("#thirdpartyToDocuSignRecipientsList"))},ct=function(){var n=jq(this).closest(".ds-user-link"),t=n.find(".userLink").attr("data-uid");jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("unselect",[t]);n.remove();jq("#thirdpartyToDocuSignRecipientsList .userLink").length||jq("#thirdpartyToDocuSignRecipientsList").hide()},e=function(t){var u,i,r;return n.rollUp(),n.setCurrent(t),u=n.getFolderData(t),ASC.Files.UI.accessEdit(u)?(i=n.getFolderTitle(t),jq("#thirdpartyToDocuSignFolder a").attr("title",i).text(i),jq("#thirdpartyToDocuSignFolder").attr("data-id",t),ASC.Files.Actions.hideAllActionPanels(),!0):(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException,(t==ASC.Files.Constants.FOLDER_ID_PROJECT||t==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),n.expandFolder(t),!1)},lt=function(t){ASC.Files.Common.isCorrectId(t)&&jq("#thirdPartyEditor").length!=0&&n.resetFolder(t)},at=function(){var n,t,r,e=location.hash.substr(1).split("&"),f;if(jq(e).each(function(i,u){var f=u.split("=");f[0]=="providerKey"?n=f[1]:f[0]=="providerId"?t=f[1]:f[0]=="code"&&(r=f[1])}),n){if(f=ASC.Files.ThirdParty.thirdPartyList[n],!f)return;i(f,r);return}t&&(u("#account_"+t),jq("#thirdPartyAccount").attr("data-token",r))},vt=function(n,t){var i,u,r;return(ASC.Files.Actions.hideAllActionPanels(),t||(t=jq(this).attr("data-provider")),i=ASC.Files.ThirdParty.thirdPartyList[t],!i)?!0:jq("#thirdPartyEditor").is(":visible")?(ASC.Files.ThirdParty.changeTokenThirdPartyAccount(),!1):(PopupKeyUpActionProvider.CloseDialog(),u=jq(this).closest(".account-row"),u.length)?(i.provider_id=jq(u).find(".account-hidden-provider-id").val(),ASC.Files.ThirdParty.editTokenThirdPartyAccount(i),!1):(r=function(){return ASC.Files.ThirdParty.addNewThirdPartyAccount(i)},jq("#settingThirdPartyPanel:visible").length==0)?(i.getTokenUrl?r():ASC.Files.Folders.eventAfter=r,ASC.Files.Anchor.move("setting=thirdparty"),!1):(r(),!1)},yt=function(){ASC.Files.ServiceManager.getThirdParty(ASC.Files.ServiceManager.events.GetThirdParty,{showLoading:!0})},o=function(n,t,i,r,u,f,e,o,s){var h={providerId:n,providerKey:t,folderTitle:i,login:u,password:f,token:e,corporate:o,folderId:s},c={third_party:{auth_data:{login:u,password:f,token:e,url:r},corporate:o,customer_title:i,provider_id:n,provider_key:t}};ASC.Files.ServiceManager.saveThirdParty(ASC.Files.ServiceManager.events.SaveThirdParty,h,c)},pt=function(n,t,i,r){var u={providerId:n,providerKey:t,folderId:r,customerTitle:i};t==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key?(u.providerId=0,ASC.Files.ServiceManager.deleteDocuSign(ASC.Files.ServiceManager.events.DeleteThirdParty,u)):ASC.Files.ServiceManager.deleteThirdParty(ASC.Files.ServiceManager.events.DeleteThirdParty,u)},wt=function(n){ASC.Files.ServiceManager.changeAccessToThirdparty(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,{enable:n===!0})},bt=function(n,t,i){var r,u;if(LoadingBanner.hideLoading(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(r=ASC.Files.ThirdParty.docuSignAttached(),n.length>0||r){u=jq(n).map(function(n,t){var i=ASC.Files.ThirdParty.thirdPartyList[t.provider_key];return{canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:t.isnew==1,customer_title:t.title,error:t.error,id:t.id,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:t.provider_id,provider_key:t.provider_key,provider_title:i.providerTitle,getTokenUrl:i.getTokenUrl}}).toArray();r&&u.push({canEdit:!1,canCorporate:!1,corporate:!1,customer_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.customerTitle,id:0,isNew:!1,link:ASC.Files.ThirdParty.thirdPartyList.DocuSign.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,provider_key:ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,provider_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.providerTitle});var f={third_partyList:{entry:u}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#thirdPartyAccountList").html(o);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show()}else jq("#thirdPartyAccountList .account-row").remove(),jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show();ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null)},kt=function(n,t,i){var p=jq('#thirdPartyEditor div[id$="InfoPanel"]'),f,u,v,y,h,o;if(typeof i!="undefined"){jq("#settingThirdPartyPanel:visible").length>0?(ASC.Files.UI.displayInfoPanel(i,!0),f=typeof t.folderId!="undefined"?jq("#"+t.folderId):jq("#account_"+(t.providerId||t.providerKey)),f.find("input").removeAttr("disabled"),f.find("a.button.account-save-link").removeClass("disable"),u=f.find(".account-input-url"),u.is(":visible")||(u=f.find(".account-input-login"),u.is(":visible")||(u=f.find(".account-input-pass"),u.is(":visible")||(u=f.find(".account-input-folder")))),u.focus()):(p.show().find("div").text(i),jq("#thirdPartyPanel input").removeAttr("disabled"),LoadingBanner.hideLoaderBtn("#thirdPartyEditor"));return}PopupKeyUpActionProvider.CloseDialog();var s=t.folderTitle,r=null,e=t.folderId;if(jq("#settingThirdPartyPanel:visible").length>0){t.providerId=t.providerId?t.providerId:0;var c=ASC.Files.ThirdParty.thirdPartyList[n.provider_key],w={id:n.id,corporate:t.corporate,customer_title:n.title,provider_id:n.provider_id,provider_title:c.providerTitle,provider_key:n.provider_key,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,error:n.error,canEdit:n.provider_key!=ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,getTokenUrl:c.getTokenUrl},b=ASC.Files.Common.jsonToXml({third_partyList:{entry:w}}),l=ASC.Files.TemplateManager.translateFromString(b),a=jq("#account_"+t.providerId);a.length?jq(a).replaceWith(l):(jq("#thirdPartyAccountList").append(l),jq("#emptyThirdPartyContainer").hide(),jq("#thirdPartyAccountContainer").show())}else v=t.corporate?ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Constants.FOLDER_ID_MY_FILES,v==ASC.Files.Folders.currentFolder.id?(y=ASC.Files.Common.jsonToXml({folder:n}),h=ASC.Files.TemplateManager.translateFromString(y),ASC.Files.EmptyScreen.hideEmptyScreen(),r=ASC.Files.UI.getEntryObject("folder",e),r?(r.replaceWith(h),r=ASC.Files.UI.getEntryObject("folder",e)):(jq("#filesMainContent").prepend(h),r=jq("#filesMainContent .new-folder:first")),r.yellowFade().removeClass("new-folder"),ASC.Files.UI.resetSelectAll(),s=ASC.Files.UI.getObjectTitle(r)):e&&(ASC.Files.UI.getEntryObject("folder",e).remove(),ASC.Files.UI.checkEmptyContent()),r&&r.is(":visible")&&ASC.Files.UI.addRowHandlers(r);o=ASC.Files.Tree.getParentId(n.id);ASC.Files.Tree.reloadFolder(o);t.corporate?o!=ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&ASC.Files.Tree.reloadFolder(ASC.Files.Constants.FOLDER_ID_COMMON_FILES):o!=ASC.Files.Constants.FOLDER_ID_MY_FILES&&ASC.Files.Tree.reloadFolder(ASC.Files.Constants.FOLDER_ID_MY_FILES);ASC.Files.UI.displayInfoPanel(e?ASC.Files.FilesJSResources.InfoChangeThirdParty.format(s):ASC.Files.FilesJSResources.InfoSaveThirdParty.format(s,t.corporate?ASC.Files.FilesJSResources.CorporateFiles:ASC.Files.FilesJSResources.MyFiles));t.providerId||(ASC.Files.Filter.clearFilter(!0),ASC.Files.Anchor.navigationSet(n.id))},dt=function(n,t,i){var o,f,s;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var h=t.providerId,r=t.providerKey,e=t.folderId||n,c=t.customerTitle,u=ASC.Files.UI.getEntryObject("folder",e);u!=null&&u.length?(u.remove(),ASC.Files.UI.checkEmptyContent()):r==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key&&ASC.Files.ThirdParty.docuSignAttached(!1);o=r==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key?r:h;f=jq("#account_"+o);f.length>0&&(jq(f).remove(),jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show()));s=ASC.Files.Tree.getParentId(e);ASC.Files.Tree.reloadFolder(s);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveThirdParty.format(c))},gt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#cbxEnableSettings").prop("checked",n===!0)},ni=function(n,t,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}i(t.thirdParty)},ti=function(n,t,i){var r=t.winSign;if(ASC.Files.UI.blockObject(t.entryObject),typeof i!="undefined"){r.close();ASC.Files.UI.displayInfoPanel(i,!0);return}r&&r.location?r.location.href=n:r=window.open(n,"_blank")};return{init:h,thirdPartyList:s,isThirdParty:c,isDifferentThirdParty:rt,showChangeDialog:a,showDeleteDialog:y,addAccountButton:vt,addNewThirdPartyAccount:p,editTokenThirdPartyAccount:w,changeTokenThirdPartyAccount:b,cancelThirdPartyAccount:k,saveThirdPartyAccount:g,showSettingThirdParty:l,changeAccessToThirdpartySettings:nt,showThirdPartyNewAccount:tt,processAnchor:at,showThirdPartyActionsPanel:it,showMoveThirdPartyMessage:ut,thirdpartyAvailable:ft,docuSignAttached:et,showDocuSignDialog:ot,docuSignFolderSelectorReset:lt}}(),function(n){jq("#thirdPartyEditor").length!=0&&n(function(){jq('#thirdPartyEditor div[id$="InfoPanel"]').removeClass("infoPanel").addClass("errorBox").css("margin","10px 16px 0");jq(".add-account-button, .edit-account-button").click(ASC.Files.ThirdParty.addAccountButton);jq("#thirdPartyAccountList").on("click",".edit-account-button",ASC.Files.ThirdParty.addAccountButton);jq("#thirdPartyAccountList").on("click","a.account-cancel-link",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.cancelThirdPartyAccount(this),!1});jq("#thirdPartyAccountList").on("click","a.account-save-link:not(.disable)",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.saveThirdPartyAccount(this),!1});jq("#cbxEnableSettings").on("change",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.changeAccessToThirdpartySettings(this),!1});jq(".account-connect").on("click",function(){var n=function(){return ASC.Files.ThirdParty.showThirdPartyNewAccount()};if(jq("#settingThirdPartyPanel:visible").length==0){ASC.Files.Folders.eventAfter=n;ASC.Files.Anchor.move("setting=thirdparty");return}n()});jq("#thirdPartyAccountList").on("click",".menu-small",ASC.Files.ThirdParty.showThirdPartyActionsPanel);jq("#thirdPartyAccountList").on("keyup",".account-input-url, .account-input-login, .account-input-pass, .account-input-folder, .account-cbx-corporate",function(n){var r;r||(r=n);r=jq.fixEvent(r);var u=r.keyCode||r.which,i=jq(this).closest(".account-row"),t=jq(this);if(u==ASC.Files.Common.keyCode.enter){if(!t.val().trim().length)return;if(t.is(".account-input-url")&&(t=i.find(".account-input-login").is(":visible")?i.find(".account-input-login").focus():i.find(".account-input-pass").focus()),!t.val().trim().length)return;if(t.is(".account-input-login")&&(t=i.find(".account-input-pass").focus()),!t.val().trim().length)return;if(t.is(".account-input-pass")&&(t=i.find(".account-input-folder").focus()),!t.val().trim().length)return;i.find(".account-save-link").click()}else u==ASC.Files.Common.keyCode.esc&&i.find(".account-cancel-link").click()});ASC.Files.ThirdParty.init()})}(jQuery);
window.ASC.Files.Tree=function(){var f=!1,n,t,i=!1,r=!1,u=!1,e=!1,o=function(){var o,s,h,c,l;f===!1&&(f=!0,o=null,jq(".files-content-panel").attr("data-rootid")&&(ASC.Files.Tree.folderIdCurrentRoot=jq(".files-content-panel").attr("data-rootid"),o=ASC.Files.Constants.FOLDER_ID_PROJECT),n=new ASC.Files.TreePrototype("#treeViewContainer",o),n.clickOnFolder=w,o&&n.expandFolder(o),t=new ASC.Files.TreePrototype("#treeViewSelector"),t.clickOnFolder=b,s=t.getFolderData(ASC.Files.Constants.FOLDER_ID_PRIVACY),s&&(e=!0,s.entryObject.addClass("privacy-node")),h=n.getFolderData(ASC.Files.Constants.FOLDER_ID_FAVORITES),h&&(i=!h.entryObject.hasClass("display-none")),c=n.getFolderData(ASC.Files.Constants.FOLDER_ID_RECENT),c&&(r=!c.entryObject.hasClass("display-none")),l=n.getFolderData(ASC.Files.Constants.FOLDER_ID_TEMPLATES),l&&(u=!l.entryObject.hasClass("display-none")))},s=function(i){return n.getFolderTitle(i)||t.getFolderTitle(i)},h=function(t){return n.getParentId(t)},c=function(t){return n.getFolderData(t)},l=function(){for(var r,i=0;i<ASC.Files.Tree.pathParts.length-1;i++)r=ASC.Files.Tree.pathParts[i],n.getFolderData(ASC.Files.Tree.pathParts[i+1])||n.resetFolder(r),n.expandFolder(r,!0,!0);n.setCurrent(ASC.Files.Folders.currentFolder.id);(ASC.Files.Tree.pathParts.length!=1||t.getFolderData(ASC.Files.Folders.currentFolder.id))&&t.setCurrent(ASC.Files.Folders.currentFolder.id)},a=function(){if(t.rollUp(),t.setCurrent(ASC.Files.Folders.currentFolder.id),e){var n=ASC.Files.Folders.folderContainer=="privacy";t.entryObject().toggleClass("only-privacy",n)}},v=function(n){var r=t.getFolderTitle(n),u=t.getPath(n),i=jq(u).map(function(n,i){return t.getFolderTitle(i)});return i.push(r),i.toArray().join(" > ")},y=function(i){if(!ASC.Files.Common.isCorrectId(i))return!1;var r=n.resetFolder(i);return t.resetFolder(i),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.docuSignFolderSelectorReset(i),r},p=function(t){var i=ASC.Files.Tree.resetFolder(t);i&&n.expandFolder(t)},w=function(t){var f,r,e,u,o,i;if(ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT&&(f=jq.inArray(t+"",ASC.Files.Tree.pathParts)!=-1,!f&&(r=n.getPath(t),e=jq.inArray(ASC.Files.Folders.currentFolder.id,r)!=-1,!e))){u=t;r.length&&(u=r[0]);o=n.getFolderData(u);i=o.folderUrl;i=i.substring(0,i.lastIndexOf("#"));i=i+"#"+ASC.Files.Common.getCorrectHash(t);location.href=i;return}ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(t);return},b=function(n){var f=t.getFolderData(n),u,i,r;return ASC.Files.UI.accessEdit(f)?(u=t.getFolderTitle(n),i=t.getPath(n),i.push(n),ASC.Files.Folders.curItemFolderMoveTo(n,u,i),!0):(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException,(n==ASC.Files.Constants.FOLDER_ID_PROJECT||n==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResources.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),t.expandFolder(n),!1)},k=function(t){if(t===undefined)return i;i=t===!0;var r=n.getFolderData(ASC.Files.Constants.FOLDER_ID_FAVORITES).entryObject;return r.toggleClass("display-none",!i),i},d=function(t){if(t===undefined)return r;r=t===!0;var i=n.getFolderData(ASC.Files.Constants.FOLDER_ID_RECENT).entryObject;return i.toggleClass("display-none",!r),r},g=function(t){if(t===undefined)return u;u=t===!0;var i=n.getFolderData(ASC.Files.Constants.FOLDER_ID_TEMPLATES).entryObject;return i.toggleClass("display-none",!u),u};return{init:o,resetFolder:y,reloadFolder:p,getFolderTitle:s,getParentId:h,pathParts:[],folderIdCurrentRoot:null,updateTreePath:l,showSelect:a,getPathTitle:v,getFolderData:c,displayFavorites:k,displayRecent:d,displayTemplates:g}}(),function(n){n(function(){jq("#treeViewPanelSelector").length!=0&&ASC.Files.Tree.init()})}(jQuery);
window.ASC.Files.TreePrototype=function(n,t){var r=function(n){return n==c?i:ASC.Files.UI?i.find(".tree-node"+ASC.Files.UI.getSelectorId(n)):i.find('.tree-node[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]')},u=function(n){return jq(n).attr("data-id")},o=function(n){var t=r(n);return t.parents(".jstree .tree-node")},l=function(n,t,i){(n.find("ul").html()||"").trim()!=""&&s(n);t!=""?(n.removeClass("jstree-empty").append("<ul>"+t+"<\/ul>"),n.find("ul a").each(function(){var n=u(this),t=ASC.Files.UI.getEntryLink("folder",n);jq(this).attr("href",t)})):n.addClass("jstree-empty");n.find(".jstree-load-node").removeClass("jstree-load-node");i!==!1&&n.addClass("jstree-open").removeClass("jstree-closed")},s=function(n){n.is(".tree-node")||(n=n.find(".tree-node"));n.addClass("jstree-closed").removeClass("jstree-open jstree-empty").children("ul").remove()},e=function(n,t,i,f){if(ASC.Files.Common.isCorrectId(t))var e=r(t);else e=jq(this).parent(),t=u(e);e.length&&t!=ASC.Files.Constants.FOLDER_ID_FAVORITES&&t!=ASC.Files.Constants.FOLDER_ID_RECENT&&(t!=ASC.Files.Constants.FOLDER_ID_PRIVACY||ASC.Desktop)&&t!=ASC.Files.Constants.FOLDER_ID_TEMPLATES&&t!=ASC.Files.Constants.FOLDER_ID_TRASH&&(e.is(":has(ul)")?e.toggleClass("jstree-closed",i!=null?!i:null).toggleClass("jstree-open",i):v(t,f))},a=function(){var n=jq(this).parent(),t=u(n),i=f.clickOnFolder(t)!==!1;return h(n,i),!1},h=function(n,t){i.find(".node-selected").removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");n.addClass("node-selected");n.parents(".jstree .jstree-closed").addClass("jstree-open").removeClass("jstree-closed");n.parents(".jstree .tree-node").addClass("parent-selected");f.selectedFolderId=t?u(n):null},v=function(n,t){ASC.Files.Common.isCorrectId(n)&&(r(n).find(".jstree-expander").addClass("jstree-load-node"),ASC.Files.ServiceManager.getTreeSubFolders(ASC.Files.ServiceManager.events.GetTreeSubFolders,{treeNodeRoot:i,folderId:n,ajaxsync:t===!0}))},y=function(n){ASC.Files.Common.isCorrectId(n)&&ASC.Files.ServiceManager.getTreePath(ASC.Files.ServiceManager.events.GetTreePath,{folderId:n,ajaxsync:!0})},p=function(n,t,u){if(typeof u!="undefined"){f.errorMessage(u);return}var o=t.folderId,s=ASC.Files.TemplateManager.translate(n),e=r(o);if(!e.length){if(c!=null)return;e=i}l(e,s,i==t.treeNodeRoot)},w=function(n,t,i){if(typeof i!="undefined"){f.errorMessage(i);return}n.pop();jq(n).each(function(n,t){e(null,t,!0,!0)})};this.getFolderTitle=function(n){return r(n).children("a:first").text().trim()};this.getPath=function(n){return o(n).map(function(n,t){return u(t)}).toArray().reverse()};this.getParentId=function(n){var t=o(n);return t.length?u(t[0]):0};this.setCurrent=function(n){var t=r(n);t.length||(y(n),t=r(n));h(t,!0)};this.resetFolder=function(n){var t=r(n),i=t.hasClass("jstree-open");return s(t),i};this.rollUp=function(){i.removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");i.find(".jstree-open").addClass("jstree-closed").removeClass("jstree-open");f.selectedFolderId=null};this.expandFolder=function(n,t,i){return e(null,n,t,i)};this.selectedFolderId=null;this.clickOnFolder=function(){};this.errorMessage=function(n){ASC.Files.UI&&ASC.Files.UI.displayInfoPanel(n,!0)};this.getFolderData=function(n){var t=r(n);return ASC.Files.UI?ASC.Files.UI.getObjectData(t):{entryId:n,entryType:"folder",entryObject:t,title:getFolderTitle(n)}};this.getDefaultFolderId=function(){return u(i.find(".tree-node:visible:first"))};this.displayAsRoot=function(n){var t=r(n);jq(".jstree-root-as").removeClass("jstree-root-as");t.parents(".tree-node").addClass("jstree-root-parent").addBack().addClass("jstree-root-as");jq(".jstree-root-out").removeClass("jstree-root-out");t.parent().children('.tree-node:not([data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"])').addClass("jstree-root-out")};this.entryObject=function(){return i};var f=this,i=jq(n),c=t;i.on("click",".jstree-expander",e);i.on("dblclick","a",e);i.on("click","a",a);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreeSubFolders,p);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreePath,w)};

